<?xml version="1.0" encoding="utf-8"?>
<post><title>sql server - Access is denied when attaching a database - Stack Overflow</title><question><text><div class="post-text" itemprop="text">
<p>I am using SQL Server 2008 developer edition. I was trying to attach the AdventureWorks2008 database.  </p>
<p>When I tried to attach, I received an "access is denied" error. According to the event log, it came from the O/S: </p>
<blockquote>
<p>Open failed: Could not open file D:\ProjectData\AdventureWorks\AdventureWorksLT2008_Data.mdf for file number 0.  OS error: 5(Access is denied.).</p>
</blockquote>
<p>I thought "NTFS problem", but System (and I) have modify access to both files.</p>
<p>I found that I can successfully attach the database if I log in as sa, but my user account won't work.</p>
<p>I am a member of the local administrators group on my machine, and I am in the sysadmins role in SQL Server instance.</p>
<p>Any idea why I had to be logged in as sa?</p>
</div></text><author><a href="/users/7872/rob">Rob</a></author><comments><comment><text><span class="comment-copy">Is the MDF file encrypted by any chance?</span></text><author><a class="comment-user" href="/users/5836/brettski" title="7,778 reputation">Brettski</a></author></comment><comment><text><span class="comment-copy">Nope -- the real curiosity for me is that it works fine if I log in as sa (using Management Studio), but it does not work if I use my local admin account.  My account is an admin, a domain admin, and it is the account that I was logged in under when I installed SQL Server (during setup there was an option to make my current account a sysadmin, and I did so).</span></text><author><a class="comment-user owner" href="/users/67038/jmarsch" title="13,921 reputation">JMarsch</a></author></comment><comment><text><span class="comment-copy">This is how UAC works in W7, no surprise.</span></text><author><a class="comment-user" href="/users/576857/al-kepp" title="4,284 reputation">Al Kepp</a></author></comment><comment><text><span class="comment-copy">@AlKepp Nope -- not a UAC thing.  Just logging in as sa corrects (SQL server account, has nothing to do with UAC) the problem.  Also, just by being a member of the local admins group, I get my permissions -- I do not have to elevate in order for my AD credentials to work.</span></text><author><a class="comment-user owner" href="/users/67038/jmarsch" title="13,921 reputation">JMarsch</a></author></comment></comments></question><answers><answer><text><div class="post-text" itemprop="text">
<p>Run SQL Server Management Studio as an Administrator.  (right click-&gt; run as administrator) that took care of all the weirdness in my case. </p>
<p>SQL SRV EXPRESS 2008 R2.  Windows 7</p>
</div></text><author><a href="/users/190708/mandomando">MandoMando</a></author><comments><comment><text><span class="comment-copy">Running Management Studio as administrator did NOT work for me. This error occurs when attempting to start the windows service.</span></text><author><a class="comment-user" href="/users/881111/nuzzolilo" title="965 reputation">Nuzzolilo</a></author></comment><comment><text><span class="comment-copy">Thanks a lot, work perfect for  me. !!! :)</span></text><author><a class="comment-user" href="/users/194721/ricardobalda" title="774 reputation">RicardoBalda</a></author></comment><comment><text><span class="comment-copy">Thanks that worked for me :-)</span></text><author><a class="comment-user" href="/users/330420/ah" title="1,856 reputation">AH.</a></author></comment><comment><text><span class="comment-copy">Works, I hate microsoft, why do i have to do this all of the sudden.  16 year MS developer and just fed up !</span></text><author><a class="comment-user" href="/users/26685/schmoopy" title="2,520 reputation">schmoopy</a></author></comment><comment><text><span class="comment-copy">Running as Administrator is first step. Second step is logging to SQL Server by Windows Authentication. (This method worked for me!)</span></text><author><a class="comment-user" href="/users/820031/furkan-ekinci" title="2,065 reputation">Furkan Ekinci</a></author></comment><comment><text><span class="comment-copy">Worked for me too. Cannot express in words how tiring &amp; frustrating the permission prompts and errors are on Windows. I AM AN ADMINISTRATOR!</span></text><author><a class="comment-user" href="/users/254449/david-masters" title="5,043 reputation">David Masters</a></author></comment><comment><text><span class="comment-copy">Worked, thank you!</span></text><author><a class="comment-user" href="/users/2165263/amb" title="492 reputation">AMB</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>Thank you for all of the comments.  Some of you helped to lead me to the answer.  Here's what I found:</p>
<p>It was an NTFS permission problem, and not a SQL problem.  Further, it looks kind of bug-like (and it's repeatable).</p>
<p>The problem:
The account that I was using had full control NTFS permissions to the mdf and ldf files.  However, it had those permissions through group membership (the Local Administrators group had permissions, and my account is a member of local admins).  (I verified the permissions)</p>
<p>If I try to do the attach, connect to SQL Server as me  (where I am in the admins group), it fails with the NTFS problem.</p>
<p>However, if I grant the same file permissions that the local admin group has directly to my Domain Account, then I can attach with no problems.</p>
<p>(oh, and yes, I checked the local groups on this machine, and I verified that my domain account is indeed a member of the local admins group).</p>
<p>So, it looks as though the error occurs because some code (either in SQL Server or Management Studio) checks for the permissions that the user account holds, but it doesn't go so far as to check group permissions that the user account inherits.</p>
<p>That sounds weird to me, but I can repro it over and over again, so I have to conclude that it is the answer.</p>
</div></text><author><a href="/users/67038/jmarsch">JMarsch</a></author><comments><comment><text><span class="comment-copy">So; are you gonna report this as a bug? :)</span></text><author><a class="comment-user" href="/users/234025/trevoke" title="3,400 reputation">Trevoke</a></author></comment><comment><text><span class="comment-copy">I suppose I will!</span></text><author><a class="comment-user owner" href="/users/67038/jmarsch" title="13,921 reputation">JMarsch</a></author></comment><comment><text><span class="comment-copy">I did: <a href="http://connect.microsoft.com/SQLServer/feedback/details/539703/access-denied-attaching-a-database-when-permissions-are-inherited" rel="nofollow noreferrer">connect.microsoft.com/SQLServer/feedback/details/539703/…</a></span></text><author><a class="comment-user owner" href="/users/67038/jmarsch" title="13,921 reputation">JMarsch</a></author></comment><comment><text><span class="comment-copy">If, like me, you are using Windows 7, you will have to run SQL Server Management Studio as Administrator to avoid getting this error.</span></text><author><a class="comment-user" href="/users/355149/antony" title="766 reputation">Antony</a></author></comment><comment><text><span class="comment-copy">Reproduced on Win7 Pro using SS2008 Express. Same issue for both sqlcmd and SSMS. == Meldung '5120', Ebene '16', Status '101', Server 'DAGO\SQLEXPRESS', Zeile 1 - 'Die physische Datei 'D:\data\mssql\drei.mdf' kann nicht geöffnet werden. Betriebssystemfehler 5: '5(Zugriff verweigert) == Granting full access to the user (who is a member of the local admin group, which has access) fixes the problem. Also, running sqlcmd (or SSMS, I guess) as Administrator doesn't produce this error.</span></text><author><a class="comment-user" href="/users/269126/lumi" title="8,616 reputation">Lumi</a></author></comment><comment><text><span class="comment-copy">Anthony Highsky has the answer. Just need to be sure to run Management Studio as an Administrator.</span></text><author><a class="comment-user" href="/users/82696/james" title="3,859 reputation">James</a></author></comment><comment><text><span class="comment-copy">Same problem, and solution, for me.  2008R2, Win 7, etc.  Just added myself explicitly to the security list, and it worked.  I suppose that SQL Server can read them, once attached, but not under my credentials when attaching?</span></text><author><a class="comment-user" href="/users/15127/andrew-backer" title="3,945 reputation">Andrew Backer</a></author></comment><comment><text><span class="comment-copy">Antony Highsky's solution works on Windows 8 too.</span></text><author><a class="comment-user" href="/users/543205/%c5%81ukasz-wiatrak" title="2,152 reputation">Łukasz Wiatrak</a></author></comment><comment><text><span class="comment-copy">Reproduced in Windows 8.1 Preview 64bit with SQL Server 2012 Development 64bit. This solution worked for me.</span></text><author><a class="comment-user" href="/users/266804/rush-frisby" title="7,231 reputation">Rush Frisby</a></author></comment><comment><text><span class="comment-copy">Running Management Studio as administrator did NOT work for me.  This error occurs when attempting to start the windows service.</span></text><author><a class="comment-user" href="/users/881111/nuzzolilo" title="965 reputation">Nuzzolilo</a></author></comment><comment><text><span class="comment-copy">This worked for me 4 years later on windows 8.1.  Thanks!</span></text><author><a class="comment-user" href="/users/1571391/steve" title="290 reputation">Steve</a></author></comment><comment><text><span class="comment-copy">This helped me on Win 7 Pro using 2012 and 2008 SQL Servers. One other thing that I had to change was that both servers (from the services control panel) needed run as NT Authority and not my username or the access denied error would show up even if file permissions were totally open.</span></text><author><a class="comment-user" href="/users/2985377/jason-d" title="3,638 reputation">Jason D</a></author></comment><comment><text><span class="comment-copy">I had to change the <code>Log On As</code> setting on Windows Service <code>MSSQLSERVER</code> from <code>Network Service</code> to <code>Local System Account</code> and restarted the service. And it works now.</span></text><author><a class="comment-user" href="/users/468718/harsh-baid" title="5,457 reputation">Harsh Baid</a></author></comment><comment><text><span class="comment-copy">I had this problem moving databases to a new folder.  Turned out I needed to grant the NT SERVICE\MSSQLSERVER permissions on the new folder - <a href="http://msdn.microsoft.com/en-us/library/jj219062.aspx" rel="nofollow noreferrer">msdn.microsoft.com/en-us/library/jj219062.aspx</a></span></text><author><a class="comment-user" href="/users/68827/nick" title="1,433 reputation">Nick</a></author></comment><comment><text><span class="comment-copy">Giving the 'NT SERVICE\MSSQLSERVER' account full control on the MSSQL\DATA directory full control fixed the issue in my case. That's the account running the sqlserv.exe process.</span></text><author><a class="comment-user" href="/users/68808/tweezz" title="3,061 reputation">TweeZz</a></author></comment><comment><text><span class="comment-copy">Thanks this was helpful.</span></text><author><a class="comment-user" href="/users/3038042/amete-blessed" title="634 reputation">Amete Blessed</a></author></comment><comment><text><span class="comment-copy">@Antony Highsky - that's it!  Worked for me 6 years later in 2016.</span></text><author><a class="comment-user" href="/users/650891/stephen-chung" title="12,639 reputation">Stephen Chung</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>I'd like to add additional info to the answers that were posted.  </p>
<p><strong>Be careful when detaching the database</strong> because the <em>windows user</em> you are logged in as becomes the only user with permissions to the .mdf file!  The original permissions the .mdf file had which included the user <code>SQLServerMSSQLUser$&lt;computer_name&gt;$&lt;instance_name&gt;</code> and the Administrators account get overwritten by whichever windows user you are logged in as (not sql server user).  Boom, all permissions gone just like that.  So do as others have said and right click your .mdf file and double check the permissions.</p>
<p>I ran into this problem because I used SSMS to connect to the database (doesn't matter which sql server account) and detached the database.  After doing that my windows user was the only one that had any permissions to the .mdf file.  So later on when I tried to attach the db using the sa account, it threw the "access denied" error.  </p>
<p>To keep the original permissions in tact you should take the database offline, then detach, then attach in that order like so:</p>
<pre class="lang-sql prettyprint prettyprinted" style=""><code><span class="kwd">USE</span><span class="pln"> </span><span class="pun">[</span><span class="pln">master</span><span class="pun">]</span><span class="pln">
GO
</span><span class="com">-- kick all users out of the db</span><span class="pln">
</span><span class="kwd">ALTER</span><span class="pln"> </span><span class="kwd">DATABASE</span><span class="pln"> mydb
</span><span class="kwd">SET</span><span class="pln"> SINGLE_USER </span><span class="kwd">WITH</span><span class="pln"> </span><span class="kwd">ROLLBACK</span><span class="pln"> IMMEDIATE 
GO

</span><span class="com">-- Take the Database Offline</span><span class="pln">
</span><span class="kwd">ALTER</span><span class="pln"> </span><span class="kwd">DATABASE</span><span class="pln"> mydb </span><span class="kwd">SET</span><span class="pln"> OFFLINE </span><span class="kwd">WITH</span><span class="pln">
</span><span class="kwd">ROLLBACK</span><span class="pln"> IMMEDIATE
GO

</span><span class="com">-- detach the db</span><span class="pln">
</span><span class="kwd">EXEC</span><span class="pln"> master</span><span class="pun">.</span><span class="pln">dbo</span><span class="pun">.</span><span class="pln">sp_detach_db </span><span class="pun">@</span><span class="pln">dbname </span><span class="pun">=</span><span class="pln"> N</span><span class="str">'mydb'</span><span class="pln">
GO</span></code></pre>
</div></text><author><a href="/users/151325/goku-da-master">goku_da_master</a></author><comments><comment><text><span class="comment-copy">Thanks for this! I think it's vastly easier to get it right if you are also logged in using a SQL Server Authenticated account with serveradmin privileges.</span></text><author><a class="comment-user" href="/users/181528/william-rose" title="780 reputation">William Rose</a></author></comment><comment><text><span class="comment-copy">Unfortunately, this doesn't help me if I originally created the database as 'sa' instead of as a Windows user</span></text><author><a class="comment-user" href="/users/25702/david-gardiner" title="8,608 reputation">David Gardiner</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>This problem is caused by UAC (User Account Control), isn't it? Although your user account is a member of Administrators group, the UAC in Windows 7 doesn't allow you do do administrator things unless you run programs "as administrator". It is not a real bug in SQL Server or Management Studio or whatever. (Although it could possibly know the problem and ask you for elevated permissions instead of just complaining "error 5".)</p>
</div></text><author><a href="/users/576857/al-kepp">Al Kepp</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>Add permission to the folder where your <code>.mdf</code> file is.</p>
<p>Check this name: <code>NT Service\MSSQLSERVER</code></p>
<p>And change the <code>Location</code> to your server name.</p>
</div></text><author><a href="/users/4529423/leonardo">Leonardo</a></author><comments><comment><text><span class="comment-copy">To find the exact account name, since it can vary from instance to instance, run this: <code>SELECT servicename, service_account FROM sys.dm_server_services</code>.</span></text><author><a class="comment-user" href="/users/39785/arve-systad" title="4,246 reputation">Arve Systad</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>A SQL2005 database can be attached in this way in Windows 7:</p>
<pre class="lang-sql prettyprint prettyprinted" style=""><code><span class="kwd">start</span><span class="pln"> menu </span><span class="pun">&gt;</span><span class="pln">
 </span><span class="kwd">all</span><span class="pln"> program </span><span class="pun">&gt;</span><span class="pln">
  Microsoft sql server </span><span class="lit">2005</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln">
   sql server management studio </span><span class="pun">&gt;</span><span class="pln">
    </span><span class="kwd">right</span><span class="pln"> click </span><span class="pun">&gt;</span><span class="pln">
     run </span><span class="kwd">as</span><span class="pln"> administrator </span><span class="pun">&gt;</span><span class="pln">
      click ok</span></code></pre>
<p>And then attached database successfully completed. </p>
</div></text><author><a href="/users/5669276/rahul-garg-aggarwal">Rahul garg aggarwal</a></author><comments><comment><text><span class="comment-copy">This worked with SQL Server 2016 with Management Studio 2008 R2 on Windows 10 :)</span></text><author><a class="comment-user" href="/users/1629357/par" title="320 reputation">par</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>When you login as <code>sa</code> (or any Sql Server account), you're functioning as the SQL Server service account, when you're logged in as you, you have the permissions of your account.  For some reason you don't have the appropriate file access but the service account does.</p>
</div></text><author><a href="/users/13249/nick-craver">Nick Craver</a></author><comments><comment><text><span class="comment-copy">NTFS issue was the first thing that I thought as well, but that does't seem to be the issue:  I am a member of the local admins group, and I verified that admins have "full control" permissions on the mdf and ldf files.  Also, I am the owner of the files -- I had just created a directory and copied the mdf/ldf files to their location myself.</span></text><author><a class="comment-user owner" href="/users/67038/jmarsch" title="13,921 reputation">JMarsch</a></author></comment><comment><text><span class="comment-copy">@JMarsch: @Nick is saying that 'sa' has a set of SQLSERVER RIGHTS -- not NTFS rights -- which your account does not have.</span></text><author><a class="comment-user" href="/users/234025/trevoke" title="3,400 reputation">Trevoke</a></author></comment><comment><text><span class="comment-copy">@Trevoke:  I'm with you.  If that's the case, then what rights would I need to assign to my user account? (I'm already assigned to the sysadmin role)</span></text><author><a class="comment-user owner" href="/users/67038/jmarsch" title="13,921 reputation">JMarsch</a></author></comment><comment><text><span class="comment-copy">Old answer, this, but for people like myself five minutes ago: you can find the exact service user name by running <code>SELECT servicename, service_account FROM sys.dm_server_services</code></span></text><author><a class="comment-user" href="/users/39785/arve-systad" title="4,246 reputation">Arve Systad</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>Run SQL Server Management Studio as an Administrator. (right click-&gt; run as administrator) worked for me with Windows 7 - SQL server 2008 R2</p>
</div></text><author><a href="/users/3106755/rolwin-c">Rolwin C</a></author><comments><comment><text><span class="comment-copy">This answer should be upvoted. Running the SSMS as Administrator is a work around that replicates this answer. Microsoft reports this as "expected behaviour" here: <a href="https://connect.microsoft.com/SQLServer/feedback/details/539703/access-denied-attaching-a-database-when-permissions-are-inherited" rel="nofollow noreferrer">link</a></span></text><author><a class="comment-user" href="/users/3489770/freetext" title="71 reputation">FreeText</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>The <code>sa</code> user uses NTFS accounts <code>SQLServerMSSQLUser$&lt;computer_name&gt;$&lt;instance_name&gt;</code> and <code>SQLServerSQLAgentUser$&lt;computer_name&gt;$&lt;instance_name&gt;</code> to access the database files. You may want to try adding permissions for one or both these users. </p>
<p>I don't know if solves your problem since you say you have no problems with the <code>sa</code> user, but I hope it helps.</p>
</div></text><author><a href="/users/4880/djeidot">djeidot</a></author><comments><comment><text><span class="comment-copy">+1 because your comment helped me to find the answer.  I will post my findings to this thread.</span></text><author><a class="comment-user owner" href="/users/67038/jmarsch" title="13,921 reputation">JMarsch</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>With me
- Running on window 8
- RIght click SQL Server Manager Studio -&gt; Run with admin. -&gt; attach no problems</p>
</div></text><author><a href="/users/1727836/grey-wolf">Grey Wolf</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>it can be <strong>fixed easly</strong> but radicaly, just go to the folder where you have stored <strong>mdf file</strong>. select file-&gt; Right click -&gt;click on properties and <strong>give full permissions to file for logged in user Security</strong>.</p>
</div></text><author><a href="/users/2630447/ema-h">Ema.H</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>I found this solution: Right click on folder where you store your .mdf file --&gt; click Properties --&gt; choose Security tab, click Edit... and give it full control.
Hope this helps!</p>
</div></text><author><a href="/users/3843463/quokka">quokka</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>Every time I have run into this issue was when attempting to attach a database that is in a different directory from the default database directory that is setup in SQL server.</p>
<p>I would highly recommend that instead of jacking with permissions on various directories and accounts that you simply move your data file into the directory that sql server expects to find it.</p>
</div></text><author><a href="/users/2424/notme">NotMe</a></author><comments><comment><text><span class="comment-copy">In a lot of situations, I would agree with your point, but with SQL server, you often want to be able to locate your databases on different spindles or volumes for scaleability.  In fact, it's a common practice to put the transaction log on a separate spindle from the database in order to improve transaction throughput.</span></text><author><a class="comment-user owner" href="/users/67038/jmarsch" title="13,921 reputation">JMarsch</a></author></comment><comment><text><span class="comment-copy">@JMarsch: Yes.. the directories are actually configurable thorugh the Server Properties &gt; Database Settings tab for default data and log locations...</span></text><author><a class="comment-user" href="/users/2424/notme" title="71,002 reputation">NotMe</a></author></comment><comment><text><span class="comment-copy">That covers defaults, but that's only defaults.  It is completely acceptable to put dbs elsewhere, and really not even that uncommon if you have your server managing more than 1 actively used database.</span></text><author><a class="comment-user owner" href="/users/67038/jmarsch" title="13,921 reputation">JMarsch</a></author></comment><comment><text><span class="comment-copy">I have this same problem even with the default sql server directory: c:\Program Files\Microsoft SQL Server\MSSQL10_50.SPATIAL_IM\MSSQL\DATA\mydb.mdf on win7.</span></text><author><a class="comment-user" href="/users/151325/goku-da-master" title="1,962 reputation">goku_da_master</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>For what it's worth to anyone having the particular variation of this problem that I had:</p>
<ul>
<li>SQL Express 2008</li>
<li>Visual Studio 2010 Premium</li>
</ul>
<p>Through the context menu of the App_data folder I had created a SQL Express database for debugging purposes. The connection string (used by NHibernate) was as follows:</p>
<pre class="lang-sql prettyprint prettyprinted" style=""><code><span class="pln">Server</span><span class="pun">=.\</span><span class="pln">SQLExpress</span><span class="pun">;</span><span class="pln">
AttachDbFilename</span><span class="pun">=|</span><span class="pln">DataDirectory</span><span class="pun">|</span><span class="pln">DebugDatabase</span><span class="pun">.</span><span class="pln">mdf</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">Database</span><span class="pun">=</span><span class="pln">DebugDatabase</span><span class="pun">;</span><span class="pln">
Trusted_Connection</span><span class="pun">=</span><span class="pln">Yes</span><span class="pun">;</span></code></pre>
<p>This gave me the same "Access denied" error on the database file. I tried giving various users Full Control to the folder and files, at one point even to "Everyone". Nothing helped, so I removed the added permissions again.</p>
<p><strong>What finally solved it</strong> was to open the Server Explorer in Visual Studio, then connect to the MDF, and detach it again. After I'd done that my web app could access the database just fine.</p>
<p>PS. Credits go to <a href="http://learningsqlserver.wordpress.com/2011/02/13/how-can-i-open-mdf-and-ldf-files-in-sql-server-attach-tutorial-troublshooting/" rel="nofollow">this blog post</a> I found while googling this particular problem, triggering the idea to attach/detach the database to solve the issue.</p>
</div></text><author><a href="/users/419956/jeroen">Jeroen</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>I just wanted to add this information as well.</p>
<p><a href="http://www.mssqltips.com/sqlservertip/2528/database-attach-failure-in-sql-server-2008-r2/" rel="nofollow">http://www.mssqltips.com/sqlservertip/2528/database-attach-failure-in-sql-server-2008-r2/</a></p>
<p>Solution</p>
<p>You get this error because two different logins did the detach and attach operations. So the files, when detached, were owned by the first login, but the attach failed because the login that was used was not the owner of the mdf and ldf files.</p>
<p>When we detach database files, the owner becomes the person who did the detach command, so to resolve the issue we need to change or add the other login as the owner of the mdf and ldf files.</p>
<p>Right click on the "filename.mdf" file and select properties to check the permissions of the mdf file.  Here we can see that only one account has permission to the "filename.mdf" file because that was the account that was used to detach the database.</p>
<p>To resolve this issue, click on the Add... button to add the other login or any other login needed and give the login Full Control.  You should do this for the "ldf" file as well.  Once you have completed this task click the OK button. (Note for other OS versions you may have an Edit option , click this first and then you will see the Add... option.)</p>
</div></text><author><a href="/users/92189">stormwild</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>I had the same issue when attaching a database. It wasn't a SQL issue it was an account issue. Go to the panel control/User Account Control Settings/Set to "never notify". Finally,restart the computer and it worked for me.</p>
</div></text><author><a href="/users/923863/paola">Paola</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>I attached the mdf file by right clicking the database and removing the log file 
AdventureWorks2012_Data_log.ldf in the wizard . The mdf file was placed in the following location </p>
<pre class="lang-sql prettyprint prettyprinted" style=""><code><span class="pln">    C</span><span class="pun">:\</span><span class="pln">Program Files</span><span class="pun">\</span><span class="pln">Microsoft SQL Server</span><span class="pun">\</span><span class="pln">MSSQL10</span><span class="pun">.</span><span class="pln">SQLEXPRESS</span><span class="pun">\</span><span class="pln">MSSQL</span><span class="pun">\</span><span class="pln">DATA</span></code></pre>
<p>The above method helped me to resolve the issue .</p>
</div></text><author><a href="/users/1134928/praveen">praveen</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>I was reading <a href="http://technet.microsoft.com/en-us/library/cc966507.aspx" rel="nofollow noreferrer">this page</a> and they have an interesting sentence in there:</p>
<blockquote>
<p>Caution: Be very selective when adding
  users to these roles. For example,
  sysadmin maps out to dbo in every
  database and is the equivalent of
  logging in using the sa account.</p>
</blockquote>
<p>Of course, they also have this:</p>
<blockquote>
<p>Permissions that are granted to users
  and roles and are database specific.
  All permissions are cumulative with
  the exception of a DENY. A denied
  permission at either a user level or
  at a role level overrides the same
  permission granted via other role
  memberships with the exception of the
  sysadmin fixed server role. (A
  sysadmin retains all permissions, even
  if a role they are a member of has a
  DENY permission.) </p>
</blockquote>
<p>So if you're a domain admin and in SQL 'sysadmin' group, the world should be your crustacean.</p>
<p>Of course, according to Microsoft, you should be taking a quick look at these two pages:<br/>
<a href="http://msftdbprodsamples.codeplex.com/wikipage?title=Database%20Prerequisites&amp;referringTitle=Home" rel="nofollow noreferrer">Link to Database Prerequisites</a> </p>
<p><a href="http://msftdbprodsamples.codeplex.com/wikipage?title=Installing%20Databases&amp;referringTitle=Home" rel="nofollow noreferrer">Link to Installing Databases</a></p>
<p>You're being naughty and trying to attach them manually :) Seriously though, do you have all the prerequisites for the AdventureWorks2008 database?<br/>
I suspect this is just another Microsoft oddity/edge case, but I could be wrong.</p>
</div></text><author><a href="/users/234025/trevoke">Trevoke</a></author><comments><comment><text><span class="comment-copy">+1 because your comment helped me to find the answer. I will post my findings to this thread. BTW (I was being "naughty" due to very strange policies where I work -- the adventureworks database is distributed as an exe. I can't download exe's. (I can download zip files and MSI files, so I don't see how the exe filtering really does anythign other than get in the way, but those are the rules).  Anyway, I could get the raw mdf files as zips from codeplex, and that's when I ran onto this little curiosity.</span></text><author><a class="comment-user owner" href="/users/67038/jmarsch" title="13,921 reputation">JMarsch</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>This sounds like NTFS permissions. It usually means your SQL Server service account has read only access to the file (note that SQL Server uses the same service account to access database files regardless of how you log in). Are you sure you didn't change the folder permissions in between logging in as yourself and logging in as sa? If you detach and try again, does it still have the same problem?</p>
</div></text><author><a href="/users/287081/adrian-oconnor">Adrian O'Connor</a></author><comments><comment><text><span class="comment-copy">In my case, no -- I re-did it serveral times to make sure.  The issue was that my account only had access to the files through a level of indirection -- I was a member of group Domain Admin.  Domain Admin was a member of the Local Administrators group on the machine, and Local Admins (and system) had full control to the folder. (so there were 2 levels of group indirection).  If I assigned permissions to myself directly, it worked, if I removed them, I could still copy/delete the files from Explorere, etc, but SQL Server could not load them.</span></text><author><a class="comment-user owner" href="/users/67038/jmarsch" title="13,921 reputation">JMarsch</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>It is in fact NTFS permissions, and a strange bug in SQL Server. I'm not sure the above bug report is accurate, or may refer to an additional bug.</p>
<p>To resolve this on Windows 7, I ran SQL Server Management Studio normally (not as Administrator). I then attempted to Attach the MDF file. In the process, I used the UI rather than pasting in the path. I noticed that the path was cut off from me. This is because the MS SQL Server (SQLServerMSSQLUser$machinename$SQLEXPRESS) user that the software adds for you does not have permissions to access the folder (in this case a folder deep in my own user folders).</p>
<p>Pasting the path and proceeding results in the above error. So - I gave the MS SQL Server user permissions to read starting from the first directory it was denied from (my user folder). I then immediately cancelled the propagation operation because it can take an eternity, and again applied read permissions to the next subfolder necessary, and let that propagate fully.</p>
<p>Finally, I gave the MS SQL Server user Modify permissions to the .mdf and .ldf files for the db.</p>
<p>I can now Attach to the database files.</p>
</div></text><author><a href="/users/176877/chris-moschini">Chris Moschini</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>I got this error as sa.
In my case, security didn't matter.
I added everyone full control to the mdf and ldf files,
and attach went fine.</p>
</div></text><author><a href="/users/1045881/toddmo">toddmo</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>If you run sql server 2012 you can get this error by trying to attach an older version of an mdf-file. ex an mdf file from sql server 2008.</p>
</div></text><author><a href="/users/437710/erik-forsmyr">Erik Forsmyr</a></author><comments><comment><text><span class="comment-copy">I think that part was relatively self explanatory. it would be good to know how to sort it out.</span></text><author><a class="comment-user" href="/users/996194/dansan" title="415 reputation">dansan</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>I have solved the problem by just move the .mdf file that you want to attach to the public folder, in my case I moved it to the users/public folder. Then I attach it from there without any problem. Hope this helps.</p>
</div></text><author><a href="/users/2716510/databaseuser">databaseUser</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>For those who could not fix the problem with the other solutions here, the following fix worked for me:</p>
<p>Go to your "DATA" folder in your SQL Server installation, right click, properties, security tab, and add full control permissions for the "NETWORK SERVICE" user.</p>
<p><a href="http://decoding.wordpress.com/2008/08/25/sql-server-2005-expess-how-to-fix-error-3417/" rel="nofollow">http://decoding.wordpress.com/2008/08/25/sql-server-2005-expess-how-to-fix-error-3417/</a></p>
<p>(The above link is for SQL 2005, but this fixed a SQL 2008 R2 installation for me).</p>
<p>Some additional info: This problem showed up for me after replacing a secondary hard drive (which the SQL installation was on).  I copied all the files, and restored the original drive letter to the new hard disk.  However, the security permissions were not copied over.  I think next time I will use a better method of copying data.  </p>
</div></text><author><a href="/users/881111/nuzzolilo">Nuzzolilo</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>I was able to get around this error by moving the MDF &amp; LDF file I was attaching outside of the Win7 My Documents folder.</p>
</div></text><author><a href="/users/624948/seanfromit">SeanFromIT</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>In my case what solved the problem was the folowing:</p>
<pre class="lang-sql prettyprint prettyprinted" style=""><code><span class="kwd">USE</span><span class="pln"> </span><span class="pun">[</span><span class="pln">master</span><span class="pun">]</span><span class="pln">
GO
</span><span class="kwd">CREATE</span><span class="pln"> </span><span class="kwd">DATABASE</span><span class="pln"> </span><span class="pun">[</span><span class="pln">AdventureWorks2008R2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">ON</span><span class="pln">
</span><span class="pun">(</span><span class="pln"> FILENAME </span><span class="pun">=</span><span class="pln"> </span><span class="str">'C:\Program Files\Microsfot SQL Server\MSSQL10_50.SQLEXPRESS\MSSQL\DATA\AdventureWors2008R2_Data.mdf'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">FOR</span><span class="pln"> ATTACH_REBUILD_LOG</span></code></pre>
</div></text><author><a href="/users/3190502/nick">Nick_</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>Copy Database to an other folder and attach or Log in SQLServer with "Windows Authentication"</p>
<p><img alt="enter image description here" src="https://i.stack.imgur.com/OJpli.png"/></p>
</div></text><author><a href="/users/2246088/ch%c6%b0a-bi%e1%ba%bft">Chưa biết</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>I've had the same issue when re-attaching database after detaching it and moving ldf and mdf files from drive C to F. </p>
<p>In order to fix it I had to add OWNER RIGHTS principal to both files and gave it full control over them in the Security tab of the Properties dialog.</p>
</div></text><author><a href="/users/1062175/art">Art</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>I moved a database mdf from the default Data folder to my asp.net app_data folder and ran into this problem trying to set the database back online. </p>
<p>I compared the security settings of the other file databases in the original location to the moved files and noticed that MSSQL$SQLEXPRESS was not assigned permissions to the files in their new location. I added Full control for "NT SERVICE\MSSQL$SQLEXPRESS" (must include that NT SERVICE) and it attached just fine.</p>
<p>It appears that the original Data folder has these permissions and the files inherit it. Move the files and the inheritance breaks of course.</p>
<p>I checked another project's mdf file which I created directly into its app_data folder. it does not have MSSQL$SQLEXPRESS permissions. Hmmm. I wonder why SQL Express likes one but not the other?</p>
</div></text><author><a href="/users/129696/brad-mathews">Brad Mathews</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>I struggled with SSMS (2016) to attach the AdventureWorks2012 database. But had success with this code:</p>
<p>CREATE DATABASE AdventureWorks2012
    ON PRIMARY (FILENAME='D:\Dev\SQL Server\AdventureWorks2012.mdf')
    FOR ATTACH;</p>
<p>Got it from this article: <a href="https://www.codeproject.com/articles/72465/programmatically-enumerating-attaching-and-detachi" rel="nofollow noreferrer">https://www.codeproject.com/articles/72465/programmatically-enumerating-attaching-and-detachi</a> </p>
</div></text><author><a href="/users/7476941/michael-melio">Michael Melio</a></author><comments/></answer></answers></post>