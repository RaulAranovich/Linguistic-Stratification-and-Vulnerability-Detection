<?xml version="1.0" encoding="utf-8"?>
<post><title>security - Is it possible to check if an email is confirmed on Facebook? - Stack Overflow</title><question><text><div class="post-text" itemprop="text">
<h1>Update</h1>
<p>This was reported to Facebook via <a href="https://www.facebook.com/whitehat/report/" rel="noreferrer">https://www.facebook.com/whitehat/report/</a> on Dec 16th 2013 and Facebook responded on Dec 17th that <strong>the bug has long since been fixed</strong>.</p>
<p>I have retested this with my Facebook account (that I still haven't verified the email address on) and when using the <a href="https://developers.facebook.com/tools/explorer" rel="noreferrer">Grap API Explorer tool</a> it is not possible to get the email address of this account using the Graph API or using a FQL query.</p>
<p><strong>Conclusion:</strong> The email address you get from Facebook using the Graph API or a FQL query is a verified email. If an account hasn't verified it's email yet it's not possible to get it. </p>
<h1>Original Post</h1>
<p>I am making a web app with SSO that is offering the user to sign in with either Google or Facebook. I would like users who have both types of accounts to show up as the same user in my system regardless of which identity they log in with. To achieve this I'm thinking of using the email address as the identifier to know if I should create a new account or if the user already exists.</p>
<p>To not introduce any security problems I must know that the email address is verified and actually belongs to the user. For Google the <a href="https://developers.google.com/accounts/docs/OAuth2Login#userinfocall" rel="noreferrer">userinfo API</a> can tell me if an email is verified or not, so there's no problem here. But I can not find anything like this in the <a href="http://developers.facebook.com/docs/reference/api/" rel="noreferrer">Facebook Graph API</a>.</p>
<p><strong>Is it possible to know if an email address is confirmed on Facebook?</strong></p>
<p>I know that there is a <code>verified</code> field, but that only tells if the account is verified and not the email address.</p>
<p>At first it looked like you are only able to use the Graph API for accounts where the email address has been confirmed. If the address wasn't confirmed I just got an error telling me that I had to confirm the email address first before being able to sign in to any third party site.</p>
<p>However this does not seem to be true for all accounts. In some cases it's possible to get accesses to all parts of Facebook even if you don't have a confirmed email address. One example of this is when you sign up with a <a href="http://my.opera.com/community/" rel="noreferrer">@myopera.com</a> mail address.</p>
<p>When you sign up to Facebook with a @myopera.com email address you get a message that your account has been temporarily locked as soon as you submit the sign up form. To continue you need to provide your phone number to verify your account and to "keep Facebook safe and free from spam" (sorry for the Swedish in the screenshot, this was before I could get into Facebook and change language to English):</p>
<p><img alt="Security check during sign up" src="https://i.stack.imgur.com/fAjbj.png"/> </p>
<p>When you provide your phone number you are logged in and Facebook doesn't nag you any further about that you have to verify your email address.</p>
<p>The only place where you can see that your email address is not yet verified is on the settings page:</p>
<p><img alt="Facebook settings view with unconfirmed email address" src="https://i.stack.imgur.com/YT1k9.png"/></p>
<p>The Mobile Settings that is usually not accessible before you have verified your email address is available and lists the phone number entered during sign up:</p>
<p><img alt="Facebook mobile settings view with unconfirmed email address" src="https://i.stack.imgur.com/VZyAJ.png"/></p>
<p>In addition to this it is also possible to log in to third party sites with an unconfirmed email address:</p>
<p><img alt="Logging in to graph API explorer with an unconfirmed email address" src="https://i.stack.imgur.com/ZkyCo.png"/></p>
<p>When I connect to the graph api with this user I can get the unconfirmed email address and the <code>verified</code> field returns true as expected since I have <a href="http://www.facebook.com/help/247686808605261/" rel="noreferrer">verified the account</a> by adding a phone number. So obviously I can't trust that the email address I get from Facebook really belongs to the user that has the Facebook account.</p>
<p>Is there any other way of knowing if the email address is verified or not or do I have to verify it myself if I want to use it for identifying the user?</p>
</div></text><author><a href="/users/1730966/nibarius">nibarius</a></author><comments><comment><text><span class="comment-copy">If it's only for myopera.com than we can treat these as not-verified even if facebook graph say they're "verified": "true". The question is are there any other exemptions like myopera.com? Also, it makes one wonder why facebook treat them differently?</span></text><author><a class="comment-user" href="/users/275333/guya" title="1,725 reputation">guya</a></author></comment><comment><text><span class="comment-copy">I am in a similar positions where I want to "merge" various accounts. @nibarius, did you manage to come up with a solution? It seems that the only related field from the Graph API is indeed the "verified" property but this does NOT seem to be what's needed here as it actually means something else.</span></text><author><a class="comment-user" href="/users/1107118/ion" title="490 reputation">Ion</a></author></comment><comment><text><span class="comment-copy">@guya, sure it would be possible to treat all myopera.com addresses as not-verified. But as you say it's impossible to know if the same is true for other addresses.</span></text><author><a class="comment-user owner" href="/users/1730966/nibarius" title="2,306 reputation">nibarius</a></author></comment><comment><text><span class="comment-copy">@Ion, no unfortunately I haven't found any solution for this problem.</span></text><author><a class="comment-user owner" href="/users/1730966/nibarius" title="2,306 reputation">nibarius</a></author></comment><comment><text><span class="comment-copy">@nibarius, the temp solution for me was to allow merging with FB only for already logged in users. After that they can use the FB login option.</span></text><author><a class="comment-user" href="/users/1107118/ion" title="490 reputation">Ion</a></author></comment><comment><text><span class="comment-copy">I've reported this security hole to <a href="https://www.facebook.com/whitehat/report/" rel="nofollow noreferrer">facebook.com/whitehat/report</a> If you need to test again, try with a test account at <a href="https://www.facebook.com/whitehat/accounts/" rel="nofollow noreferrer">facebook.com/whitehat/accounts</a></span></text><author><a class="comment-user" href="/users/151312/coolaj86" title="39,529 reputation">CoolAJ86</a></author></comment><comment><text><span class="comment-copy">@CoolAJ86, thanks it didn't strike me that this might actually be a security hole.</span></text><author><a class="comment-user owner" href="/users/1730966/nibarius" title="2,306 reputation">nibarius</a></author></comment><comment><text><span class="comment-copy">I'm not saying I don't trust you, @nibarius, but it would be great if there was an official take on this. I searched and searched Facebook's documentation and found nothing regarding a verified email. This is as close as I can get to the answer: <a href="https://developers.facebook.com/docs/plugins/registration/#named_fields" rel="nofollow noreferrer">developers.facebook.com/docs/plugins/registration/#named_fie‌​lds</a></span></text><author><a class="comment-user" href="/users/1160916/ashitaka" title="14,941 reputation">Ashitaka</a></author></comment><comment><text><span class="comment-copy">@Ashitaka, yes that would indeed be very nice if it was possible to get an public official answer on it.</span></text><author><a class="comment-user owner" href="/users/1730966/nibarius" title="2,306 reputation">nibarius</a></author></comment><comment><text><span class="comment-copy">I just tested it again myself: I first tried to change the email address of my existing Facebook account, but could not select the new address as my primary email without validating it first. I also tried creating a new Facebook account with an unverified email address, and I could not "log in with Facebook" at all before the email was validated. So yes, <b>the Facebook email address can now be trusted as a verified email address</b>.</span></text><author><a class="comment-user" href="/users/759866/benjamin" title="12,691 reputation">Benjamin</a></author></comment></comments></question><answers><answer><text><div class="post-text" itemprop="text">
<p>While not the most optimal way to do it, you could try a workaround by just sending a search and parsing the results:</p>
<pre><code>http://www.facebook.com/search/results.php?q=&lt;email address here&gt;
</code></pre>
<p>You're also subject to any particular privacy settings users have set up for themselves as far as being searchable, but in lieu of no other way ...</p>
</div></text><author><a href="/users/553663/j-scott-elblein">J. Scott Elblein</a></author><comments><comment><text><span class="comment-copy">I did a quick test and it seems like I can't find the user with the unverified email address even if the settings is set to allow people to search for that email (if I understand the facebook settings correctly). So it looks like unverified emails doesn't show up on that search (no false positives), but as you say you might not find other valid and verified email addresses as well depending on the settings. I need to look into this a bit more later on when I get some time for it.</span></text><author><a class="comment-user owner" href="/users/1730966/nibarius" title="2,306 reputation">nibarius</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>I've never used it, but you may be able to check with a FQL query of the user.email_hashes: <a href="http://developers.facebook.com/docs/reference/fql/user" rel="nofollow">http://developers.facebook.com/docs/reference/fql/user</a></p>
</div></text><author><a href="/users/400550/john-syrinek">John Syrinek</a></author><comments><comment><text><span class="comment-copy">Based on that documentation it looks promising. However after some testing it looks like it can't be used after all. As mentioned in the following stackoverflow question it looks like you have to register the emails you want to get hashes for yourself before user.email_hashes returns anything: <a href="http://stackoverflow.com/questions/7620314/email-hashes-and-deprecated-connect-registerusers" title="email hashes and deprecated connect registerusers">stackoverflow.com/questions/7620314/…</a></span></text><author><a class="comment-user owner" href="/users/1730966/nibarius" title="2,306 reputation">nibarius</a></author></comment></comments></answer></answers></post>