<?xml version="1.0" encoding="utf-8"?>
<post><title>security - How do you configure HttpOnly cookies in tomcat / java webapps? - Stack Overflow</title><question><text><div class="post-text" itemprop="text">
<p>After reading Jeff's blog post on <a href="http://www.codinghorror.com/blog/archives/001167.html" rel="noreferrer">Protecting Your Cookies: HttpOnly</a>. I'd like to implement HttpOnly cookies in my web application.</p>
<p>How do you tell tomcat to use http only cookies for sessions?</p>
</div></text><author><a href="/users/1820/cheekysoft">Cheekysoft</a></author><comments/></question><answers><answer><text><div class="post-text" itemprop="text">
<p>httpOnly is supported as of Tomcat 6.0.19 and Tomcat 5.5.28.</p>
<p>See the <a href="http://tomcat.apache.org/tomcat-6.0-doc/changelog.html" rel="noreferrer">changelog</a> entry for bug 44382. </p>
<p>The last comment for bug <a href="https://issues.apache.org/bugzilla/show_bug.cgi?id=44382" rel="noreferrer">44382</a> states, "this has been applied to 5.5.x and will be included in 5.5.28 onwards." However, it does not appear that 5.5.28 has been released.</p>
<p>The httpOnly functionality can be enabled for all webapps in <strong>conf/context.xml</strong>:</p>
<pre class="lang-java prettyprint prettyprinted" style=""><code><span class="pun">&lt;</span><span class="typ">Context</span><span class="pln"> useHttpOnly</span><span class="pun">=</span><span class="str">"true"</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">...</span><span class="pln">
</span><span class="pun">&lt;/</span><span class="typ">Context</span><span class="pun">&gt;</span></code></pre>
<p>My interpretation is that it also works for an individual context by setting it on the desired <strong><em>Context</em></strong> entry in <strong>conf/server.xml</strong> (in the same manner as above).</p>
</div></text><author><a href="/users/4362/jt">jt.</a></author><comments><comment><text><span class="comment-copy">I'm running Tomcat 5.5.36. This useHttpOnly attribute seems to work only for JSESSIONID cookie. I added this flag on all my contexts to make sure all cookies would be added the "; HttpOnly" at the end. However, only JSESSIONID was affected as follows:  <code>Set-Cookie=</code> JSESSIONID=25E8F...; Path=/custompath; HttpOnly mycustomcookie1=xxxxxxx; Path=/ mycustomcookie2=1351101062602; Path=/ mycustomcookie3=0; Path=/ mycustomcookie4=1; Path=/; Secure mycustomcookie5=4000; Expires=Sat, 22-Oct-2022 17:51:02 GMT; Path=/  Is anything else I'm doing wrong?</span></text><author><a class="comment-user" href="/users/369824/leo-holanda" title="1,568 reputation">Leo Holanda</a></author></comment><comment><text><span class="comment-copy">This documentation seems to indicate that the useHttpOnly flag only pertains to the session id cookie: <a href="http://tomcat.apache.org/tomcat-5.5-doc/config/context.html#Common_Attributes" rel="nofollow noreferrer">tomcat.apache.org/tomcat-5.5-doc/config/…</a> I think this was a stop-gap measure intended to protect the session cookie. The ability to flag cookies as HttpOnly wasn't part of the Servlet spec until 3.0 (covered by Tomcat 7): <a href="http://today.java.net/pub/a/today/2008/10/14/introduction-to-servlet-3.html#other-miscellaneous-changes" rel="nofollow noreferrer">today.java.net/pub/a/today/2008/10/14/…</a></span></text><author><a class="comment-user" href="/users/4362/jt" title="4,513 reputation">jt.</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<blockquote>
<p><strong>Update: The JSESSIONID stuff here is
  only for older containers. Please use
  jt's currently accepted answer unless
  you are using &lt; Tomcat 6.0.19 or &lt; Tomcat
  5.5.28 or another container that does not support HttpOnly JSESSIONID cookies as a config option.</strong></p>
</blockquote>
<p>When setting cookies in your app, use</p>
<pre class="lang-java prettyprint prettyprinted" style=""><code><span class="pln">response</span><span class="pun">.</span><span class="pln">setHeader</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Set-Cookie"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"name=value; HttpOnly"</span><span class="pun">);</span></code></pre>
<p>However, in many webapps, the most important cookie is the session identifier, which is automatically set by the container as the JSESSIONID cookie.</p>
<p>If you only use this cookie, you can write a ServletFilter to re-set the cookies on the way out, forcing JSESSIONID to HttpOnly. The page at <strike><a href="http://keepitlocked.net/archive/2007/11/05/java-and-httponly.aspx" rel="noreferrer">http://keepitlocked.net/archive/2007/11/05/java-and-httponly.aspx</a></strike> <a href="http://alexsmolen.com/blog/?p=16" rel="noreferrer">http://alexsmolen.com/blog/?p=16</a> suggests adding the following in a filter.</p>
<pre class="lang-java prettyprint prettyprinted" style=""><code><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">response</span><span class="pun">.</span><span class="pln">containsHeader</span><span class="pun">(</span><span class="pln"> </span><span class="str">"SET-COOKIE"</span><span class="pln"> </span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="typ">String</span><span class="pln"> sessionid </span><span class="pun">=</span><span class="pln"> request</span><span class="pun">.</span><span class="pln">getSession</span><span class="pun">().</span><span class="pln">getId</span><span class="pun">();</span><span class="pln">
  response</span><span class="pun">.</span><span class="pln">setHeader</span><span class="pun">(</span><span class="pln"> </span><span class="str">"SET-COOKIE"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"JSESSIONID="</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> sessionid 
                      </span><span class="pun">+</span><span class="pln"> </span><span class="str">";Path=/&lt;whatever&gt;; Secure; HttpOnly"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span></code></pre>
<p>but note that this will overwrite all cookies and only set what you state here in this filter. </p>
<p>If you use additional cookies to the JSESSIONID cookie, then you'll need to extend this code to set all the cookies in the filter. This is not a great solution in the case of multiple-cookies, but is a perhaps an acceptable quick-fix for the JSESSIONID-only setup. </p>
<p>Please note that as your code evolves over time, there's a nasty hidden bug waiting for you when you forget about this filter and try and set another cookie somewhere else in your code. Of course, it won't get set.</p>
<p>This really is a hack though. If you do use Tomcat and can compile it, then take a look at Shabaz's excellent suggestion to patch HttpOnly support into Tomcat.</p>
</div></text><author><a href="/users/1820/cheekysoft">Cheekysoft</a></author><comments><comment><text><span class="comment-copy">This code removes the ;Secure flag thus rendering the usage of https pointless.</span></text><author><a class="comment-user" href="/users/177701/hendrik-brummermann" title="5,623 reputation">Hendrik Brummermann</a></author></comment><comment><text><span class="comment-copy">In Servlet 3.0 complaint application servers I can set the HttpOnly and secure flags for the session cookie (JSESSIONID) by adding the following to the web.xml:  &lt;session-config&gt;   &lt;cookie-config&gt;     &lt;secure&gt;true&lt;/secure&gt;     &lt;http-only&gt;true&lt;/http-only&gt;   &lt;/cookie-config&gt; &lt;/session-config&gt;</span></text><author><a class="comment-user" href="/users/1924694/roger-jin" title="395 reputation">Roger Jin</a></author></comment><comment><text><span class="comment-copy">@RogerJin please post this as a new answer, this 6-year old answer is getting increasingly out-of-date.</span></text><author><a class="comment-user" href="/users/1820/cheekysoft" title="23,093 reputation">Cheekysoft</a></author></comment><comment><text><span class="comment-copy">Be careful with setHeader because it deletes all the previous headers with the same name. For example, it can delete the JSESSIONID cookie when you set a custom cookie. Instead use response.addHeader() for custom cookies</span></text><author><a class="comment-user" href="/users/395769/dpinya" title="194 reputation">dpinya</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>Please be careful not to overwrite the ";secure" cookie flag in https-sessions. This flag prevents the browser from sending the cookie over an unencrypted http connection, basically rendering the use of https for legit requests pointless.</p>
<pre class="lang-java prettyprint prettyprinted" style=""><code><span class="kwd">private</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> rewriteCookieToHeader</span><span class="pun">(</span><span class="typ">HttpServletRequest</span><span class="pln"> request</span><span class="pun">,</span><span class="pln"> </span><span class="typ">HttpServletResponse</span><span class="pln"> response</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">response</span><span class="pun">.</span><span class="pln">containsHeader</span><span class="pun">(</span><span class="str">"SET-COOKIE"</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">String</span><span class="pln"> sessionid </span><span class="pun">=</span><span class="pln"> request</span><span class="pun">.</span><span class="pln">getSession</span><span class="pun">().</span><span class="pln">getId</span><span class="pun">();</span><span class="pln">
        </span><span class="typ">String</span><span class="pln"> contextPath </span><span class="pun">=</span><span class="pln"> request</span><span class="pun">.</span><span class="pln">getContextPath</span><span class="pun">();</span><span class="pln">
        </span><span class="typ">String</span><span class="pln"> secure </span><span class="pun">=</span><span class="pln"> </span><span class="str">""</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">request</span><span class="pun">.</span><span class="pln">isSecure</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            secure </span><span class="pun">=</span><span class="pln"> </span><span class="str">"; Secure"</span><span class="pun">;</span><span class="pln"> 
        </span><span class="pun">}</span><span class="pln">
        response</span><span class="pun">.</span><span class="pln">setHeader</span><span class="pun">(</span><span class="str">"SET-COOKIE"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"JSESSIONID="</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> sessionid
                         </span><span class="pun">+</span><span class="pln"> </span><span class="str">"; Path="</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> contextPath </span><span class="pun">+</span><span class="pln"> </span><span class="str">"; HttpOnly"</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> secure</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div></text><author><a href="/users/177701/hendrik-brummermann">Hendrik Brummermann</a></author><comments><comment><text><span class="comment-copy">Note that using <code>request.isSecure()</code> is not always accurate. Consider a load-balanced node behind the LB that performs SSL acceleration. The request from the browser to the load balancer will come over HTTPS, while the request between load balancer and the actual server will come over plain HTTP. This will result in <code>request.isSecure()</code> being <code>false</code>, while the browser is using SSL.</span></text><author><a class="comment-user" href="/users/383673/anton" title="880 reputation">Anton</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>For session cookies it doesn't seem to be supported in Tomcat yet. See the bug report <a href="https://issues.apache.org/bugzilla/show_bug.cgi?id=44382" rel="noreferrer">Need to add support for HTTPOnly session cookie parameter</a>. A somewhat involved work-around for now can be found <a href="http://manicode.blogspot.com/2008/03/httponly-support-for-apache-tomcat.html" rel="noreferrer">here</a>, which basically boils down to manually patching Tomcat. Can't really find an easy way to do it at this moment at this point I'm affraid. </p>
<p>To summarize the work-around, it involves downloading the 5.5 <a href="http://tomcat.apache.org/tomcat-5.5-doc/building.html" rel="noreferrer">source</a>, and then change the source in the following places:</p>
<p><em>org.apache.catalina.connector.Request.java</em></p>
<pre class="lang-java prettyprint prettyprinted" style=""><code><span class="com">//this is what needs to be changed</span><span class="pln">
</span><span class="com">//response.addCookieInternal(cookie);</span><span class="pln">

</span><span class="com">//this is whats new</span><span class="pln">
response</span><span class="pun">.</span><span class="pln">addCookieInternal</span><span class="pun">(</span><span class="pln">cookie</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
<p><em>org.apache.catalina.connectorResponse.addCookieInternal</em></p>
<pre class="lang-java prettyprint prettyprinted" style=""><code><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> addCookieInternal</span><span class="pun">(</span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Cookie</span><span class="pln"> cookie</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
addCookieInternal</span><span class="pun">(</span><span class="pln">cookie</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> addCookieInternal</span><span class="pun">(</span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Cookie</span><span class="pln"> cookie</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> </span><span class="typ">HTTPOnly</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isCommitted</span><span class="pun">())</span><span class="pln">
</span><span class="kwd">return</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">final</span><span class="pln"> </span><span class="typ">StringBuffer</span><span class="pln"> sb </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringBuffer</span><span class="pun">();</span><span class="pln">
</span><span class="com">//web application code can receive a IllegalArgumentException</span><span class="pln">
</span><span class="com">//from the appendCookieValue invokation</span><span class="pln">
</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="typ">SecurityUtil</span><span class="pun">.</span><span class="pln">isPackageProtectionEnabled</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="typ">AccessController</span><span class="pun">.</span><span class="pln">doPrivileged</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">PrivilegedAction</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> run</span><span class="pun">(){</span><span class="pln">
</span><span class="typ">ServerCookie</span><span class="pun">.</span><span class="pln">appendCookieValue
</span><span class="pun">(</span><span class="pln">sb</span><span class="pun">,</span><span class="pln"> cookie</span><span class="pun">.</span><span class="pln">getVersion</span><span class="pun">(),</span><span class="pln"> cookie</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">(),</span><span class="pln">
cookie</span><span class="pun">.</span><span class="pln">getValue</span><span class="pun">(),</span><span class="pln"> cookie</span><span class="pun">.</span><span class="pln">getPath</span><span class="pun">(),</span><span class="pln">
cookie</span><span class="pun">.</span><span class="pln">getDomain</span><span class="pun">(),</span><span class="pln"> cookie</span><span class="pun">.</span><span class="pln">getComment</span><span class="pun">(),</span><span class="pln">
cookie</span><span class="pun">.</span><span class="pln">getMaxAge</span><span class="pun">(),</span><span class="pln"> cookie</span><span class="pun">.</span><span class="pln">getSecure</span><span class="pun">());</span><span class="pln">
</span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="pun">});</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="typ">ServerCookie</span><span class="pun">.</span><span class="pln">appendCookieValue
</span><span class="pun">(</span><span class="pln">sb</span><span class="pun">,</span><span class="pln"> cookie</span><span class="pun">.</span><span class="pln">getVersion</span><span class="pun">(),</span><span class="pln"> cookie</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">(),</span><span class="pln"> cookie</span><span class="pun">.</span><span class="pln">getValue</span><span class="pun">(),</span><span class="pln">
cookie</span><span class="pun">.</span><span class="pln">getPath</span><span class="pun">(),</span><span class="pln"> cookie</span><span class="pun">.</span><span class="pln">getDomain</span><span class="pun">(),</span><span class="pln"> cookie</span><span class="pun">.</span><span class="pln">getComment</span><span class="pun">(),</span><span class="pln">
cookie</span><span class="pun">.</span><span class="pln">getMaxAge</span><span class="pun">(),</span><span class="pln"> cookie</span><span class="pun">.</span><span class="pln">getSecure</span><span class="pun">());</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="com">//of course, we really need to modify ServerCookie</span><span class="pln">
</span><span class="com">//but this is the general idea</span><span class="pln">
</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="typ">HTTPOnly</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
sb</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="str">"; HttpOnly"</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">//if we reached here, no exception, cookie is valid</span><span class="pln">
</span><span class="com">// the header name is Set-Cookie for both "old" and v.1 ( RFC2109 )</span><span class="pln">
</span><span class="com">// RFC2965 is not supported by browsers and the Servlet spec</span><span class="pln">
</span><span class="com">// asks for 2109.</span><span class="pln">
addHeader</span><span class="pun">(</span><span class="str">"Set-Cookie"</span><span class="pun">,</span><span class="pln"> sb</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">());</span><span class="pln">

cookies</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">cookie</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div></text><author><a href="/users/1827/shabaz">Shabaz</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>If your Serlvet 3.0 web server, like tomcat 7.0+, you can use below in <code>web.xml</code> as:</p>
<pre class="lang-java prettyprint prettyprinted" style=""><code><span class="pun">&lt;</span><span class="pln">session</span><span class="pun">-</span><span class="pln">config</span><span class="pun">&gt;</span><span class="pln">
  </span><span class="pun">&lt;</span><span class="pln">cookie</span><span class="pun">-</span><span class="pln">config</span><span class="pun">&gt;</span><span class="pln">
     </span><span class="pun">&lt;</span><span class="pln">http</span><span class="pun">-</span><span class="pln">only</span><span class="pun">&gt;</span><span class="kwd">true</span><span class="pun">&lt;/</span><span class="pln">http</span><span class="pun">-</span><span class="pln">only</span><span class="pun">&gt;</span><span class="pln">        
     </span><span class="pun">&lt;</span><span class="pln">secure</span><span class="pun">&gt;</span><span class="kwd">true</span><span class="pun">&lt;/</span><span class="pln">secure</span><span class="pun">&gt;</span><span class="pln">        
  </span><span class="pun">&lt;/</span><span class="pln">cookie</span><span class="pun">-</span><span class="pln">config</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">&lt;/</span><span class="pln">session</span><span class="pun">-</span><span class="pln">config</span><span class="pun">&gt;</span></code></pre>
<p>As mentioned in docs:</p>
<blockquote>
<p><strong>HttpOnly</strong>: Specifies whether any session tracking cookies created by
  this web application will be marked as HttpOnly </p>
<p><strong>Secure</strong>: Specifies
  whether any session tracking cookies created by this web application
  will be marked as secure even if   the request that initiated the
  corresponding session is using plain HTTP instead of HTTPS</p>
</blockquote>
<p>Please refer to <a href="http://stackoverflow.com/questions/15510354/how-to-set-httponly-and-session-cookie-for-java-web-appliaction">how to set httponly and session cookie for java web appliaction</a></p>
</div></text><author><a href="/users/2648077/alireza-fattahi">Alireza Fattahi</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>also it should be noted that turning on HttpOnly will break applets that require stateful access back to the jvm.</p>
<p>the Applet http requests will not use the jsessionid cookie and may get assigned to a different tomcat.</p>
</div></text><author><a href="/users/335770/pete-brumm">Pete Brumm</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>For cookies that I am explicitly setting, I switched to use <a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/web/servlet/SimpleCookie.html" rel="nofollow">SimpleCookie</a> provided by <a href="http://shiro.apache.org/" rel="nofollow">Apache Shiro</a>. It does not inherit from javax.servlet.http.Cookie so it takes a bit more juggling to get everything to work correctly however it does provide a property set HttpOnly and it works with Servlet 2.5.</p>
<p>For setting a cookie on a response, rather than doing <code>response.addCookie(cookie)</code> you need to do <code>cookie.saveTo(request, response)</code>.</p>
</div></text><author><a href="/users/9822/jesse-vogt">Jesse Vogt</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>In Tomcat6, You can conditionally enable from your HTTP Listener Class:</p>
<pre class="lang-java prettyprint prettyprinted" style=""><code><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> contextInitialized</span><span class="pun">(</span><span class="typ">ServletContextEvent</span><span class="pln"> event</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                 
   </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Boolean</span><span class="pun">.</span><span class="pln">getBoolean</span><span class="pun">(</span><span class="str">"HTTP_ONLY_SESSION"</span><span class="pun">))</span><span class="pln"> </span><span class="typ">HttpOnlyConfig</span><span class="pun">.</span><span class="pln">enable</span><span class="pun">(</span><span class="pln">event</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
<p>Using this class</p>
<pre class="lang-java prettyprint prettyprinted" style=""><code><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="pln">reflect</span><span class="pun">.</span><span class="typ">Field</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">servlet</span><span class="pun">.</span><span class="typ">ServletContext</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">servlet</span><span class="pun">.</span><span class="typ">ServletContextEvent</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">apache</span><span class="pun">.</span><span class="pln">catalina</span><span class="pun">.</span><span class="pln">core</span><span class="pun">.</span><span class="typ">StandardContext</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">HttpOnlyConfig</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> enable</span><span class="pun">(</span><span class="typ">ServletContextEvent</span><span class="pln"> event</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">ServletContext</span><span class="pln"> servletContext </span><span class="pun">=</span><span class="pln"> event</span><span class="pun">.</span><span class="pln">getServletContext</span><span class="pun">();</span><span class="pln">
        </span><span class="typ">Field</span><span class="pln"> f</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">try</span><span class="pln">
        </span><span class="pun">{</span><span class="pln"> </span><span class="com">// WARNING TOMCAT6 SPECIFIC!!</span><span class="pln">
            f </span><span class="pun">=</span><span class="pln"> servletContext</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">().</span><span class="pln">getDeclaredField</span><span class="pun">(</span><span class="str">"context"</span><span class="pun">);</span><span class="pln">
            f</span><span class="pun">.</span><span class="pln">setAccessible</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">);</span><span class="pln">
            org</span><span class="pun">.</span><span class="pln">apache</span><span class="pun">.</span><span class="pln">catalina</span><span class="pun">.</span><span class="pln">core</span><span class="pun">.</span><span class="typ">ApplicationContext</span><span class="pln"> ac </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">org</span><span class="pun">.</span><span class="pln">apache</span><span class="pun">.</span><span class="pln">catalina</span><span class="pun">.</span><span class="pln">core</span><span class="pun">.</span><span class="typ">ApplicationContext</span><span class="pun">)</span><span class="pln"> f</span><span class="pun">.</span><span class="pln">get</span><span class="pun">(</span><span class="pln">servletContext</span><span class="pun">);</span><span class="pln">
            f </span><span class="pun">=</span><span class="pln"> ac</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">().</span><span class="pln">getDeclaredField</span><span class="pun">(</span><span class="str">"context"</span><span class="pun">);</span><span class="pln">
            f</span><span class="pun">.</span><span class="pln">setAccessible</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">);</span><span class="pln">
            org</span><span class="pun">.</span><span class="pln">apache</span><span class="pun">.</span><span class="pln">catalina</span><span class="pun">.</span><span class="pln">core</span><span class="pun">.</span><span class="typ">StandardContext</span><span class="pln"> sc </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">StandardContext</span><span class="pun">)</span><span class="pln"> f</span><span class="pun">.</span><span class="pln">get</span><span class="pun">(</span><span class="pln">ac</span><span class="pun">);</span><span class="pln">
            sc</span><span class="pun">.</span><span class="pln">setUseHttpOnly</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Exception</span><span class="pln"> e</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
            </span><span class="typ">System</span><span class="pun">.</span><span class="pln">err</span><span class="pun">.</span><span class="pln">print</span><span class="pun">(</span><span class="str">"HttpOnlyConfig cant enable"</span><span class="pun">);</span><span class="pln">
            e</span><span class="pun">.</span><span class="pln">printStackTrace</span><span class="pun">();</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div></text><author><a href="/users/586841/systemsplanet">Systemsplanet</a></author><comments/></answer></answers></post>