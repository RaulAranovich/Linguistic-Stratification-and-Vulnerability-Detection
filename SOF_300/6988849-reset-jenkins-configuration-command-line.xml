<?xml version="1.0" encoding="utf-8"?>
<post><title>security - Reset Jenkins Configuration Command Line - Stack Overflow</title><question><text><div class="post-text" itemprop="text">
<p>Is there a way to reset all (or just disable the security settings) from the command line without a user/password as I have managed to completely lock myself out of <code>Jenkins</code>?</p>
</div></text><author><a href="/users/55075/kenorb">kenorb</a></author><comments/></question><answers><answer><text><div class="post-text" itemprop="text">
<p>The simplest solution is to completely disable security - change <code>true</code> to <code>false</code> in <code>/var/lib/jenkins/config.xml</code> file.</p>
<pre><code>&lt;useSecurity&gt;true&lt;/useSecurity&gt;
</code></pre>
<p>Then just restart Jenkins, go to admin panel and set everything once again.</p>
</div></text><author><a href="/users/504845/nowaker">Nowaker</a></author><comments><comment><text><span class="comment-copy">I needed to restart Jenkins for change to apply.</span></text><author><a class="comment-user" href="/users/413289/or-arbel" title="2,225 reputation">Or Arbel</a></author></comment><comment><text><span class="comment-copy"><code>sudo service jenkins restart</code></span></text><author><a class="comment-user" href="/users/294702/monothreaded" title="3,680 reputation">MonoThreaded</a></author></comment><comment><text><span class="comment-copy">To those who can't find it their config.xml use <code>find / -name "config.xml" </code> in your terminal.</span></text><author><a class="comment-user" href="/users/325545/jjacquet" title="480 reputation">JJacquet</a></author></comment><comment><text><span class="comment-copy">After Changing user Security  tag to false for restart jenking from command prompt --- <a href="http://stackoverflow.com/questions/14869311/start-stop-and-restart-jenkins-service-on-windows" title="start stop and restart jenkins service on windows">stackoverflow.com/questions/14869311/…</a></span></text><author><a class="comment-user" href="/users/4534414/larry-kuk" title="312 reputation">Larry kuk</a></author></comment><comment><text><span class="comment-copy">This leaves your Jenkins installation unsecured while you recreate your configuration. I prefer aruseni's answer below.</span></text><author><a class="comment-user" href="/users/2231950/kontextify" title="195 reputation">kontextify</a></author></comment><comment><text><span class="comment-copy">Also file could be located under ~/.jenkins/ folder</span></text><author><a class="comment-user" href="/users/5091346/andrii-abramov" title="1,897 reputation">Andrii Abramov</a></author></comment><comment><text><span class="comment-copy">On mac when installed with brew the config file is at: /Users/Shared/Jenkins/Home/config.xml</span></text><author><a class="comment-user" href="/users/2980948/lunero" title="372 reputation">Lunero</a></author></comment><comment><text><span class="comment-copy">I just lost the password after setting everything up due to my bad use of lastpass and I just did <code>sudo service jenkins stop</code> then <code>sudo yum remove jenkins</code> and <code>sudo rm -rf /var/lib/jenkins/</code> and then I installed jenkins again in my AMI.</span></text><author><a class="comment-user" href="/users/2055252/nisevi" title="322 reputation">nisevi</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>One other way would be to manually edit the configuration file for your user (e.g. /var/lib/jenkins/users/username/config.xml) and update the contents of <strong>passwordHash</strong>:</p>
<pre><code>&lt;passwordHash&gt;#jbcrypt:$2a$10$razd3L1aXndFfBNHO95aj.IVrFydsxkcQCcLmujmFQzll3hcUrY7S&lt;/passwordHash&gt;
</code></pre>
<p>Once you have done this, just restart Jenkins and log in using this password:</p>
<pre><code>test
</code></pre>
</div></text><author><a href="/users/297435/aruseni">aruseni</a></author><comments><comment><text><span class="comment-copy">thanks, that saved my day</span></text><author><a class="comment-user" href="/users/1184842/jan" title="1,138 reputation">jan</a></author></comment><comment><text><span class="comment-copy">what if this entry is not there - where to actually put it?</span></text><author><a class="comment-user" href="/users/3990012/serup" title="647 reputation">serup</a></author></comment><comment><text><span class="comment-copy">the <code>&lt;passwordHash&gt;</code> xml tag is a child of <code>&lt;hudson.security.HudsonPrivateSecurityRealm_-Details&gt;</code>.  Look at the default admin user for an idea of the total XML structure.</span></text><author><a class="comment-user" href="/users/1470040/ivandov" title="92 reputation">ivandov</a></author></comment><comment><text><span class="comment-copy">This is a good solution that keeps the installation secure. Out of curiosity, how does one generate that password hash?</span></text><author><a class="comment-user" href="/users/2231950/kontextify" title="195 reputation">kontextify</a></author></comment><comment><text><span class="comment-copy">@kontextify check the answer by uckelman</span></text><author><a class="comment-user" href="/users/1761179/basit-ali" title="589 reputation">Basit Ali</a></author></comment><comment><text><span class="comment-copy">Thank you, this is exactly what I needed!</span></text><author><a class="comment-user" href="/users/2187971/matt-cavanagh" title="197 reputation">Matt Cavanagh</a></author></comment><comment><text><span class="comment-copy">Modifying the contents of file present in C:\Users\&lt;USER&gt;\.jenkins\users\admin helped resolve the issue</span></text><author><a class="comment-user" href="/users/3977630/sakshi-singla" title="1,367 reputation">Sakshi Singla</a></author></comment><comment><text><span class="comment-copy">thanks. for the tip. saved me lot of time</span></text><author><a class="comment-user" href="/users/1743786/amilarajans" title="96 reputation">amilarajans</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>I found the file in question located in /var/lib/jenkins called config.xml, modifying that fixed the issue.</p>
</div></text><author><a href="/users/384016/ryanzec">ryanzec</a></author><comments><comment><text><span class="comment-copy">I am using El-Capitan and config.xml couldn't be found in the location</span></text><author><a class="comment-user" href="/users/730807/durai-amuthan-h" title="15,877 reputation">Durai Amuthan.H</a></author></comment><comment><text><span class="comment-copy">@DuraiAmuthan.H Did you install it with bitnami stack?  The config file would be in <code>/Applications/jenkins-2.19.3-0/apps/jenkins/jenkins_home/use‌​rs/admin/config.xml</code></span></text><author><a class="comment-user" href="/users/3906189/siegy22" title="2,562 reputation">siegy22</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>The <code>&lt;passwordHash&gt;</code> element in <code>users/&lt;username&gt;/config.xml</code> will accept data of the format</p>
<pre><code>salt:sha256("password{salt}")
</code></pre>
<p>So, if your salt is <code>bar</code> and your password is <code>foo</code> then you can produce the SHA256 like this:</p>
<pre><code>echo -n 'foo{bar}' | sha256sum
</code></pre>
<p>You should get <code>7f128793bc057556756f4195fb72cdc5bd8c5a74dee655a6bfb59b4a4c4f4349</code> as the result. Take the hash and put it with the salt into <code>&lt;passwordHash&gt;</code>:</p>
<pre><code>&lt;passwordHash&gt;bar:7f128793bc057556756f4195fb72cdc5bd8c5a74dee655a6bfb59b4a4c4f4349&lt;/passwordHash&gt;
</code></pre>
<p>Restart Jenkins, then try logging in with password <code>foo</code>. Then reset your password to something else. (Jenkins uses bcrypt by default, and one round of SHA256 is not a secure way to store passwords. You'll get a bcrypt hash stored when you reset your password.)</p>
</div></text><author><a href="/users/181106/uckelman">uckelman</a></author><comments><comment><text><span class="comment-copy">This doesn't seem to work. an example starts with a salt of #jbscrypt and then defines encrypt fields $2a$10$.  What do these mean?</span></text><author><a class="comment-user" href="/users/16998/jrwren" title="9,464 reputation">jrwren</a></author></comment><comment><text><span class="comment-copy">My answer worked for me. The additional fields you're seeing are for a different hash format. The library Jenkins uses for handling hashed passwords supports more than one format. The jbcrypt format you're referring to is more secure than sha256 with a salt, but the sha256+salt format can be easily produced from the command line---recall that the point of the exercise is to get back into Jenkins, and then change the password from Jenkins' web interface.</span></text><author><a class="comment-user" href="/users/181106/uckelman" title="13,554 reputation">uckelman</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>The answer on modifying was correct. Yet, I think it should be mentioned that <code>/var/lib/jenkins/config.xml</code> looks something like this if you have activated "Project-based Matrix Authorization Strategy". Deleting <code>/var/lib/jenkins/config.xml</code> and restarting jenkins also does the trick. I also deleted the users in <code>/var/lib/jenkins/users</code> to start from scratch.</p>
<pre><code>&lt;authorizationStrategy class="hudson.security.ProjectMatrixAuthorizationStrategy"&gt;
    &lt;permission&gt;hudson.model.Computer.Configure:jenkins-admin&lt;/permission&gt;
    &lt;permission&gt;hudson.model.Computer.Connect:jenkins-admin&lt;/permission&gt;
    &lt;permission&gt;hudson.model.Computer.Create:jenkins-admin&lt;/permission&gt;
    &lt;permission&gt;hudson.model.Computer.Delete:jenkins-admin&lt;/permission&gt;
    &lt;permission&gt;hudson.model.Computer.Disconnect:jenkins-admin&lt;/permission&gt;
    &lt;!-- if this is missing for your user and it is the only one, bad luck --&gt;
    &lt;permission&gt;hudson.model.Hudson.Administer:jenkins-admin&lt;/permission&gt;
    &lt;permission&gt;hudson.model.Hudson.Read:jenkins-admin&lt;/permission&gt;
    &lt;permission&gt;hudson.model.Hudson.RunScripts:jenkins-admin&lt;/permission&gt;
    &lt;permission&gt;hudson.model.Item.Build:jenkins-admin&lt;/permission&gt;
    &lt;permission&gt;hudson.model.Item.Cancel:jenkins-admin&lt;/permission&gt;
    &lt;permission&gt;hudson.model.Item.Configure:jenkins-admin&lt;/permission&gt;
    &lt;permission&gt;hudson.model.Item.Create:jenkins-admin&lt;/permission&gt;
    &lt;permission&gt;hudson.model.Item.Delete:jenkins-admin&lt;/permission&gt;
    &lt;permission&gt;hudson.model.Item.Discover:jenkins-admin&lt;/permission&gt;
    &lt;permission&gt;hudson.model.Item.Read:jenkins-admin&lt;/permission&gt;
    &lt;permission&gt;hudson.model.Item.Workspace:jenkins-admin&lt;/permission&gt;
    &lt;permission&gt;hudson.model.View.Configure:jenkins-admin&lt;/permission&gt;
    &lt;permission&gt;hudson.model.View.Create:jenkins-admin&lt;/permission&gt;
    &lt;permission&gt;hudson.model.View.Delete:jenkins-admin&lt;/permission&gt;
    &lt;permission&gt;hudson.model.View.Read:jenkins-admin&lt;/permission&gt;
  &lt;/authorizationStrategy&gt;
</code></pre>
</div></text><author><a href="/users/637338/user637338">user637338</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>In El-Capitan <em>config.xml</em> can not be found at </p>
<blockquote>
<p>/var/lib/jenkins/</p>
</blockquote>
<p>Its available in </p>
<blockquote>
<p>~/.jenkins</p>
</blockquote>
<p>then after that as other mentioned open the <em>config.xml</em> file and make the following changes</p>
<ul>
<li><p>In this replace <code>&lt;useSecurity&gt;true&lt;/useSecurity&gt;</code> with <code>&lt;useSecurity&gt;false&lt;/useSecurity&gt;</code></p></li>
<li><p>Remove <code>&lt;authorizationStrategy&gt;</code> and <code>&lt;securityRealm&gt;</code></p></li>
<li><p>Save it and restart the jenkins(<em>sudo service jenkins restart</em>)</p></li>
</ul>
</div></text><author><a href="/users/730807/durai-amuthan-h">Durai Amuthan.H</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>To reset it <strong>without disabling security</strong> if you're using matrix permissions (probably easily adaptable to other login methods):</p>
<ol>
<li>In <code>config.xml</code>, set <strong><code>disableSignup</code></strong> to <code>false</code>.</li>
<li><strong>Restart</strong> Jenkins.</li>
<li>Go to the Jenkins web page and <strong>sign up with a new user</strong>.</li>
<li>In <code>config.xml</code>, duplicate one of the <code>&lt;permission&gt;hudson.model.Hudson.Administer:username&lt;/permission&gt;</code> lines and replace <em><code>username</code></em> with the new user.</li>
<li>If it's a private server, set <strong><code>disableSignup</code></strong> back to <code>true</code> in <code>config.xml</code>.</li>
<li><strong>Restart</strong> Jenkins.</li>
<li>Go to the Jenkins web page and <strong>log in as the new user</strong>.</li>
<li><strong>Reset the password</strong> of the original user.</li>
<li><strong>Log in</strong> as the original user.</li>
</ol>
<p>Optional cleanup:</p>
<ol>
<li>Delete the new user.</li>
<li>Delete the temporary <code>&lt;permission&gt;</code> line in <code>config.xml</code>.</li>
</ol>
<p>No securities were harmed during this answer.</p>
</div></text><author><a href="/users/96588/l0b0">l0b0</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>On the offchance you accidentally lock yourself out of Jenkins due to a permission mistake, and you dont have server-side access to switch to the jenkins user or root... You can make a job in Jenkins and add this to the Shell Script:</p>
<pre><code>sed -i 's/&lt;useSecurity&gt;true/&lt;useSecurity&gt;false/' ~/config.xml
</code></pre>
<p>Then click Build Now and restart Jenkins (or the server if you need to!)</p>
</div></text><author><a href="/users/224707/nick">Nick</a></author><comments><comment><text><span class="comment-copy">How do you create a job in Jenkins in case you have yourself locked out of it?</span></text><author><a class="comment-user" href="/users/1744774/gerold-broser" title="5,143 reputation">Gerold Broser</a></author></comment><comment><text><span class="comment-copy">In this case, I had a normal Chrome window logged in and I altered the security settings and tested in an Incognito Window before logging out of the main window. The test did not let me log in, but my sessions persisted in the main window so I could repair the damage.</span></text><author><a class="comment-user" href="/users/224707/nick" title="1,219 reputation">Nick</a></author></comment><comment><text><span class="comment-copy">I believe part of the security settings I'd changed also meant that my auth session no longer had permission to alter Jenkins security configurations.</span></text><author><a class="comment-user" href="/users/224707/nick" title="1,219 reputation">Nick</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>To disable Jenkins security in simple steps in Linux, run these commands:</p>
<pre><code>sudo ex +g/useSecurity/d +g/authorizationStrategy/d -scwq /var/lib/jenkins/config.xml
sudo /etc/init.d/jenkins restart
</code></pre>
<p>It will remove <code>useSecurity</code> and <code>authorizationStrategy</code> lines from your <code>config.xml</code> root config file and restart your Jenkins.</p>
<p>See also: <a href="https://wiki.jenkins-ci.org/display/JENKINS/Disable+security" rel="nofollow">Disable security</a> at Jenkins website</p>
</div></text><author><a href="/users/55075/kenorb">kenorb</a></author><comments><comment><text><span class="comment-copy">thanks dude it works</span></text><author><a class="comment-user" href="/users/4649110/basi" title="176 reputation">Basi</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<pre><code>\.jenkins\secrets\initialAdminPassword
</code></pre>
<p>Copy the password from the initialAdminPassword file and paste it into the Jenkins.</p>
</div></text><author><a href="/users/3244370/shivam">Shivam</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>changing the <code>&lt;useSecurity&gt;true&lt;/useSecurity&gt;</code> to <code>&lt;useSecurity&gt;false&lt;/useSecurity&gt;</code> will not be enough, you should remove <code>&lt;authorizationStrategy&gt;</code> and <code>&lt;securityRealm&gt;</code> elements too and restart your jenkins server by doing <code>sudo service jenkins restart</code> .</p>
<p>remember this, set <code>&lt;usesecurity&gt;</code> to <code>false</code> only may cause a problem for you, since these instructions are mentioned in thier official documentation <a href="https://wiki.jenkins-ci.org/display/JENKINS/Disable+security" rel="nofollow">here</a>.</p>
</div></text><author><a href="/users/2855720/musharraf-al-tamimi">Musharraf Al-tamimi</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>I had a similar issue, and following reply from ArtB,</p>
<p>I found that my user didn't have the proper configurations. so what I did:</p>
<p><strong>Note: manually modifying such XML files is risky. Do it at your own risk. Since I was already locked out, I didn't have much to lose. AFAIK Worst case I would have deleted the ~/.jenkins/config.xml file as prev post mentioned.</strong></p>
<p>**&gt; 1. ssh to the jenkins machine</p>
<blockquote>
<ol>
<li>cd ~/.jenkins   (I guess that some installations put it under /var/lib/jenkins/config.xml, but not in my case )</li>
<li>vi config.xml, and under authorizationStrategy xml tag, add the below section (just used my username instead of "put-your-username")</li>
<li>restart jenkins. in my case as root service tomcat7 stop; ; service tomcat7 start</li>
<li>Try to login again. (worked for me)**</li>
</ol>
</blockquote>
<p>under 
  </p>
<p>add:</p>
<pre><code>&lt;permission&gt;hudson.model.Computer.Build:put-your-username&lt;/permission&gt;
&lt;permission&gt;hudson.model.Computer.Configure:put-your-username&lt;/permission&gt;
&lt;permission&gt;hudson.model.Computer.Connect:put-your-username&lt;/permission&gt;
&lt;permission&gt;hudson.model.Computer.Create:put-your-username&lt;/permission&gt;
&lt;permission&gt;hudson.model.Computer.Delete:put-your-username&lt;/permission&gt;
&lt;permission&gt;hudson.model.Computer.Disconnect:put-your-username&lt;/permission&gt;
&lt;permission&gt;hudson.model.Hudson.Administer:put-your-username&lt;/permission&gt;
&lt;permission&gt;hudson.model.Hudson.ConfigureUpdateCenter:put-your-username&lt;/permission&gt;
&lt;permission&gt;hudson.model.Hudson.Read:put-your-username&lt;/permission&gt;
&lt;permission&gt;hudson.model.Hudson.RunScripts:put-your-username&lt;/permission&gt;
&lt;permission&gt;hudson.model.Hudson.UploadPlugins:put-your-username&lt;/permission&gt;
&lt;permission&gt;hudson.model.Item.Build:put-your-username&lt;/permission&gt;
&lt;permission&gt;hudson.model.Item.Cancel:put-your-username&lt;/permission&gt;
&lt;permission&gt;hudson.model.Item.Configure:put-your-username&lt;/permission&gt;
&lt;permission&gt;hudson.model.Item.Create:put-your-username&lt;/permission&gt;
&lt;permission&gt;hudson.model.Item.Delete:put-your-username&lt;/permission&gt;
&lt;permission&gt;hudson.model.Item.Discover:put-your-username&lt;/permission&gt;
&lt;permission&gt;hudson.model.Item.Read:put-your-username&lt;/permission&gt;
&lt;permission&gt;hudson.model.Item.Workspace:put-your-username&lt;/permission&gt;
&lt;permission&gt;hudson.model.Run.Delete:put-your-username&lt;/permission&gt;
&lt;permission&gt;hudson.model.Run.Update:put-your-username&lt;/permission&gt;
&lt;permission&gt;hudson.model.View.Configure:put-your-username&lt;/permission&gt;
&lt;permission&gt;hudson.model.View.Create:put-your-username&lt;/permission&gt;
&lt;permission&gt;hudson.model.View.Delete:put-your-username&lt;/permission&gt;
&lt;permission&gt;hudson.model.View.Read:put-your-username&lt;/permission&gt;
&lt;permission&gt;hudson.scm.SCM.Tag:put-your-username&lt;/permission&gt;
</code></pre>
<p>Now, you can go to different directions. For example I had github oauth integration, so I could have tried to replace the authorizationStrategy with something like below:</p>
<p><strong>Note:, It worked in my case because I had a specific github oauth plugin that was already configured. So it is more risky than the previous solution.</strong></p>
<pre><code>  &lt;authorizationStrategy class="org.jenkinsci.plugins.GithubAuthorizationStrategy" plugin="github-oauth@0.14"&gt;
    &lt;rootACL&gt;
      &lt;organizationNameList class="linked-list"&gt;
        &lt;string&gt;&lt;/string&gt;
      &lt;/organizationNameList&gt;
      &lt;adminUserNameList class="linked-list"&gt;
        &lt;string&gt;put-your-username&lt;/string&gt;
        &lt;string&gt;username2&lt;/string&gt;
        &lt;string&gt;username3&lt;/string&gt;
        &lt;string&gt;username_4_etc_put_username_that_will_become_administrator&lt;/string&gt;
      &lt;/adminUserNameList&gt;
      &lt;authenticatedUserReadPermission&gt;true&lt;/authenticatedUserReadPermission&gt;
      &lt;allowGithubWebHookPermission&gt;false&lt;/allowGithubWebHookPermission&gt;
      &lt;allowCcTrayPermission&gt;false&lt;/allowCcTrayPermission&gt;
      &lt;allowAnonymousReadPermission&gt;false&lt;/allowAnonymousReadPermission&gt;
    &lt;/rootACL&gt;
  &lt;/authorizationStrategy&gt;
</code></pre>
</div></text><author><a href="/users/1256928/drordk">drordk</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>Edit the file $JENKINS_HOME/config.xml and change de security configuration with this:</p>
<pre><code>&lt;authorizationStrategy class="hudson.security.AuthorizationStrategy$Unsecured"/&gt;
</code></pre>
<p>After that restart Jenkins.</p>
</div></text><author><a href="/users/797704/richarbernal">richarbernal</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<h1>Easy way out of this is to use the admin psw to login with your admin user:</h1>
<ul>
<li>Change to root user: <code>sudo su -</code></li>
<li>Copy the password: <code>xclip -sel clip &lt; /var/lib/jenkins/secrets/initialAdminPassword</code></li>
<li>Login with admin and press <code>ctrl + v</code> on password input box.</li>
</ul>
<h1>Install xclip if you don't have it:</h1>
<ul>
<li><code>$ sudo apt-get install xclip</code></li>
</ul>
</div></text><author><a href="/users/2395283/thomas-modeneis">Thomas Modeneis</a></author><comments/></answer></answers></post>