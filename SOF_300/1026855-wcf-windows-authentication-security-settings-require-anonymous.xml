<?xml version="1.0" encoding="utf-8"?>
<post><title>WCF - Windows authentication - Security settings require Anonymous - Stack Overflow</title><question><text><div class="post-text" itemprop="text">
<p>I am struggling hard with getting WCF service running on IIS on our server. After deployment I end up with an error message:</p>
<p><em>Security settings for this service require 'Anonymous' Authentication but it is not enabled for the IIS application that hosts this service.</em> </p>
<p>I want to use Windows authentication and thus I have Anonymous access disabled. Also note that there is aspNetCompatibilityEnabled (if that makes any difference).</p>
<p>Here's my web.config:</p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="tag">&lt;system.serviceModel&gt;</span><span class="pln">
    </span><span class="tag">&lt;serviceHostingEnvironment</span><span class="pln"> </span><span class="atn">aspNetCompatibilityEnabled</span><span class="pun">=</span><span class="atv">"true"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;bindings&gt;</span><span class="pln">
        </span><span class="tag">&lt;webHttpBinding&gt;</span><span class="pln">
            </span><span class="tag">&lt;binding</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"default"</span><span class="tag">&gt;</span><span class="pln">
                </span><span class="tag">&lt;security</span><span class="pln"> </span><span class="atn">mode</span><span class="pun">=</span><span class="atv">"TransportCredentialOnly"</span><span class="tag">&gt;</span><span class="pln">
                    </span><span class="tag">&lt;transport</span><span class="pln"> </span><span class="atn">clientCredentialType</span><span class="pun">=</span><span class="atv">"Windows"</span><span class="pln"> </span><span class="atn">proxyCredentialType</span><span class="pun">=</span><span class="atv">"Windows"</span><span class="tag">/&gt;</span><span class="pln">
                </span><span class="tag">&lt;/security&gt;</span><span class="pln">
            </span><span class="tag">&lt;/binding&gt;</span><span class="pln">
        </span><span class="tag">&lt;/webHttpBinding&gt;</span><span class="pln">
    </span><span class="tag">&lt;/bindings&gt;</span><span class="pln">
    </span><span class="tag">&lt;behaviors&gt;</span><span class="pln">
        </span><span class="tag">&lt;endpointBehaviors&gt;</span><span class="pln">
            </span><span class="tag">&lt;behavior</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"AspNetAjaxBehavior"</span><span class="tag">&gt;</span><span class="pln">
                </span><span class="tag">&lt;enableWebScript</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
                </span><span class="tag">&lt;webHttp</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
            </span><span class="tag">&lt;/behavior&gt;</span><span class="pln">
        </span><span class="tag">&lt;/endpointBehaviors&gt;</span><span class="pln">
        </span><span class="tag">&lt;serviceBehaviors&gt;</span><span class="pln">
            </span><span class="tag">&lt;behavior</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"defaultServiceBehavior"</span><span class="tag">&gt;</span><span class="pln">
                </span><span class="tag">&lt;serviceMetadata</span><span class="pln"> </span><span class="atn">httpGetEnabled</span><span class="pun">=</span><span class="atv">"true"</span><span class="pln"> </span><span class="atn">httpsGetEnabled</span><span class="pun">=</span><span class="atv">"false"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
                </span><span class="tag">&lt;serviceDebug</span><span class="pln"> </span><span class="atn">includeExceptionDetailInFaults</span><span class="pun">=</span><span class="atv">"true"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
                </span><span class="tag">&lt;serviceAuthorization</span><span class="pln"> </span><span class="atn">principalPermissionMode</span><span class="pun">=</span><span class="atv">"UseWindowsGroups"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
            </span><span class="tag">&lt;/behavior&gt;</span><span class="pln">
        </span><span class="tag">&lt;/serviceBehaviors&gt;</span><span class="pln">
    </span><span class="tag">&lt;/behaviors&gt;</span><span class="pln">
    </span><span class="tag">&lt;services&gt;</span><span class="pln">
        </span><span class="tag">&lt;service</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"xxx.Web.Services.RequestService"</span><span class="pln"> </span><span class="atn">behaviorConfiguration</span><span class="pun">=</span><span class="atv">"defaultServiceBehavior"</span><span class="tag">&gt;</span><span class="pln">
            </span><span class="tag">&lt;endpoint</span><span class="pln"> </span><span class="atn">behaviorConfiguration</span><span class="pun">=</span><span class="atv">"AspNetAjaxBehavior"</span><span class="pln"> </span><span class="atn">binding</span><span class="pun">=</span><span class="atv">"webHttpBinding"</span><span class="pln">
             </span><span class="atn">contract</span><span class="pun">=</span><span class="atv">"xxx.Web.Services.IRequestService"</span><span class="pln"> </span><span class="atn">bindingConfiguration</span><span class="pun">=</span><span class="atv">"default"</span><span class="tag">&gt;</span><span class="pln">
            </span><span class="tag">&lt;/endpoint&gt;</span><span class="pln">
            </span><span class="tag">&lt;endpoint</span><span class="pln"> </span><span class="atn">address</span><span class="pun">=</span><span class="atv">"mex"</span><span class="pln"> </span><span class="atn">binding</span><span class="pun">=</span><span class="atv">"mexHttpBinding"</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"mex"</span><span class="pln"> </span><span class="atn">contract</span><span class="pun">=</span><span class="atv">"IMetadataExchange"</span><span class="tag">&gt;&lt;/endpoint&gt;</span><span class="pln">
        </span><span class="tag">&lt;/service&gt;</span><span class="pln">
    </span><span class="tag">&lt;/services&gt;</span><span class="pln">
</span><span class="tag">&lt;/system.serviceModel&gt;</span></code></pre>
<p>I have searched all over the internet with no luck. Any clues are greatly appreciated.</p>
</div></text><author><a href="/users/21234/skaffman">skaffman</a></author><comments><comment><text><span class="comment-copy">The question should identify which version of IIS it is using.</span></text><author><a class="comment-user" href="/users/107716/ray-vernagus" title="5,422 reputation">Ray Vernagus</a></author></comment><comment><text><span class="comment-copy">The version was IIS 6.0</span></text><author><a class="comment-user owner" href="/users/80941/rashack" title="3,933 reputation">Rashack</a></author></comment><comment><text><span class="comment-copy">Refer <a href="http://stackoverflow.com/questions/9588265/understanding-wcf-windows-authentication" title="understanding wcf windows authentication">stackoverflow.com/questions/9588265/â€¦</a> too</span></text><author><a class="comment-user" href="/users/696627/lijo" title="8,471 reputation">Lijo</a></author></comment></comments></question><answers><answer><text><div class="post-text" itemprop="text">
<p>So it seems like pretty common issue. The point is to remove mex from your bindings:</p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="tag">&lt;endpoint</span><span class="pln"> </span><span class="atn">address</span><span class="pun">=</span><span class="atv">"mex"</span><span class="pln"> </span><span class="atn">binding</span><span class="pun">=</span><span class="atv">"mexHttpBinding"</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"mex"</span><span class="pln"> </span><span class="atn">contract</span><span class="pun">=</span><span class="atv">"IMetadataExchange"</span><span class="tag">&gt;&lt;/endpoint&gt;</span></code></pre>
<p>Alternativelly you enable Anonymous access in IIS and in your web.config you make sure anonymous access is denied.</p>
<p>Hope this will help some other soul.
(I was 100% sure I tried it with mex removed. :-O )</p>
</div></text><author><a href="/users/80941/rashack">Rashack</a></author><comments><comment><text><span class="comment-copy">I ended up using your alternative. IIS anon + Windows with web.config denying all anonymous users.   I'm hosting 3.5 WCF REST with asp.net.   Thanks</span></text><author><a class="comment-user" href="/users/120096/nathan" title="464 reputation">Nathan</a></author></comment><comment><text><span class="comment-copy">Actually, removing mex doesn't work.</span></text><author><a class="comment-user" href="/users/151200/andrey" title="8,626 reputation">Andrey</a></author></comment><comment><text><span class="comment-copy">This worked for me after following the steps I found here: <a href="https://msdn.microsoft.com/en-us/library/ff648505.aspx" rel="nofollow noreferrer">link</a>, which I was directed to from here: <a href="http://stackoverflow.com/questions/8591238/wcf-says-my-settings-require-anonymous-authentication-but-i-dont-want-them">link</a> @Andrey</span></text><author><a class="comment-user" href="/users/783470/roger-perkins" title="128 reputation">Roger Perkins</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>You may check this <a href="http://www.padel.ro/post/wcf-and-windows-authentication-.net-4.0-style/" rel="noreferrer">one</a>.
I managed to make it work as expected.</p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="tag">&lt;configuration&gt;</span><span class="pln">
  ...
  </span><span class="tag">&lt;system.serviceModel&gt;</span><span class="pln">
    ...
    </span><span class="tag">&lt;bindings&gt;</span><span class="pln">
      </span><span class="tag">&lt;basicHttpBinding&gt;</span><span class="pln">
        </span><span class="tag">&lt;binding&gt;</span><span class="pln">
          </span><span class="tag">&lt;security</span><span class="pln"> </span><span class="atn">mode</span><span class="pun">=</span><span class="atv">"TransportCredentialOnly"</span><span class="tag">&gt;</span><span class="pln">
            </span><span class="tag">&lt;transport</span><span class="pln"> </span><span class="atn">clientCredentialType</span><span class="pun">=</span><span class="atv">"Windows"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
          </span><span class="tag">&lt;/security&gt;</span><span class="pln">
        </span><span class="tag">&lt;/binding&gt;</span><span class="pln">
      </span><span class="tag">&lt;/basicHttpBinding&gt;</span><span class="pln">
    </span><span class="tag">&lt;/bindings&gt;</span><span class="pln">
    ...
  </span><span class="tag">&lt;/system.serviceModel&gt;</span><span class="pln">
  ...
</span><span class="tag">&lt;/configuration&gt;</span></code></pre>
</div></text><author><a href="/users/373971/padel">Padel</a></author><comments><comment><text><span class="comment-copy">thanks for the info -- it'd be a bit more helpful to quote the relevant section of the information here rather than providing a bare hyperlink.</span></text><author><a class="comment-user" href="/users/1/jeff-atwood" title="40,770 reputation">Jeff Atwood<span class="mod-flair" title="moderator">â™¦</span></a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>just use your service bindings for mex too.</p>
<p>So change your current config :</p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="tag">&lt;endpoint</span><span class="pln"> </span><span class="atn">address</span><span class="pun">=</span><span class="atv">"mex"</span><span class="pln"> </span><span class="atn">binding</span><span class="pun">=</span><span class="atv">"mexHttpBinding"</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"mex"</span><span class="pln"> </span><span class="atn">contract</span><span class="pun">=</span><span class="atv">"IMetadataExchange"</span><span class="tag">&gt;&lt;/endpoint&gt;</span></code></pre>
<p>to </p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="tag">&lt;endpoint</span><span class="pln"> </span><span class="atn">address</span><span class="pun">=</span><span class="atv">"mex"</span><span class="pln"> </span><span class="atn">binding</span><span class="pun">=</span><span class="atv">"webHttpBinding"</span><span class="pln"> </span><span class="atn">bindingConfiguration</span><span class="pun">=</span><span class="atv">"default"</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"mex"</span><span class="pln"> </span><span class="atn">contract</span><span class="pun">=</span><span class="atv">"IMetadataExchange"</span><span class="tag">&gt;&lt;/endpoint&gt;</span></code></pre>
<p>That should solve the problem</p>
</div></text><author><a href="/users/345379/sandyiit">sandyiit</a></author><comments><comment><text><span class="comment-copy">Thanks! This worked for me but, just to be clear, I also had to keep <code>httpGetEnabled="true"</code></span></text><author><a class="comment-user" href="/users/589601/mcarthey" title="949 reputation">McArthey</a></author></comment><comment><text><span class="comment-copy">yes you need to have that too</span></text><author><a class="comment-user" href="/users/345379/sandyiit" title="1,013 reputation">sandyiit</a></author></comment><comment><text><span class="comment-copy">Worked for me using basicHttpBinding.  i.e. changed the binding on the "mex" endpoint from "mexHttpBinding" to "basicHttpBinding"</span></text><author><a class="comment-user" href="/users/213555/teevus" title="524 reputation">Teevus</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>Anonymous authentication can, and in some cases must be enabled for the service but not for the site.</p>
<p>So check that your site's "root" authentication has only Windows Authentication enabled. Then expand your site, select 'service' folder and make sure that your service has Windows and Anonymous Authentication enabled.</p>
<p>I had identical environment where this worked, only difference in these environments was the service's authentication. Problem in my case was not caused be selected providers (Ntlm or Negotiate) but the authentication settings for site and service.</p>
<p>At least I had identical error message with basic MSSQL Master Data Services web site &amp; service and this was the solution. I did get the error when running just the service but the site worked almost ok, MDS Explorer did not work because service's authentication settings were wrong at first. Cause of this miss-configuration might be a bug in MDS Configuration Manager when creating new MDS site?</p>
<p>So in my case the problem was not to be fixed by doing any special editing to the web.config nor the ApplicationHost.config files, I didn't do any editing the config files. Just selected the correct authentication settings for the web site and it's service in IIS manager. I am not sure that this is the case in here, but maybe worth to try?</p>
</div></text><author><a href="/users/2024516/atte">Atte</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>It worked for me when I remove 'mex' endpoint and also set clientCredentialType = 'Ntlm'
I was hosting my WCF inside SharePoint.</p>
</div></text><author><a href="/users/1852841/sagar-s">Sagar S.</a></author><comments><comment><text><span class="comment-copy">It did the trick for me.</span></text><author><a class="comment-user" href="/users/250524/nlv" title="7,166 reputation">NLV</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>Yes, it looks like you need to remove the mex endpoint completely. Setting  </p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="tag">&lt;serviceMetadata</span><span class="pln"> </span><span class="atn">httpGetEnabled</span><span class="pun">=</span><span class="atv">"false"</span><span class="tag">/&gt;</span></code></pre>
<p>alone did not work. Thanks!</p>
</div></text><author><a href="/users/167933/narayana">Narayana</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>Additional solution:</p>
<p>You just have to make sure that the Service name and contract are correct.</p>
<p>Hope it helps in some way.</p>
</div></text><author><a href="/users/1430942/syntaxerror">SyntaxError</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>It appears this MEX binding issue was fixed in .NET 4.0. Changing our server's App Pool .NET CLR version from 2.0 to 4.0 cleared up the issue. </p>
</div></text><author><a href="/users/1703887/csrowell">csrowell</a></author><comments/></answer></answers></post>