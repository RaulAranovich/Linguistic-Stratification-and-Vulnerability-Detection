<?xml version="1.0" encoding="utf-8"?>
<post><title>php - Is it safe to trust $_SERVER['REMOTE_ADDR']? - Stack Overflow</title><question><text><div class="post-text" itemprop="text">
<p>Is it safe to trust <code>$_SERVER['REMOTE_ADDR']</code>? Can it be substituted by changing the header of request or something like that?</p>
<p>Is it safe to write something like that?</p>
<pre class="lang-php prettyprint prettyprinted" style=""><code><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$_SERVER</span><span class="pun">[</span><span class="str">'REMOTE_ADDR'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'222.222.222.222'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="com">// my ip address</span><span class="pln">
    $grant_all_admin_rights </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div></text><author><a href="/users/1889273/boaz">Boaz</a></author><comments><comment><text><span class="comment-copy">Adding to the existing answers, it will always be the IP address that made the request to your server, but that doesn't mean it's the IP address of the computer that started the request. Any number of proxy servers could be in-between you and the end user, and the closest one to you is the IP address you get.</span></text><author><a class="comment-user" href="/users/280598/dan-grossman" title="39,591 reputation">Dan Grossman</a></author></comment><comment><text><span class="comment-copy">yes it's safe because can't be subtituted by another tricks or some cheating. but make sure you add more check for $grant_all_admin_rights variable.</span></text><author><a class="comment-user" href="/users/454229/gunslinger" title="4,853 reputation">Gunslinger_</a></author></comment><comment><text><span class="comment-copy">Any $_SERVER variable can be spoofed - e.g. curl_setopt( $ch, CURLOPT_HTTPHEADER, array("REMOTE_ADDR: $ip", "HTTP_X_FORWARDED_FOR: $ip")); So it depends entirely on the context: if the attacker is expecting a response, it will go back to $ip.  If they don't care about the response, they can certainly spoof the header.  If your code after the header check instead said: "open_the_door_to_badguys();" you would have a problem.</span></text><author><a class="comment-user" href="/users/264074/tmg" title="370 reputation">TMG</a></author></comment><comment><text><span class="comment-copy">@TMG You can't spoof the <code>$_SERVER['REMOTE_ADDR']</code> variable by setting an HTTP request header. PHP automatically prefixes all HTTP request headers with <code>HTTP_</code> when creating keys in the <code>$_SERVER</code> superglobal.</span></text><author><a class="comment-user" href="/users/369434/w3dk" title="7,480 reputation">w3dk</a></author></comment></comments></question><answers><answer><text><div class="post-text" itemprop="text">
<p>Yes, it's safe. It is the source IP of the TCP connection and can't be substituted by changing an HTTP header.</p>
<p>One case you may want to be worry of is if you are behind a reverse proxy in which case the REMOTE_ADDR will always be the IP of the proxy server and the user IP will be provided in an HTTP header (such as <a href="http://en.wikipedia.org/wiki/X-Forwarded-For" rel="noreferrer">X-Forwarded-For</a>). But for the normal use case reading REMOTE_ADDR is fine.</p>
</div></text><author><a href="/users/19244/sagi">sagi</a></author><comments><comment><text><span class="comment-copy">What about IP address spoofing?</span></text><author><a class="comment-user" href="/users/923560/abdull" title="8,378 reputation">Abdull</a></author></comment><comment><text><span class="comment-copy">@Abdull The people who can do that are usually the same people who have physical access to your box. so don't worry about it that much.</span></text><author><a class="comment-user" href="/users/179795/behrooz" title="954 reputation">Behrooz</a></author></comment><comment><text><span class="comment-copy">@Abdull IP spoofing can only send messages one way, you can't spoof your IP and get a message in return.</span></text><author><a class="comment-user" href="/users/4914655/matth3w" title="144 reputation">Matth3w</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p><code>$_SERVER['REMOTE_ADDR']</code> is the IP address the TCP connection came in on. While it is technically possible to bidirectionally spoof IP addresses on the Internet (by announcing foul routes via BGP), such attacks are likely to be spotted and not available to the typical attacker - basically, your attacker must have control over an ISP or carrier. There are no feasible unidirectional spoofing attacks against TCP (yet). Bidirectional IP spoofing is trivial on a LAN though.</p>
<p>Also be aware that it may be not be an IPv4, but an IPv6 address. Your current check is fine in that regard, but if you would check that <code>1.2.3.4</code> only occurs <em>anywhere</em> within <code>$_SERVER['REMOTE_ADDR']</code>, an attacker could simply connect from <code>2001:1234:5678::1.2.3.4</code>.</p>
<p>Summarily, for anything other than critical (banking/military/potential damage &gt;50.000â‚¬) applications, you can use the remote IP address if you can exclude attackers in your local network.</p>
</div></text><author><a href="/users/35070/phihag">phihag</a></author><comments><comment><text><span class="comment-copy">You sound very informed about the Internet Protocol.</span></text><author><a class="comment-user" href="/users/1151229/brian-peterson" title="1,538 reputation">Brian Peterson</a></author></comment><comment><text><span class="comment-copy">@phihag, Whether <code>$_SERVER['REMOTE_ADDR']</code> is the IP address the TCP connection came in on depends entirely on your SAPI.</span></text><author><a class="comment-user" href="/users/632951/pacerier" title="33,795 reputation">Pacerier</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>As mentioned above, it's not absolutely safe. But it doesn't mean, that you shouldn't use it. Consider combine this with some other methods of authentication, for instance checking COOKIE values.</p>
</div></text><author><a href="/users/557223/audio">Audio</a></author><comments><comment><text><span class="comment-copy">After spoofing an IP address, changing the http request and sending false cookies is a piece of cake.....  (or a piece of cookie)</span></text><author><a class="comment-user" href="/users/1097347/uri-goren" title="4,746 reputation">Uri Goren</a></author></comment></comments></answer></answers></post>