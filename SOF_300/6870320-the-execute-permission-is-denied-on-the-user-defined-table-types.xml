<?xml version="1.0" encoding="utf-8"?>
<post><title>asp.net - The EXECUTE permission is denied on the user-defined table types? - Stack Overflow</title><question><text><div class="post-text" itemprop="text">
<p>I have a question about <a href="http://msdn.microsoft.com/en-us/library/bb522526.aspx">User-Defined Table Types</a> in SQL Server 2008.</p>
<p>For the need of one of the ASP.NET application we defined our own table-types on SQL Server 2008 to use them  as parameters in the stored procedures (when executing sql command in ASP.NET application we pass DataTable object as parameter for stored procedure <a href="http://www.codeproject.com/KB/database/sqlserver2008.aspx">see here for an example</a>)</p>
<p>The problem is that when we run Sql command (execute stored procedure) from ASP.NET we get an error:</p>
<blockquote>
<p>The EXECUTE permission was denied on the object 'ourTableType',
  database 'ourDatabase', schema 'ourSchema'.</p>
</blockquote>
<p>Why is that so? Why do we need to set permission on user-defined table types? Why is not enough to have permission set just on stored procedure that uses it? And if we have to set it no matter what, why there is no <code>EXECUTE</code> permission type to set in properties window whatsoever (I can see only <code>Control</code>, <code>References</code>, <code>Take Ownership</code>, <code>View Definition</code>)?</p>
<p>What I also don't understand is that setting permission to <code>Control</code> in properties window solves the problem and the stored procedure runs without problems.</p>
</div></text><author><a href="/users/672630/janez">Janez</a></author><comments><comment><text><span class="comment-copy">possible duplicate of <a href="http://stackoverflow.com/questions/2244217/table-valued-parameter-in-a-stored-procedure-gets-execute-permissions-denied-erro">Table valued parameter in a stored procedure gets execute permissions denied error</a></span></text><author><a class="comment-user" href="/users/15498/damien-the-unbeliever" title="157,270 reputation">Damien_The_Unbeliever</a></author></comment><comment><text><span class="comment-copy">thank you! I've searched but clearly not good enough:/</span></text><author><a class="comment-user owner" href="/users/672630/janez" title="1,099 reputation">Janez</a></author></comment><comment><text><span class="comment-copy">Try putting <code>AS dbo</code> at the end. Like this: <code>GRANT EXEC ON TYPE::[schema].[typename] TO [User] AS dbo</code>. Worked for me.</span></text><author><a class="comment-user" href="/users/23341/jonathanconway" title="12,633 reputation">jonathanconway</a></author></comment></comments></question><answers><answer><text><div class="post-text" itemprop="text">
<p>I really hope you've solved this by now, seeing as the question is almost 4 months old, but in case you haven't, here's what I think is the answer.</p>
<pre class="lang-sql prettyprint prettyprinted" style=""><code><span class="kwd">GRANT</span><span class="pln"> </span><span class="kwd">EXEC</span><span class="pln"> </span><span class="kwd">ON</span><span class="pln"> TYPE</span><span class="pun">::[</span><span class="kwd">schema</span><span class="pun">].[</span><span class="pln">typename</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">TO</span><span class="pln"> </span><span class="pun">[</span><span class="kwd">User</span><span class="pun">]</span><span class="pln">
GO</span></code></pre>
</div></text><author><a href="/users/807851/mccow002">mccow002</a></author><comments><comment><text><span class="comment-copy">This worked for me when I had the exact same issue.</span></text><author><a class="comment-user" href="/users/243418/mwgriffith" title="472 reputation">mwgriffith</a></author></comment><comment><text><span class="comment-copy">You saved the day.  Upvote and Gold Star !</span></text><author><a class="comment-user" href="/users/214977/granadacoder" title="12,564 reputation">granadaCoder</a></author></comment><comment><text><span class="comment-copy">My 2 cents: Depending on your connection authentication mechanism, you may have to grant exec to Public group. So your grant would look like this: GRANT EXEC ON TYPE::[schema].[typename] TO [Public] GO</span></text><author><a class="comment-user" href="/users/190476/dotnetguy" title="2,432 reputation">dotnetguy</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>If your stored procedure is using dynamic sql, meaning the <code>@sql</code> is generated and then executed via <code>exec @sql</code>, you will need permission granted on the underlying tables.</p>
<p>One work-around is to <a href="http://msdn.microsoft.com/en-us/library/ms188354.aspx" rel="nofollow">modify to stored procedure to run as a different user</a>.  If you make it run as SELF, it will be ran underneath the creator of the stored proc, which is extremely dangerous.  Still, if you have no other option:</p>
<pre class="lang-sql prettyprint prettyprinted" style=""><code><span class="kwd">CREATE</span><span class="pln"> </span><span class="kwd">PROCEDURE</span><span class="pln"> dbo</span><span class="pun">.</span><span class="pln">usp_Demo
</span><span class="kwd">WITH</span><span class="pln"> </span><span class="kwd">EXECUTE</span><span class="pln"> </span><span class="kwd">AS</span><span class="pln"> SELF</span></code></pre>
</div></text><author><a href="/users/836484/rkw">rkw</a></author><comments><comment><text><span class="comment-copy">Thx for pointing this out. But stored procedure does not have any dynamic sql in it. Only general <code>INSERT INTO</code> and ´UPDATE´ table statements for which this user has all permissions he needs. Also this user/login is specially reserved/created for this ASP.NET application to be able to connect to this database and only execute stored procedures (not create etc, creator is always <code>'sa'</code>).</span></text><author><a class="comment-user owner" href="/users/672630/janez" title="1,099 reputation">Janez</a></author></comment></comments></answer></answers></post>