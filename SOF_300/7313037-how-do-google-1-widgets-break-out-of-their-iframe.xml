<?xml version="1.0" encoding="utf-8"?>
<post><title>html - How do Google+ +1 widgets break out of their iframe? - Stack Overflow</title><question><text><div class="post-text" itemprop="text">
<p>Somehow, hovering over a Google+ plus-one widget can introduce a tooltip-type deal that is clearly larger than the <code>&lt;iframe&gt;</code> element in which it is contained. I’ve inspected the DOM to confirm this.*</p>
<p><a href="https://i.stack.imgur.com/h1DtN.gif" rel="nofollow noreferrer"><img alt="iframe boundaries" src="https://i.stack.imgur.com/h1DtN.gif"/></a></p>
<p>So:</p>
<ol>
<li><p>What? How!?</p></li>
<li><p>Is this not a massive opportunity for clickjacking, if used maliciously? (Imagine someone doing a MITM for these social widgets!)</p></li>
</ol>
<p><em>*Update: What I saw was that the tooltip-y message was in a</em> second, <em>dynamically created <code>iframe</code>.</em></p>
</div></text><author><a href="/users/6083675/laurel">Laurel</a></author><comments/></question><answers><answer><text><div class="post-text" itemprop="text">
<p>The Google +1 widget is <a href="http://code.google.com/apis/+1button/" rel="nofollow noreferrer">JavaScript that runs on your website</a> that is building an <code>iframe</code>.   This JavaScript widget is running within the context of your website and therefore is not constrained by the <a href="http://code.google.com/p/browsersec/wiki/Part2#Origin_inheritance_rules" rel="nofollow noreferrer">Origin Inheritance Rules for iframes</a>.  Therefore this JavaScript widget can set whatever DOM events it wants on the parent site even though it appears to be just a simple <code>iframe</code>. </p>
<p>Another thing, why is Google using an <code>iframe</code>?  Why not just generate a <code>div</code> on the page?  Well because the link originates from the <code>iframe</code>,  a CSRF (cross-site request forgery) token can be embedded in the request and the parent site cannot read this token and forge the request. So the <code>iframe</code> is an anti-CSRF measure that relies upon the Origin Inheritance rules to protect itself from a malicious parent. </p>
<p>From an attack perspective this is more like XSS (cross-site scripting) than UI-Redress.  You are giving Google access to your website and they could hijack your users' cookie's or perform <code>XmlHttpRequests</code> against your website if they so choose (but then people would sue them for being malicious and wealthy). </p>
<p>In this situation you HAVE to trust Google, but Google doesn't trust you. </p>
<p><a href="https://security.stackexchange.com/questions/73988/how-can-two-clicks-lead-to-better-security-in-the-context-of-e-g-twitter-and/73990#73990">There are ways of mitigating the privacy impact of these web-bugs</a>. </p>
</div></text><author><a href="/users/183528/rook">rook</a></author><comments><comment><text><span class="comment-copy">Great stuff – I appreciate your comment re: XSS, which makes lots of sense. Yet I’m still not sure about something. The content in question looks like it’s not within the <code>&lt;iframe&gt;</code>, which you suggest may be true (and explain how it’s possible). But it doesn’t seem to be that this is the case, from inspecting the DOM. And it would expose my name and Gmail address to malicious parents (unless wrapped in a second <code>iframe</code>)!</span></text><author><a class="comment-user owner" href="/users/211327/alan-h" title="7,353 reputation">Alan H.</a></author></comment><comment><text><span class="comment-copy">@Alan H. Yeah they are doing some bizarre stuff with dynamic iframes.  Do you click on the +1 you'll get the the window where you add a comment. If you load up firebug and inspect that element then you'll get an iframe src for plusone.google.com/u/0/_/+/fastbutton?url=...   This iframe contains the CSRF token for submitting to google+.</span></text><author><a class="comment-user" href="/users/183528/rook" title="43,765 reputation">rook</a></author></comment><comment><text><span class="comment-copy">In some cases, you may avoid Cookie's hijacking by setting them with httponly.</span></text><author><a class="comment-user" href="/users/551548/seppo0010" title="7,149 reputation">seppo0010</a></author></comment><comment><text><span class="comment-copy">@seppo0010 yeah but  that doesn't stop XHR's.</span></text><author><a class="comment-user" href="/users/183528/rook" title="43,765 reputation">rook</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>Google uses iFrames to prevent "leaky standard DIVs."  Their closure library dialog does the same thing.  It is probably just so that other content cannot bleed into the +1 button.  <a href="http://closure-library.googlecode.com/svn/trunk/closure/goog/demos/dialog.html" rel="nofollow">http://closure-library.googlecode.com/svn/trunk/closure/goog/demos/dialog.html</a>.  </p>
</div></text><author><a href="/users/105589/xrd">xrd</a></author><comments><comment><text><span class="comment-copy">As Rook explained in his answer, the &lt;iframe&gt; is used to prevent site using the Google +1 widget code from using CSRF attack to click the link by itself (and artificially improving site's +1 rating). That's the part where Google is not trusting you.</span></text><author><a class="comment-user" href="/users/334451/mikko-rantalainen" title="4,667 reputation">Mikko Rantalainen</a></author></comment></comments></answer></answers></post>