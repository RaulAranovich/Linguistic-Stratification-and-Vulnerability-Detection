<?xml version="1.0" encoding="utf-8"?>
<post><title>security - How do I prevent Android taking a screenshot when my app goes to the background? - Stack Overflow</title><question><text><div class="post-text" itemprop="text">
<p>The app I'm currently building has the requirement that the app has to prevent the OS to take a screenshot of the app when it's being pushed into the background for security reasons. This way it won't be able to see the last active screen when switching between apps.</p>
<p>I'm planning to put this functionality in the application class's onPause method, but first I need to find out how I can achieve this functionality.</p>
<p>So is there anybody out there, that has a clue how to fix this? </p>
</div></text><author><a href="/users/1151934/korius">korius</a></author><comments/></question><answers><answer><text><div class="post-text" itemprop="text">
<p>Try <code>FLAG_SECURE</code>:</p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">FlagSecureTestActivity</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Activity</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="lit">@Override</span><span class="pln">
  </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onCreate</span><span class="pun">(</span><span class="typ">Bundle</span><span class="pln"> savedInstanceState</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">super</span><span class="pun">.</span><span class="pln">onCreate</span><span class="pun">(</span><span class="pln">savedInstanceState</span><span class="pun">);</span><span class="pln">

    getWindow</span><span class="pun">().</span><span class="pln">setFlags</span><span class="pun">(</span><span class="typ">LayoutParams</span><span class="pun">.</span><span class="pln">FLAG_SECURE</span><span class="pun">,</span><span class="pln">
                         </span><span class="typ">LayoutParams</span><span class="pun">.</span><span class="pln">FLAG_SECURE</span><span class="pun">);</span><span class="pln">

    setContentView</span><span class="pun">(</span><span class="pln">R</span><span class="pun">.</span><span class="pln">layout</span><span class="pun">.</span><span class="pln">main</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
<p>This definitely secures against manual screenshots and automatic screenshots from the ICS recent-tasks history.</p>
<p><strong>UPDATE</strong>: it also secures against Now On Tap or other assistants on Android 6.0; they will not get access to the details of widgets and containers in your UI if the user brings up the assistant.</p>
<p><strong>UPDATE #2</strong>: however, not everything in the activity will be protected. Any pop-up windows — <code>Dialog</code>, <code>Spinner</code>, <code>AutoCompleteTextView</code>, action bar overflow, etc. — will be insecure. You can fix the <code>Dialog</code> problem by calling <code>getWindow()</code> on it and setting <code>FLAG_SECURE</code>. The rest... gets tricky. See <a href="https://commonsware.com/blog/2016/06/06/psa-flag-secure-window-leaks.html">this blog post</a> for more.</p>
</div></text><author><a href="/users/115145/commonsware">CommonsWare</a></author><comments><comment><text><span class="comment-copy">@Dany's: Actually, it has everything to do with the question. I just tested it on a Nexus S (4.0.3), and it works as expected -- the recent-tasks screenshot is suppressed. You still see the application name and icon, but the screenshot is black. You are welcome to try it on ICS hardware.</span></text><author><a class="comment-user" href="/users/115145/commonsware" title="640,324 reputation">CommonsWare</a></author></comment><comment><text><span class="comment-copy">Thanks, will take a look, any idea if this will also work with the backwards compatibility package?</span></text><author><a class="comment-user owner" href="/users/718504/stingray5" title="845 reputation">StingRay5</a></author></comment><comment><text><span class="comment-copy">@StingRay5: <code>FLAG_SECURE</code> has existed since the beginning -- it just had limited meaning until recently.</span></text><author><a class="comment-user" href="/users/115145/commonsware" title="640,324 reputation">CommonsWare</a></author></comment><comment><text><span class="comment-copy">I now see why, works like a charm! Thanks!</span></text><author><a class="comment-user owner" href="/users/718504/stingray5" title="845 reputation">StingRay5</a></author></comment><comment><text><span class="comment-copy">Interesting to note that there is a method called onCreateThumbnail ni the activity lifecycle, but it's never used.</span></text><author><a class="comment-user" href="/users/693752/snicolas" title="28,513 reputation">Snicolas</a></author></comment><comment><text><span class="comment-copy">@CommonsWare How can I check if <code>LayoutParams.FLAG_SECURE</code> is set or not. Actually I set <code>LayoutParams.FLAG_SECURE</code> to restrict screen-capture, and I wrote a code to take screen shot, and I am able to take screenshot. So can you please tell that how can I verify that ?</span></text><author><a class="comment-user" href="/users/550966/pankaj-kumar" title="47,731 reputation">Pankaj Kumar</a></author></comment><comment><text><span class="comment-copy">@PankajKumar: If the "code to take screen shot" that you wrote is that classic "grab the framebuffer as root" trick, <code>FLAG_SECURE</code> won't defend against that, as that's too low-level. Similarly, if you took your own widget hierarchy and had it draw to a <code>Bitmap</code>-backed <code>Canvas</code>, <code>FLAG_SECURE</code> probably won't defend against that, as you are taking your own screenshots of your own widgets and therefore presumably <i>wanted</i> the "secure" ones in there. <code>FLAG_SECURE</code> is for <i>system</i> screenshots, such as the recent-tasks thumbnails.</span></text><author><a class="comment-user" href="/users/115145/commonsware" title="640,324 reputation">CommonsWare</a></author></comment><comment><text><span class="comment-copy">Ok. I got the point. Is there any way where I can check if <code>FLAG_SECURE</code> is set or not?</span></text><author><a class="comment-user" href="/users/550966/pankaj-kumar" title="47,731 reputation">Pankaj Kumar</a></author></comment><comment><text><span class="comment-copy">@PankajKumar: For your own window, you should know if <code>FLAG_SECURE</code> is set or not, as you are the one setting it. If you are writing some framework and therefore do not know if a <code>Window</code> has <code>FLAG_SECURE</code> or not, in theory you should be able to find it in the <code>getAttributes()</code> result, though I have never tried this. And, if you are referring to a window from some other process, I doubt that an SDK app can find out if a window has <code>FLAG_SECURE</code> or not.</span></text><author><a class="comment-user" href="/users/115145/commonsware" title="640,324 reputation">CommonsWare</a></author></comment><comment><text><span class="comment-copy">Ok. Thanks for the note. Trying to resolve :)</span></text><author><a class="comment-user" href="/users/550966/pankaj-kumar" title="47,731 reputation">Pankaj Kumar</a></author></comment><comment><text><span class="comment-copy">Wonderful and simple answer! I'm wondering why apps like <a href="http://www.snapchat.com/" rel="nofollow noreferrer">snapchat</a> don't use this to prevent someone taking a screenshot of the images sent.</span></text><author><a class="comment-user" href="/users/1306419/shobhit-puri" title="18,186 reputation">Shobhit Puri</a></author></comment><comment><text><span class="comment-copy">@CommonsWare Hope you are doing well. I have one more issue related to secure flag. I set this flag as you given into answer, and it was working well before KitKat. In KitKat, if I press <code>power+volumn_down</code> and rotate device, able to take screen-shot. Is this bug into KitKat? Or there is another method to set secure flag? Please update me.</span></text><author><a class="comment-user" href="/users/550966/pankaj-kumar" title="47,731 reputation">Pankaj Kumar</a></author></comment><comment><text><span class="comment-copy">@PankajKumar: Please see <a href="http://code.google.com/p/android/issues/detail?id=64086" rel="nofollow noreferrer">code.google.com/p/android/issues/detail?id=64086</a></span></text><author><a class="comment-user" href="/users/115145/commonsware" title="640,324 reputation">CommonsWare</a></author></comment><comment><text><span class="comment-copy">@CommonsWare Actually this issue doesn't come into 4.3. So is this a bug into KitKat? As per your given link its look like this is device specific, right?</span></text><author><a class="comment-user" href="/users/550966/pankaj-kumar" title="47,731 reputation">Pankaj Kumar</a></author></comment><comment><text><span class="comment-copy">@PankajKumar: I am saying that I have attempted to reproduce this issue and have been unable to do so (see comment #4 on the issue report).</span></text><author><a class="comment-user" href="/users/115145/commonsware" title="640,324 reputation">CommonsWare</a></author></comment><comment><text><span class="comment-copy">Any idea how I can prevent Android from taking a screenshot when it goes to the background, but allow users to take a screenshot manually? I've posted another question: <a href="http://stackoverflow.com/questions/28873633/how-do-i-prevent-android-from-taking-a-screenshot-when-app-goes-to-background-b" title="how do i prevent android from taking a screenshot when app goes to background b">stackoverflow.com/questions/28873633/…</a></span></text><author><a class="comment-user" href="/users/2212770/wirling" title="470 reputation">Wirling</a></author></comment><comment><text><span class="comment-copy">@CommonsWare Can i display custom photo instead of auto screenshots in recent application list?</span></text><author><a class="comment-user" href="/users/936564/dhaval-khant" title="2,227 reputation">Dhaval Khant</a></author></comment><comment><text><span class="comment-copy">@DhavalKhant: You can try <code>onCreateThumbnail()</code>, though I have not tried it personally: <a href="http://developer.android.com/reference/android/app/Activity.html#onCreateThumbnail%28android.graphics.Bitmap,%20android.graphics.Canvas%29" rel="nofollow noreferrer">developer.android.com/reference/android/app/…</a></span></text><author><a class="comment-user" href="/users/115145/commonsware" title="640,324 reputation">CommonsWare</a></author></comment><comment><text><span class="comment-copy">Just to add the package, because it took me a short while: WindowManager.LayoutParams.FLAG_SECURE</span></text><author><a class="comment-user" href="/users/552733/andreas-rudolph" title="675 reputation">Andreas Rudolph</a></author></comment><comment><text><span class="comment-copy">This doesn't work reliably on Android 5.1, see <a href="https://code.google.com/p/android/issues/detail?id=169933" rel="nofollow noreferrer">code.google.com/p/android/issues/detail?id=169933</a></span></text><author><a class="comment-user" href="/users/1245231/petrsyn" title="2,167 reputation">petrsyn</a></author></comment><comment><text><span class="comment-copy">Yep, apparently there are some bugs, another ticket opened here: <a href="https://code.google.com/p/android-developer-preview/issues/detail?can=2&amp;start=0&amp;num=100&amp;q=&amp;colspec=ID%20Type%20Status%20Owner%20Summary%20Stars&amp;groupby=&amp;sort=&amp;id=2484" rel="nofollow noreferrer">code.google.com/p/android-developer-preview/issues/…</a></span></text><author><a class="comment-user" href="/users/1023517/ciprian" title="1,433 reputation">Ciprian</a></author></comment><comment><text><span class="comment-copy">Is there a way to set this in Xamarin? I could not reach FLAG_SECURE parameter.</span></text><author><a class="comment-user" href="/users/1487733/emrah-akg%c3%bcl" title="157 reputation">Emrah Akgül</a></author></comment><comment><text><span class="comment-copy">@EmrahAkgül: I can barely spell Xamarin. :-) You are better served asking a separate Stack Overflow question, with the appropriate Xamarin tag, asking how to use it.</span></text><author><a class="comment-user" href="/users/115145/commonsware" title="640,324 reputation">CommonsWare</a></author></comment><comment><text><span class="comment-copy">Thank you for the "UPDATE #2", It would not occurred to me.</span></text><author><a class="comment-user" href="/users/4374374/tron" title="571 reputation">Tron</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>Be careful about using WindowManager.LayoutParams.FLAG_SECURE, on some devices (verified on Samsung Galaxy ACE, e.g. GT-S5830) this will make the view scrambled. Looks like a Samsung specific bug. I recommend the following: </p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="kwd">if</span><span class="pun">(</span><span class="pln">android</span><span class="pun">.</span><span class="pln">os</span><span class="pun">.</span><span class="typ">Build</span><span class="pun">.</span><span class="pln">VERSION</span><span class="pun">.</span><span class="pln">SDK_INT </span><span class="pun">&gt;=</span><span class="pln"> android</span><span class="pun">.</span><span class="pln">os</span><span class="pun">.</span><span class="typ">Build</span><span class="pun">.</span><span class="pln">VERSION_CODES</span><span class="pun">.</span><span class="pln">HONEYCOMB</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    getWindow</span><span class="pun">().</span><span class="pln">setFlags</span><span class="pun">(</span><span class="typ">WindowManager</span><span class="pun">.</span><span class="typ">LayoutParams</span><span class="pun">.</span><span class="pln">FLAG_SECURE</span><span class="pun">,</span><span class="pln"> </span><span class="typ">WindowManager</span><span class="pun">.</span><span class="typ">LayoutParams</span><span class="pun">.</span><span class="pln">FLAG_SECURE</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
<p>This is what a scrambled screen looks like:</p>
<p><img alt="Scrambled Screen Image" src="https://i.stack.imgur.com/Tf7XC.png"/></p>
<p>This is working properly on ICS Samsung phones though, so I'm assuming problem is isolated to Gingerbread devices (or older).</p>
</div></text><author><a href="/users/426213/gardarh">gardarh</a></author><comments><comment><text><span class="comment-copy">You're totally right, we came across this issue, and it certainly was needed to check for the API level. Actually forgot to post this, so thanks for bringing it up again. :)</span></text><author><a class="comment-user owner" href="/users/718504/stingray5" title="845 reputation">StingRay5</a></author></comment><comment><text><span class="comment-copy">It also occurs on Samsung Gio (Gingerbread) but on Froyo its ok - so it occurs only on 2.3</span></text><author><a class="comment-user" href="/users/296427/pixel" title="7,146 reputation">pixel</a></author></comment><comment><text><span class="comment-copy">We noticed this problem as well. You can verify in the Emulator on Gingerbread devices.</span></text><author><a class="comment-user" href="/users/772122/twaddington" title="9,714 reputation">twaddington</a></author></comment><comment><text><span class="comment-copy">I can also confirm that this problem appears on Samsung Gingerbread devices.</span></text><author><a class="comment-user" href="/users/1067869/ernir-erlingsson" title="1,559 reputation">Ernir Erlingsson</a></author></comment><comment><text><span class="comment-copy">Even on newer Android versions FLAG_SECURE can be problematic: on Android 4.3 FLAG_SECURE causes animation problems in screen rotation animation, see <a href="https://code.google.com/p/android/issues/detail?id=58632" rel="nofollow noreferrer">code.google.com/p/android/issues/detail?id=58632</a> - this has been fixed on Android 4.4</span></text><author><a class="comment-user" href="/users/330901/oliver" title="262 reputation">Oliver</a></author></comment><comment><text><span class="comment-copy">Hi... i need to block screenshot for particular activity. but your code suppress the screenshot for whole app.</span></text><author><a class="comment-user" href="/users/3546693/user3546693" title="164 reputation">user3546693</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>The solution provided by CommonsWare continues to be valid also in Lollipop.</p>
<p>Just a note, if you want to continue to <em>not</em> see snapshots in recent list for the <em>entire</em> app, ALL the implemented activities should specify in the <code>onCreate()</code> method the flag <code>getWindow().addFlags(WindowManager.LayoutParams.FLAG_SECURE);</code>
before <code>setContentView();</code></p>
<p>Otherwise a snapshot in the recent list will show the first activity without the flag if the user navigated through it.</p>
</div></text><author><a href="/users/3397345/davidea">Davidea</a></author><comments><comment><text><span class="comment-copy">In my app, I have functionality of setting/clearing FLAG_SECURE based on a user preference. It worked fine till KITKAT and black screen can be seen in task switcher. In Lollipop, the Overview displays the last snapshot of my app, the time when FLAG_SECURE was not set(cleared).</span></text><author><a class="comment-user" href="/users/1263215/r-bhardwaj" title="643 reputation">r.bhardwaj</a></author></comment><comment><text><span class="comment-copy">@r.bhardwaj i think we can't do so much in that case, but you can advice the user that, the change needs App to be restarted to take fully effect ;-) and you are done.</span></text><author><a class="comment-user" href="/users/3397345/davidea" title="1,058 reputation">Davidea</a></author></comment><comment><text><span class="comment-copy">Anyone found a way to inflate a custom view before snapshot is taken so it's not just a black screen? I've tried inflating a view on window manager in onPause, but it seems by then it's too late.</span></text><author><a class="comment-user" href="/users/1064249/user1064249" title="143 reputation">user1064249</a></author></comment></comments></answer></answers></post>