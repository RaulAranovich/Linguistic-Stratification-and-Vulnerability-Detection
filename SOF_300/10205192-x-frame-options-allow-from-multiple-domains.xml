<?xml version="1.0" encoding="utf-8"?>
<post><title>asp.net - X-Frame-Options Allow-From multiple domains - Stack Overflow</title><question><text><div class="post-text" itemprop="text">
<p>I have an asp.net 4.0 IIS7.5 site which I need secured using the x-frame headers option</p>
<p>I also need to enable my site pages to be iframed from my same domain as well as from my facebook app.</p>
<p>Currently I have my site configured with a site headed of:</p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="typ">Response</span><span class="pun">.</span><span class="typ">Headers</span><span class="pun">.</span><span class="typ">Add</span><span class="pun">(</span><span class="str">"X-Frame-Options"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"ALLOW-FROM SAMEDOMAIN, www.facebook.com/MyFBSite"</span><span class="pun">)</span></code></pre>
<p>When I viewed my Facebook page with Chrome or FireFox my sites pages (being iframed with my facebook page) are display ok, but under IE9, I get the error </p>
<blockquote>
<p>"this page cannot be displayed…" (because of the <code>X-Frame_Options</code> restriction).</p>
</blockquote>
<p>How do I set the <code>X-Frame-Options: ALLOW-FROM</code> to support more than a single domain?</p>
<p><code>X-FRAME-OPTION</code> being a new feature seems fundamentally flawed if only a single domain can be defined.</p>
</div></text><author><a href="/users/188331/raptor">Raptor</a></author><comments><comment><text><span class="comment-copy">This seems to be a known limitation: <a href="https://www.owasp.org/index.php/Clickjacking_Defense_Cheat_Sheet#Limitations" rel="nofollow noreferrer">owasp.org/index.php/…</a></span></text><author><a class="comment-user" href="/users/881009/pierre-ernst" title="484 reputation">Pierre Ernst</a></author></comment></comments></question><answers><answer><text><div class="post-text" itemprop="text">
<p><s><code>X-Frame-Options</code> is deprecated. From <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/X-Frame-Options" rel="nofollow noreferrer">MDN</a>:</s></p><s>
</s><blockquote><s>
</s><p><s>This feature has been removed from the Web standards. Though some browsers may still support it, it is in the process of being dropped. Do not use it in old or new projects. Pages or Web apps using it may break at any time.</s></p>
</blockquote>
<p>The modern alternative is the <a href="https://developer.mozilla.org/en-US/docs/Web/Security/CSP/CSP_policy_directives" rel="nofollow noreferrer"><code>Content-Security-Policy</code></a> header, which along many other policies can white-list what URLs are allowed to host your page in a frame, using the <a href="https://developer.mozilla.org/en-US/docs/Web/Security/CSP/CSP_policy_directives#frame-ancestors" rel="nofollow noreferrer"><code>frame-ancestors</code></a> directive.<br/>
<code>frame-ancestors</code> supports multiple domains and even wildcards, for example:</p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="typ">Content</span><span class="pun">-</span><span class="typ">Security</span><span class="pun">-</span><span class="typ">Policy</span><span class="pun">:</span><span class="pln"> frame</span><span class="pun">-</span><span class="pln">ancestors </span><span class="str">'self'</span><span class="pln"> example</span><span class="pun">.</span><span class="pln">com </span><span class="pun">*.</span><span class="pln">example</span><span class="pun">.</span><span class="pln">net </span><span class="pun">;</span></code></pre>
<p>Unfortunately, for now, <a href="http://caniuse.com/#feat=contentsecuritypolicy" rel="nofollow noreferrer">Internet Explorer does not fully support Content-Security-Policy</a>.</p>
<p><b>UPDATE:</b> MDN has removed their deprecation comment. Here's a similar comment from <a href="https://www.w3.org/TR/CSP2/#frame-ancestors-and-frame-options" rel="nofollow noreferrer">W3C's Content Security Policy Level</a> </p>
<blockquote>
<p>The <code>frame-ancestors</code> directive <em>obsoletes</em> the <code>X-Frame-Options</code> header. If a resource has both policies, the <code>frame-ancestors</code> policy SHOULD be enforced and the <code>X-Frame-Options</code> policy SHOULD be ignored.</p>
</blockquote>
</div></text><author><a href="/users/7586/kobi">Kobi</a></author><comments><comment><text><span class="comment-copy">frame-ancestors is marked as "experimental API and should not be used in production code" on MDN. +  X-Frame-Options is not deprecated but "non-standard" but "is widely supported and can be used in conjunction with CSP"</span></text><author><a class="comment-user" href="/users/1758853/jonathan-muller" title="3,368 reputation">Jonathan Muller</a></author></comment><comment><text><span class="comment-copy">@JonathanMuller - The wording on <code>X-Frame-Options</code> changed, and is less severe now. It's a good point that it is risky to used a spec that isn't finalized. Thanks!</span></text><author><a class="comment-user" href="/users/7586/kobi" title="91,728 reputation">Kobi</a></author></comment><comment><text><span class="comment-copy">I can't find the deprectated warning on MDN any more. Has Mozilla changed their opinion?</span></text><author><a class="comment-user" href="/users/1476821/thomaskonrad" title="479 reputation">thomaskonrad</a></author></comment><comment><text><span class="comment-copy">@to0om - Thanks! I updated the answer with another comment. I may have come on too strong in my answer. Either way, <code>X-Frame-Options</code> doesn't support multiple sources.</span></text><author><a class="comment-user" href="/users/7586/kobi" title="91,728 reputation">Kobi</a></author></comment><comment><text><span class="comment-copy">@Kobi, I think the answer needs re-organizing. The very first sentence says that this is deprecated as per the MDN. It'll be less misleading if you add your update at the top (with a bold colored "UPDATE:"). Thanks.</span></text><author><a class="comment-user" href="/users/388714/kasun-gajasinghe" title="2,032 reputation">Kasun Gajasinghe</a></author></comment><comment><text><span class="comment-copy">Note that frame-ancestors will not take priority in firefox, see this bug <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1024557" rel="nofollow noreferrer">bugzilla.mozilla.org/show_bug.cgi?id=1024557</a> and upvote it to try get this fixed.</span></text><author><a class="comment-user" href="/users/5181861/micwit" title="120 reputation">MicWit</a></author></comment><comment><text><span class="comment-copy">Thanks! Solve my issue.</span></text><author><a class="comment-user" href="/users/2788478/andre-mesquita" title="312 reputation">Andre Mesquita</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>From <a href="https://tools.ietf.org/html/rfc7034#section-2.3.2.3" rel="nofollow noreferrer">RFC 7034</a>:</p>
<blockquote>
<p>Wildcards or lists to declare multiple domains in one ALLOW-FROM statement are not permitted</p>
</blockquote>
<p>So,</p>
<blockquote>
<p>How do I set the X-Frame-Options: ALLOW-FROM to support more than a single domain?</p>
</blockquote>
<p>You can't. As a workaround you can use different URLs for different partners. For each URL you can use it's own <code>X-Frame-Options</code> value. For example:</p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="pln">partner   iframe URL       ALLOW</span><span class="pun">-</span><span class="pln">FROM
</span><span class="pun">---------------------------------------</span><span class="pln">
</span><span class="typ">Facebook</span><span class="pln">  fb</span><span class="pun">.</span><span class="pln">yoursite</span><span class="pun">.</span><span class="pln">com  facebook</span><span class="pun">.</span><span class="pln">com
VK</span><span class="pun">.</span><span class="pln">COM    vk</span><span class="pun">.</span><span class="pln">yoursite</span><span class="pun">.</span><span class="pln">com  vk</span><span class="pun">.</span><span class="pln">com</span></code></pre>
<p>For <code>yousite.com</code> you can just use <code>X-Frame-Options: deny</code>.</p>
<p><strong>BTW</strong>, for now Chrome (and all webkit-based browsers) <a href="https://bugs.webkit.org/show_bug.cgi?id=94836" rel="nofollow noreferrer">does not support</a> <code>ALLOW-FROM</code> statements at all.</p>
</div></text><author><a href="/users/539686/vbo">vbo</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>How about an approach that not only allows multiple domains, but allows dynamic domains.</p>
<p>The use case here is with a Sharepoint app part which loads our site inside of Sharepoint via an iframe. The problem is that sharepoint has dynamic subdomains such as <a href="https://yoursite.sharepoint.com" rel="nofollow">https://yoursite.sharepoint.com</a>. So for IE, we need to specify ALLOW-FROM https://.sharepoint.com</p>
<p>Tricky business, but we can get it done knowing two facts:</p>
<ol>
<li><p>When an iframe loads, it only validates the X-Frame-Options on the first request. Once the iframe is loaded, you can navigate within the iframe and the header isn't checked on subsequent requests.</p></li>
<li><p>Also, when an iframe is loaded, the HTTP referer is the parent iframe url.</p></li>
</ol>
<p>You can leverage these two facts server side.  In ruby, I'm using the following code:</p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="pln">  uri </span><span class="pun">=</span><span class="pln"> URI</span><span class="pun">.</span><span class="pln">parse</span><span class="pun">(</span><span class="pln">request</span><span class="pun">.</span><span class="pln">referer</span><span class="pun">)</span><span class="pln">
  </span><span class="kwd">if</span><span class="pln"> uri</span><span class="pun">.</span><span class="pln">host</span><span class="pun">.</span><span class="pln">match</span><span class="pun">(</span><span class="str">/\.sharepoint\.com$/</span><span class="pun">)</span><span class="pln">
    url </span><span class="pun">=</span><span class="pln"> </span><span class="str">"https://#{uri.host}"</span><span class="pln">
    response</span><span class="pun">.</span><span class="pln">headers</span><span class="pun">[</span><span class="str">'X-Frame-Options'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">"ALLOW-FROM #{url}"</span><span class="pln">
  </span><span class="kwd">end</span></code></pre>
<p>Here we can dynamically allow domains based upon the parent domain. In this case, we ensure that the host ends in sharepoint.com keeping our site safe from clickjacking.</p>
<p>I'd love to hear feedback on this approach.</p>
</div></text><author><a href="/users/1490262/peter-p">Peter P.</a></author><comments><comment><text><span class="comment-copy">Caution: this breaks if the host is "fakesharepoint.com". The regex should be: <code>/\.sharepoint\.com$/</code></span></text><author><a class="comment-user" href="/users/703233/nitsas" title="398 reputation">nitsas</a></author></comment><comment><text><span class="comment-copy">thanks @nitsas i updated above</span></text><author><a class="comment-user" href="/users/1490262/peter-p" title="1,624 reputation">Peter P.</a></author></comment><comment><text><span class="comment-copy">That won't work for chrome, as it doesn't support ALLOW-FROM...</span></text><author><a class="comment-user" href="/users/155077/stefan-steiger" title="32,528 reputation">Stefan Steiger</a></author></comment><comment><text><span class="comment-copy">@StefanSteiger that's right, but Chrome also doesn't experience this issue. Chrome and more standards compliant browsers follow the newer Content Security Policy (CSP) model.</span></text><author><a class="comment-user" href="/users/1490262/peter-p" title="1,624 reputation">Peter P.</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>Necromancing. <br/>
The provided answers are incomplete. </p>
<p>First, as already said, you cannot add multiple allow-from hosts, that's not supported. <br/>
Second, you need to dynamically extract that value from the HTTP referrer, which means that you can't add the value to Web.config, because it's not always the same value. </p>
<p>It will be necessary to do browser-detection to avoid adding allow-from when the browser is Chrome (it produces an error on the debug - console, which can quickly fill the console up, or make the application slow). That also means you need to modify the ASP.NET browser detection, as it wrongly identifies Edge as Chrome. </p>
<p>This can be done in ASP.NET by writing a HTTP-module which runs on every request, that appends a http-header for every response, depending on the request's referrer. For Chrome, it needs to add Content-Security-Policy. </p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="com">// https://stackoverflow.com/questions/31870789/check-whether-browser-is-chrome-or-edge</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">BrowserInfo</span><span class="pln">
</span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="typ">Web</span><span class="pun">.</span><span class="typ">HttpBrowserCapabilities</span><span class="pln"> </span><span class="typ">Browser</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">set</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">string</span><span class="pln"> </span><span class="typ">Name</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">set</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">string</span><span class="pln"> </span><span class="typ">Version</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">set</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">string</span><span class="pln"> </span><span class="typ">Platform</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">set</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">bool</span><span class="pln"> </span><span class="typ">IsMobileDevice</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">set</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">string</span><span class="pln"> </span><span class="typ">MobileBrand</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">set</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">string</span><span class="pln"> </span><span class="typ">MobileModel</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">set</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">


    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">BrowserInfo</span><span class="pun">(</span><span class="typ">System</span><span class="pun">.</span><span class="typ">Web</span><span class="pun">.</span><span class="typ">HttpRequest</span><span class="pln"> request</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">request</span><span class="pun">.</span><span class="typ">Browser</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">request</span><span class="pun">.</span><span class="typ">UserAgent</span><span class="pun">.</span><span class="typ">Contains</span><span class="pun">(</span><span class="str">"Edge"</span><span class="pun">)</span><span class="pln">
                </span><span class="pun">&amp;&amp;</span><span class="pln"> request</span><span class="pun">.</span><span class="typ">Browser</span><span class="pun">.</span><span class="typ">Browser</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="str">"Edge"</span><span class="pun">)</span><span class="pln">
            </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">this</span><span class="pun">.</span><span class="typ">Name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Edge"</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            </span><span class="kwd">else</span><span class="pln">
            </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">this</span><span class="pun">.</span><span class="typ">Name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> request</span><span class="pun">.</span><span class="typ">Browser</span><span class="pun">.</span><span class="typ">Browser</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">this</span><span class="pun">.</span><span class="typ">Version</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> request</span><span class="pun">.</span><span class="typ">Browser</span><span class="pun">.</span><span class="typ">MajorVersion</span><span class="pun">.</span><span class="typ">ToString</span><span class="pun">();</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            </span><span class="kwd">this</span><span class="pun">.</span><span class="typ">Browser</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> request</span><span class="pun">.</span><span class="typ">Browser</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">this</span><span class="pun">.</span><span class="typ">Platform</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> request</span><span class="pun">.</span><span class="typ">Browser</span><span class="pun">.</span><span class="typ">Platform</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">this</span><span class="pun">.</span><span class="typ">IsMobileDevice</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> request</span><span class="pun">.</span><span class="typ">Browser</span><span class="pun">.</span><span class="typ">IsMobileDevice</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="typ">IsMobileDevice</span><span class="pun">)</span><span class="pln">
            </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">this</span><span class="pun">.</span><span class="typ">Name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> request</span><span class="pun">.</span><span class="typ">Browser</span><span class="pun">.</span><span class="typ">Browser</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">


</span><span class="pun">}</span><span class="pln">


</span><span class="kwd">void</span><span class="pln"> context_EndRequest</span><span class="pun">(</span><span class="kwd">object</span><span class="pln"> sender</span><span class="pun">,</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="typ">EventArgs</span><span class="pln"> e</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="typ">System</span><span class="pun">.</span><span class="typ">Web</span><span class="pun">.</span><span class="typ">HttpContext</span><span class="pun">.</span><span class="typ">Current</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="typ">Web</span><span class="pun">.</span><span class="typ">HttpContext</span><span class="pun">.</span><span class="typ">Current</span><span class="pun">.</span><span class="typ">Response</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">System</span><span class="pun">.</span><span class="typ">Web</span><span class="pun">.</span><span class="typ">HttpResponse</span><span class="pln"> response </span><span class="pun">=</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="typ">Web</span><span class="pun">.</span><span class="typ">HttpContext</span><span class="pun">.</span><span class="typ">Current</span><span class="pun">.</span><span class="typ">Response</span><span class="pun">;</span><span class="pln">

        </span><span class="kwd">try</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
            </span><span class="com">// response.Headers["P3P"] = "CP=\\\"IDC DSP COR ADM DEVi TAIi PSA PSD IVAi IVDi CONi HIS OUR IND CNT\\\"":</span><span class="pln">
            </span><span class="com">// response.Headers.Set("P3P", "CP=\\\"IDC DSP COR ADM DEVi TAIi PSA PSD IVAi IVDi CONi HIS OUR IND CNT\\\"");</span><span class="pln">
            </span><span class="com">// response.AddHeader("P3P", "CP=\\\"IDC DSP COR ADM DEVi TAIi PSA PSD IVAi IVDi CONi HIS OUR IND CNT\\\"");</span><span class="pln">
            response</span><span class="pun">.</span><span class="typ">AppendHeader</span><span class="pun">(</span><span class="str">"P3P"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"CP=\\\"IDC DSP COR ADM DEVi TAIi PSA PSD IVAi IVDi CONi HIS OUR IND CNT\\\""</span><span class="pun">);</span><span class="pln">

            </span><span class="com">// response.AppendHeader("X-Frame-Options", "DENY");</span><span class="pln">
            </span><span class="com">// response.AppendHeader("X-Frame-Options", "SAMEORIGIN");</span><span class="pln">
            </span><span class="com">// response.AppendHeader("X-Frame-Options", "AllowAll");</span><span class="pln">

            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="typ">System</span><span class="pun">.</span><span class="typ">Web</span><span class="pun">.</span><span class="typ">HttpContext</span><span class="pun">.</span><span class="typ">Current</span><span class="pun">.</span><span class="typ">Request</span><span class="pun">.</span><span class="typ">UrlReferrer</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln">
            </span><span class="pun">{</span><span class="pln">
                </span><span class="com">// "X-Frame-Options": "ALLOW-FROM " Not recognized in Chrome </span><span class="pln">
                </span><span class="kwd">string</span><span class="pln"> host </span><span class="pun">=</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="typ">Web</span><span class="pun">.</span><span class="typ">HttpContext</span><span class="pun">.</span><span class="typ">Current</span><span class="pun">.</span><span class="typ">Request</span><span class="pun">.</span><span class="typ">UrlReferrer</span><span class="pun">.</span><span class="typ">Scheme</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="typ">Uri</span><span class="pun">.</span><span class="typ">SchemeDelimiter</span><span class="pln">
                            </span><span class="pun">+</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="typ">Web</span><span class="pun">.</span><span class="typ">HttpContext</span><span class="pun">.</span><span class="typ">Current</span><span class="pun">.</span><span class="typ">Request</span><span class="pun">.</span><span class="typ">UrlReferrer</span><span class="pun">.</span><span class="typ">Authority</span><span class="pln">
                </span><span class="pun">;</span><span class="pln">

                </span><span class="kwd">string</span><span class="pln"> selfAuth </span><span class="pun">=</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="typ">Web</span><span class="pun">.</span><span class="typ">HttpContext</span><span class="pun">.</span><span class="typ">Current</span><span class="pun">.</span><span class="typ">Request</span><span class="pun">.</span><span class="typ">Url</span><span class="pun">.</span><span class="typ">Authority</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">string</span><span class="pln"> refAuth </span><span class="pun">=</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="typ">Web</span><span class="pun">.</span><span class="typ">HttpContext</span><span class="pun">.</span><span class="typ">Current</span><span class="pun">.</span><span class="typ">Request</span><span class="pun">.</span><span class="typ">UrlReferrer</span><span class="pun">.</span><span class="typ">Authority</span><span class="pun">;</span><span class="pln">

                </span><span class="com">// SQL.Log(System.Web.HttpContext.Current.Request.RawUrl, System.Web.HttpContext.Current.Request.UrlReferrer.OriginalString, refAuth);</span><span class="pln">

                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="typ">IsHostAllowed</span><span class="pun">(</span><span class="pln">refAuth</span><span class="pun">))</span><span class="pln">
                </span><span class="pun">{</span><span class="pln">
                    </span><span class="typ">BrowserInfo</span><span class="pln"> bi </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BrowserInfo</span><span class="pun">(</span><span class="typ">System</span><span class="pun">.</span><span class="typ">Web</span><span class="pun">.</span><span class="typ">HttpContext</span><span class="pun">.</span><span class="typ">Current</span><span class="pun">.</span><span class="typ">Request</span><span class="pun">);</span><span class="pln">

                    </span><span class="com">// bi.Name = Firefox</span><span class="pln">
                    </span><span class="com">// bi.Name = InternetExplorer</span><span class="pln">
                    </span><span class="com">// bi.Name = Chrome</span><span class="pln">

                    </span><span class="com">// Chrome wants entire path... </span><span class="pln">
                    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="typ">System</span><span class="pun">.</span><span class="typ">StringComparer</span><span class="pun">.</span><span class="typ">OrdinalIgnoreCase</span><span class="pun">.</span><span class="typ">Equals</span><span class="pun">(</span><span class="pln">bi</span><span class="pun">.</span><span class="typ">Name</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Chrome"</span><span class="pun">))</span><span class="pln">
                        response</span><span class="pun">.</span><span class="typ">AppendHeader</span><span class="pun">(</span><span class="str">"X-Frame-Options"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"ALLOW-FROM "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> host</span><span class="pun">);</span><span class="pln">    

                    </span><span class="com">// unsafe-eval: invalid JSON https://github.com/keen/keen-js/issues/394</span><span class="pln">
                    </span><span class="com">// unsafe-inline: styles</span><span class="pln">
                    </span><span class="com">// data: url(data:image/png:...)</span><span class="pln">

                    </span><span class="com">// https://www.owasp.org/index.php/Clickjacking_Defense_Cheat_Sheet</span><span class="pln">
                    </span><span class="com">// https://www.ietf.org/rfc/rfc7034.txt</span><span class="pln">
                    </span><span class="com">// https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options</span><span class="pln">
                    </span><span class="com">// https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP</span><span class="pln">

                    </span><span class="com">// https://stackoverflow.com/questions/10205192/x-frame-options-allow-from-multiple-domains</span><span class="pln">
                    </span><span class="com">// https://content-security-policy.com/</span><span class="pln">
                    </span><span class="com">// http://rehansaeed.com/content-security-policy-for-asp-net-mvc/</span><span class="pln">

                    </span><span class="com">// This is for Chrome:</span><span class="pln">
                    </span><span class="com">// response.AppendHeader("Content-Security-Policy", "default-src 'self' 'unsafe-inline' 'unsafe-eval' data: *.msecnd.net vortex.data.microsoft.com " + selfAuth + " " + refAuth);</span><span class="pln">


                    </span><span class="typ">System</span><span class="pun">.</span><span class="typ">Collections</span><span class="pun">.</span><span class="typ">Generic</span><span class="pun">.</span><span class="typ">List</span><span class="str">&lt;string&gt;</span><span class="pln"> ls </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="typ">Collections</span><span class="pun">.</span><span class="typ">Generic</span><span class="pun">.</span><span class="typ">List</span><span class="str">&lt;string&gt;</span><span class="pun">();</span><span class="pln">
                    ls</span><span class="pun">.</span><span class="typ">Add</span><span class="pun">(</span><span class="str">"default-src"</span><span class="pun">);</span><span class="pln">
                    ls</span><span class="pun">.</span><span class="typ">Add</span><span class="pun">(</span><span class="str">"'self'"</span><span class="pun">);</span><span class="pln">
                    ls</span><span class="pun">.</span><span class="typ">Add</span><span class="pun">(</span><span class="str">"'unsafe-inline'"</span><span class="pun">);</span><span class="pln">
                    ls</span><span class="pun">.</span><span class="typ">Add</span><span class="pun">(</span><span class="str">"'unsafe-eval'"</span><span class="pun">);</span><span class="pln">
                    ls</span><span class="pun">.</span><span class="typ">Add</span><span class="pun">(</span><span class="str">"data:"</span><span class="pun">);</span><span class="pln">

                    </span><span class="com">// http://az416426.vo.msecnd.net/scripts/a/ai.0.js</span><span class="pln">

                    </span><span class="com">// ls.Add("*.msecnd.net");</span><span class="pln">
                    </span><span class="com">// ls.Add("vortex.data.microsoft.com");</span><span class="pln">

                    ls</span><span class="pun">.</span><span class="typ">Add</span><span class="pun">(</span><span class="pln">selfAuth</span><span class="pun">);</span><span class="pln">
                    ls</span><span class="pun">.</span><span class="typ">Add</span><span class="pun">(</span><span class="pln">refAuth</span><span class="pun">);</span><span class="pln">

                    </span><span class="kwd">string</span><span class="pln"> contentSecurityPolicy </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">string</span><span class="pun">.</span><span class="typ">Join</span><span class="pun">(</span><span class="str">" "</span><span class="pun">,</span><span class="pln"> ls</span><span class="pun">.</span><span class="typ">ToArray</span><span class="pun">());</span><span class="pln">
                    response</span><span class="pun">.</span><span class="typ">AppendHeader</span><span class="pun">(</span><span class="str">"Content-Security-Policy"</span><span class="pun">,</span><span class="pln"> contentSecurityPolicy</span><span class="pun">);</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
                </span><span class="kwd">else</span><span class="pln">
                </span><span class="pun">{</span><span class="pln">
                    response</span><span class="pun">.</span><span class="typ">AppendHeader</span><span class="pun">(</span><span class="str">"X-Frame-Options"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"SAMEORIGIN"</span><span class="pun">);</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">

            </span><span class="pun">}</span><span class="pln">
            </span><span class="kwd">else</span><span class="pln">
                response</span><span class="pun">.</span><span class="typ">AppendHeader</span><span class="pun">(</span><span class="str">"X-Frame-Options"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"SAMEORIGIN"</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">System</span><span class="pun">.</span><span class="typ">Exception</span><span class="pln"> ex</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
            </span><span class="com">// WTF ? </span><span class="pln">
            </span><span class="typ">System</span><span class="pun">.</span><span class="typ">Console</span><span class="pun">.</span><span class="typ">WriteLine</span><span class="pun">(</span><span class="pln">ex</span><span class="pun">.</span><span class="typ">Message</span><span class="pun">);</span><span class="pln"> </span><span class="com">// Suppress warning</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

    </span><span class="pun">}</span><span class="pln"> </span><span class="com">// End if (System.Web.HttpContext.Current != null &amp;&amp; System.Web.HttpContext.Current.Response != null)</span><span class="pln">

</span><span class="pun">}</span><span class="pln"> </span><span class="com">// End Using context_EndRequest</span><span class="pln">


</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">string</span><span class="pun">[]</span><span class="pln"> s_allowedHosts </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="kwd">string</span><span class="pun">[]</span><span class="pln"> 
</span><span class="pun">{</span><span class="pln">
     </span><span class="str">"localhost:49533"</span><span class="pln">
    </span><span class="pun">,</span><span class="str">"localhost:52257"</span><span class="pln">
    </span><span class="pun">,</span><span class="str">"vmswisslife"</span><span class="pln">
    </span><span class="pun">,</span><span class="str">"vmraiffeisen"</span><span class="pln">
    </span><span class="pun">,</span><span class="str">"vmpost"</span><span class="pln">
    </span><span class="pun">,</span><span class="str">"example.com"</span><span class="pln">
</span><span class="pun">};</span><span class="pln">


</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">bool</span><span class="pln"> </span><span class="typ">IsHostAllowed</span><span class="pun">(</span><span class="kwd">string</span><span class="pln"> host</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Contains</span><span class="pun">(</span><span class="pln">s_allowedHosts</span><span class="pun">,</span><span class="pln"> host</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="com">// End Function IsHostAllowed </span><span class="pln">


</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">bool</span><span class="pln"> </span><span class="typ">Contains</span><span class="pun">(</span><span class="kwd">string</span><span class="pun">[]</span><span class="pln"> allowed</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">string</span><span class="pln"> current</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> allowed</span><span class="pun">.</span><span class="typ">Length</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="typ">System</span><span class="pun">.</span><span class="typ">StringComparer</span><span class="pun">.</span><span class="typ">OrdinalIgnoreCase</span><span class="pun">.</span><span class="typ">Equals</span><span class="pun">(</span><span class="pln">allowed</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> current</span><span class="pun">))</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="com">// Next i </span><span class="pln">

    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="com">// End Function Contains </span></code></pre>
<p>You need to register the context_EndRequest function in the HTTP-module Init function. </p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">RequestLanguageChanger</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="typ">Web</span><span class="pun">.</span><span class="typ">IHttpModule</span><span class="pln">
</span><span class="pun">{</span><span class="pln">


    </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="typ">Web</span><span class="pun">.</span><span class="typ">IHttpModule</span><span class="pun">.</span><span class="typ">Dispose</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="com">// throw new NotImplementedException();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">


    </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="typ">Web</span><span class="pun">.</span><span class="typ">IHttpModule</span><span class="pun">.</span><span class="typ">Init</span><span class="pun">(</span><span class="typ">System</span><span class="pun">.</span><span class="typ">Web</span><span class="pun">.</span><span class="typ">HttpApplication</span><span class="pln"> context</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="com">// https://stackoverflow.com/questions/441421/httpmodule-event-execution-order</span><span class="pln">
        context</span><span class="pun">.</span><span class="typ">EndRequest</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="typ">EventHandler</span><span class="pun">(</span><span class="pln">context_EndRequest</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="com">// context_EndRequest Code from above comes here</span><span class="pln">


</span><span class="pun">}</span></code></pre>
<p>Next you need to add the module to your application. 
You can either do this programmatically in Global.asax by overriding the Init function of the HttpApplication, like this:</p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="kwd">namespace</span><span class="pln"> </span><span class="typ">ChangeRequestLanguage</span><span class="pln">
</span><span class="pun">{</span><span class="pln">


    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Global</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="typ">Web</span><span class="pun">.</span><span class="typ">HttpApplication</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">

        </span><span class="typ">System</span><span class="pun">.</span><span class="typ">Web</span><span class="pun">.</span><span class="typ">IHttpModule</span><span class="pln"> mod </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> libRequestLanguageChanger</span><span class="pun">.</span><span class="typ">RequestLanguageChanger</span><span class="pun">();</span><span class="pln">

        </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">override</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">Init</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
            mod</span><span class="pun">.</span><span class="typ">Init</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">base</span><span class="pun">.</span><span class="typ">Init</span><span class="pun">();</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">



        </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">Application_Start</span><span class="pun">(</span><span class="kwd">object</span><span class="pln"> sender</span><span class="pun">,</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="typ">EventArgs</span><span class="pln"> e</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">

        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">Session_Start</span><span class="pun">(</span><span class="kwd">object</span><span class="pln"> sender</span><span class="pun">,</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="typ">EventArgs</span><span class="pln"> e</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">

        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">Application_BeginRequest</span><span class="pun">(</span><span class="kwd">object</span><span class="pln"> sender</span><span class="pun">,</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="typ">EventArgs</span><span class="pln"> e</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">

        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">Application_AuthenticateRequest</span><span class="pun">(</span><span class="kwd">object</span><span class="pln"> sender</span><span class="pun">,</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="typ">EventArgs</span><span class="pln"> e</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">

        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">Application_Error</span><span class="pun">(</span><span class="kwd">object</span><span class="pln"> sender</span><span class="pun">,</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="typ">EventArgs</span><span class="pln"> e</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">

        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">Session_End</span><span class="pun">(</span><span class="kwd">object</span><span class="pln"> sender</span><span class="pun">,</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="typ">EventArgs</span><span class="pln"> e</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">

        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">Application_End</span><span class="pun">(</span><span class="kwd">object</span><span class="pln"> sender</span><span class="pun">,</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="typ">EventArgs</span><span class="pln"> e</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">

        </span><span class="pun">}</span><span class="pln">


    </span><span class="pun">}</span><span class="pln">


</span><span class="pun">}</span></code></pre>
<p>or you can add entries to Web.config if you don't own the application source-code:</p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="pln">      </span><span class="tag">&lt;httpModules&gt;</span><span class="pln">
        </span><span class="tag">&lt;add</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"RequestLanguageChanger"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="pln"> </span><span class="atv">"libRequestLanguageChanger.RequestLanguageChanger, libRequestLanguageChanger"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
      </span><span class="tag">&lt;/httpModules&gt;</span><span class="pln">
    </span><span class="tag">&lt;/system.web&gt;</span><span class="pln">

  </span><span class="tag">&lt;system.webServer&gt;</span><span class="pln">
    </span><span class="tag">&lt;validation</span><span class="pln"> </span><span class="atn">validateIntegratedModeConfiguration</span><span class="pun">=</span><span class="atv">"false"</span><span class="tag">/&gt;</span><span class="pln">

    </span><span class="tag">&lt;modules</span><span class="pln"> </span><span class="atn">runAllManagedModulesForAllRequests</span><span class="pun">=</span><span class="atv">"true"</span><span class="tag">&gt;</span><span class="pln">
      </span><span class="tag">&lt;add</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"RequestLanguageChanger"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"libRequestLanguageChanger.RequestLanguageChanger, libRequestLanguageChanger"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/modules&gt;</span><span class="pln">
  </span><span class="tag">&lt;/system.webServer&gt;</span><span class="pln">
</span><span class="tag">&lt;/configuration&gt;</span></code></pre>
<p>The entry in system.webServer is for IIS7+, the other in system.web is for IIS 6. <br/>
Note that you need to set runAllManagedModulesForAllRequests to true, for that it works properly. </p>
<p>The string in type is in the format <code>"Namespace.Class, Assembly"</code>. 
Note that if you write your assembly in VB.NET instead of C#, VB creates a default-Namespace for each project, so your string will look like</p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="str">"[DefaultNameSpace.Namespace].Class, Assembly"</span></code></pre>
<p>If you want to avoid this problem, write the DLL in C#.</p>
</div></text><author><a href="/users/155077/stefan-steiger">Stefan Steiger</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>Not exactly the same, but could work for some cases: there is another option <code>ALLOWALL</code> which will effectively remove the restriction, which might be a nice thing for testing/pre-production environments</p>
</div></text><author><a href="/users/842262/willyfrog">Willyfrog</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>One possible workaround would be using a "frame-breaker" script as described <a href="https://www.owasp.org/index.php/Clickjacking_Defense_Cheat_Sheet#Best-for-now_Legacy_Browser_Frame_Breaking_Script" rel="nofollow">here</a></p>
<p>You just need to alter the "if" statement to check for your allowed domains.</p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="pln">   </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">self</span><span class="pln"> </span><span class="pun">===</span><span class="pln"> top</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
       </span><span class="kwd">var</span><span class="pln"> antiClickjack </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">"antiClickjack"</span><span class="pun">);</span><span class="pln">
       antiClickjack</span><span class="pun">.</span><span class="pln">parentNode</span><span class="pun">.</span><span class="pln">removeChild</span><span class="pun">(</span><span class="pln">antiClickjack</span><span class="pun">);</span><span class="pln">
   </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
       </span><span class="com">//your domain check goes here</span><span class="pln">
       </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">top</span><span class="pun">.</span><span class="pln">location</span><span class="pun">.</span><span class="pln">host </span><span class="pun">!=</span><span class="pln"> </span><span class="str">"allowed.domain1.com"</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> top</span><span class="pun">.</span><span class="pln">location</span><span class="pun">.</span><span class="pln">host </span><span class="pun">==</span><span class="pln"> </span><span class="str">"allowed.domain2.com"</span><span class="pun">)</span><span class="pln">
         top</span><span class="pun">.</span><span class="pln">location </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">location</span><span class="pun">;</span><span class="pln">
   </span><span class="pun">}</span></code></pre>
<p>This workaround would be safe, I think. because with javascript not enabled you will have no security concern about a malicious website framing your page.</p>
</div></text><author><a href="/users/2110930/sinax">SinaX</a></author><comments><comment><text><span class="comment-copy">This won't work due to same origin policy when calling top.location.</span></text><author><a class="comment-user" href="/users/550552/eric-r" title="443 reputation">Eric R.</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>YES. This method allowed multiple domain.</p>
<p>VB.NET</p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="pln">response</span><span class="pun">.</span><span class="pln">headers</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="str">"X-Frame-Options"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"ALLOW-FROM "</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> request</span><span class="pun">.</span><span class="pln">urlreferer</span><span class="pun">.</span><span class="pln">tostring</span><span class="pun">())</span></code></pre>
</div></text><author><a href="/users/4778040/user4778040">user4778040</a></author><comments><comment><text><span class="comment-copy">This seems to defeat the purpose of X-Frame-Options as it allows any site to frame.</span></text><author><a class="comment-user" href="/users/39068/andrey-shchekin" title="10,632 reputation">Andrey Shchekin</a></author></comment><comment><text><span class="comment-copy">This answer seems like it could be a good base as a solution but it needs extra logic so that it only executes this code if the request.urlreferer.tostring() is one of the origins you wish to allow.</span></text><author><a class="comment-user" href="/users/1035180/zergleb" title="947 reputation">Zergleb</a></author></comment><comment><text><span class="comment-copy">If you are doing this, why are you even using X-Frame-Options Header... just ignore it</span></text><author><a class="comment-user" href="/users/258086/vs4vijay" title="614 reputation">vs4vijay</a></author></comment></comments></answer></answers></post>