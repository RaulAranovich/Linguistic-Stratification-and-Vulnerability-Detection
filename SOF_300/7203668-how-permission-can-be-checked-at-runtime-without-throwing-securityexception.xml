<?xml version="1.0" encoding="utf-8"?>
<post><title>android - How permission can be checked at runtime without throwing SecurityException? - Stack Overflow</title><question><text><div class="post-text" itemprop="text">
<p>I design a function that may get/set a resource from SD and if not found from sd then take it from Asset and if possible write the asset back to SD<br/>
This function may check by method invocation if SD is mounted and accessible...</p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="kwd">boolean</span><span class="pln"> bSDisAvalaible </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Environment</span><span class="pun">.</span><span class="pln">getExternalStorageState</span><span class="pun">().</span><span class="pln">equals</span><span class="pun">(</span><span class="typ">Environment</span><span class="pun">.</span><span class="pln">MEDIA_MOUNTED</span><span class="pun">);</span></code></pre>
<p>My designed function may be used from one app(project) to another (with or without android.permission.WRITE_EXTERNAL_STORAGE)</p>
<p>Then I would like to check if the current application has this particular permission without playing with SecurityException.</p>
<p>Does it exist a "nice" way to consult current defined permissions at runtime ?</p>
</div></text><author><a href="/users/574131/emmanuel-devaux">Emmanuel Devaux</a></author><comments/></question><answers><answer><text><div class="post-text" itemprop="text">
<p>You can use <code>Context.checkCallingorSelfPermission()</code> function for this. Here is an example:</p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="kwd">private</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> checkWriteExternalPermission</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">

    </span><span class="typ">String</span><span class="pln"> permission </span><span class="pun">=</span><span class="pln"> </span><span class="str">"android.permission.WRITE_EXTERNAL_STORAGE"</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> res </span><span class="pun">=</span><span class="pln"> getContext</span><span class="pun">().</span><span class="pln">checkCallingOrSelfPermission</span><span class="pun">(</span><span class="pln">permission</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln">res </span><span class="pun">==</span><span class="pln"> </span><span class="typ">PackageManager</span><span class="pun">.</span><span class="pln">PERMISSION_GRANTED</span><span class="pun">);</span><span class="pln">            
</span><span class="pun">}</span></code></pre>
</div></text><author><a href="/users/69802/inazaruk">inazaruk</a></author><comments><comment><text><span class="comment-copy">This method may present a security risk.</span></text><author><a class="comment-user" href="/users/1185841/talmihr" title="482 reputation">TalMihr</a></author></comment><comment><text><span class="comment-copy">@TalMihr why do you believe `checkCallingOrSelfPermission()' poses a security risk?</span></text><author><a class="comment-user" href="/users/493682/william" title="13,085 reputation">William</a></author></comment><comment><text><span class="comment-copy">@inazaruk , is it possible to grant the permission if not granted by system?</span></text><author><a class="comment-user" href="/users/651541/mr-sajid-shaikh" title="2,462 reputation">Mr. Sajid Shaikh</a></author></comment><comment><text><span class="comment-copy">No. You can't give yourself a permission at runtime.</span></text><author><a class="comment-user" href="/users/2197700/anubian-noob" title="10,171 reputation">Anubian Noob</a></author></comment><comment><text><span class="comment-copy">It is better to use <code>checkCallingPermission()</code> instead of <code>checkCallingOrSelfPermission()</code> method.</span></text><author><a class="comment-user" href="/users/1043882/hasanghaforian" title="9,083 reputation">hasanghaforian</a></author></comment><comment><text><span class="comment-copy">There is now a comatibility wrapper for this: ContextCompat.checkSelfPermission</span></text><author><a class="comment-user" href="/users/377014/yoah" title="6,042 reputation">yoah</a></author></comment><comment><text><span class="comment-copy">So if the method returns true than the device has the ability to run the code of the permission? Then, can I check for the permission like so? <code>if(checkWriteExternalPermission()){ //Do code }</code> ?</span></text><author><a class="comment-user" href="/users/5144855/ruchir-baronia" title="2,129 reputation">Ruchir Baronia</a></author></comment><comment><text><span class="comment-copy">Adding to say you can also use <code>ContextCompat.checkSelfPermission</code>. So the expression could look something like this: ContextCompat.checkSelfPermission(getContext(), Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED</span></text><author><a class="comment-user" href="/users/1765893/pedro-lopes" title="1,347 reputation">Pedro Lopes</a></author></comment><comment><text><span class="comment-copy">these checking won't work target versions below 23</span></text><author><a class="comment-user" href="/users/5351055/manoj-frekzz" title="615 reputation">Manoj Frekzz</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>This is another solution as well </p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="typ">PackageManager</span><span class="pln"> pm </span><span class="pun">=</span><span class="pln"> context</span><span class="pun">.</span><span class="pln">getPackageManager</span><span class="pun">();</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> hasPerm </span><span class="pun">=</span><span class="pln"> pm</span><span class="pun">.</span><span class="pln">checkPermission</span><span class="pun">(</span><span class="pln">
    android</span><span class="pun">.</span><span class="typ">Manifest</span><span class="pun">.</span><span class="pln">permission</span><span class="pun">.</span><span class="pln">WRITE_EXTERNAL_STORAGE</span><span class="pun">,</span><span class="pln"> 
    context</span><span class="pun">.</span><span class="pln">getPackageName</span><span class="pun">());</span><span class="pln">
</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">hasPerm </span><span class="pun">!=</span><span class="pln"> </span><span class="typ">PackageManager</span><span class="pun">.</span><span class="pln">PERMISSION_GRANTED</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="com">// do stuff</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div></text><author><a href="/users/748317/user123321">user123321</a></author><comments><comment><text><span class="comment-copy">So should I just wrap this code inside of that if statement? I made this to see if the user is getting a call, or is in a call, to mute the audio: <a href="http://snag.gy/uIxsv.jpg" rel="nofollow noreferrer">snag.gy/uIxsv.jpg</a></span></text><author><a class="comment-user" href="/users/5144855/ruchir-baronia" title="2,129 reputation">Ruchir Baronia</a></author></comment><comment><text><span class="comment-copy">Doing that gets me so many errors... <a href="http://snag.gy/cF7JU.jpg" rel="nofollow noreferrer">snag.gy/cF7JU.jpg</a></span></text><author><a class="comment-user" href="/users/5144855/ruchir-baronia" title="2,129 reputation">Ruchir Baronia</a></author></comment><comment><text><span class="comment-copy">Which is the difference on calling the package for permission or the iPC?</span></text><author><a class="comment-user" href="/users/505152/htafoya" title="7,559 reputation">htafoya</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>You can also use this:</p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="kwd">private</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> doesUserHavePermission</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> context</span><span class="pun">.</span><span class="pln">checkCallingOrSelfPermission</span><span class="pun">(</span><span class="typ">Manifest</span><span class="pun">.</span><span class="pln">permission</span><span class="pun">.</span><span class="pln">WRITE_EXTERNAL_STORAGE</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> result </span><span class="pun">==</span><span class="pln"> </span><span class="typ">PackageManager</span><span class="pun">.</span><span class="pln">PERMISSION_GRANTED</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div></text><author><a href="/users/1898988/mrappa">MrAppa</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>Like Google <a href="http://developer.android.com/intl/es/training/permissions/requesting.html#perm-check">documentation</a>: </p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="com">// Assume thisActivity is the current activity</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> permissionCheck </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ContextCompat</span><span class="pun">.</span><span class="pln">checkSelfPermission</span><span class="pun">(</span><span class="pln">thisActivity</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Manifest</span><span class="pun">.</span><span class="pln">permission</span><span class="pun">.</span><span class="pln">WRITE_EXTERNAL_STORAGE</span><span class="pun">);</span></code></pre>
</div></text><author><a href="/users/916366/beni">beni</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>Sharing my methods in case someone needs them:</p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="pln"> </span><span class="com">/** Determines if the context calling has the required permission
 * @param context - the IPC context
 * @param permissions - The permissions to check
 * @return true if the IPC has the granted permission
 */</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> hasPermission</span><span class="pun">(</span><span class="typ">Context</span><span class="pln"> context</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> permission</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">int</span><span class="pln"> res </span><span class="pun">=</span><span class="pln"> context</span><span class="pun">.</span><span class="pln">checkCallingOrSelfPermission</span><span class="pun">(</span><span class="pln">permission</span><span class="pun">);</span><span class="pln">

    </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">v</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"permission: "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> permission </span><span class="pun">+</span><span class="pln"> </span><span class="str">" = \t\t"</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> 
    </span><span class="pun">(</span><span class="pln">res </span><span class="pun">==</span><span class="pln"> </span><span class="typ">PackageManager</span><span class="pun">.</span><span class="pln">PERMISSION_GRANTED </span><span class="pun">?</span><span class="pln"> </span><span class="str">"GRANTED"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"DENIED"</span><span class="pun">));</span><span class="pln">

    </span><span class="kwd">return</span><span class="pln"> res </span><span class="pun">==</span><span class="pln"> </span><span class="typ">PackageManager</span><span class="pun">.</span><span class="pln">PERMISSION_GRANTED</span><span class="pun">;</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="com">/** Determines if the context calling has the required permissions
 * @param context - the IPC context
 * @param permissions - The permissions to check
 * @return true if the IPC has the granted permission
 */</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> hasPermissions</span><span class="pun">(</span><span class="typ">Context</span><span class="pln"> context</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">...</span><span class="pln"> permissions</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">boolean</span><span class="pln"> hasAllPermissions </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">for</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> permission </span><span class="pun">:</span><span class="pln"> permissions</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//return false instead of assigning, but with this you can log all permission values</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln"> hasPermission</span><span class="pun">(</span><span class="pln">context</span><span class="pun">,</span><span class="pln"> permission</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">hasAllPermissions </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">return</span><span class="pln"> hasAllPermissions</span><span class="pun">;</span><span class="pln">

</span><span class="pun">}</span></code></pre>
<p>And to call it:</p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="kwd">boolean</span><span class="pln"> hasAndroidPermissions </span><span class="pun">=</span><span class="pln"> </span><span class="typ">SystemUtils</span><span class="pun">.</span><span class="pln">hasPermissions</span><span class="pun">(</span><span class="pln">mContext</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">String</span><span class="pun">[]</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                android</span><span class="pun">.</span><span class="typ">Manifest</span><span class="pun">.</span><span class="pln">permission</span><span class="pun">.</span><span class="pln">ACCESS_WIFI_STATE</span><span class="pun">,</span><span class="pln">
                android</span><span class="pun">.</span><span class="typ">Manifest</span><span class="pun">.</span><span class="pln">permission</span><span class="pun">.</span><span class="pln">READ_PHONE_STATE</span><span class="pun">,</span><span class="pln">
                android</span><span class="pun">.</span><span class="typ">Manifest</span><span class="pun">.</span><span class="pln">permission</span><span class="pun">.</span><span class="pln">ACCESS_NETWORK_STATE</span><span class="pun">,</span><span class="pln">
                android</span><span class="pun">.</span><span class="typ">Manifest</span><span class="pun">.</span><span class="pln">permission</span><span class="pun">.</span><span class="pln">INTERNET</span><span class="pun">,</span><span class="pln">
        </span><span class="pun">});</span></code></pre>
</div></text><author><a href="/users/505152/htafoya">htafoya</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>You should check for permissions in the following way (as described here <a href="https://developer.android.com/training/permissions/requesting.html" rel="nofollow">Android permissions</a>):</p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="kwd">int</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ContextCompat</span><span class="pun">.</span><span class="pln">checkSelfPermission</span><span class="pun">(</span><span class="pln">getContext</span><span class="pun">(),</span><span class="pln"> </span><span class="typ">Manifest</span><span class="pun">.</span><span class="pln">permission</span><span class="pun">.</span><span class="pln">READ_PHONE_STATE</span><span class="pun">);</span></code></pre>
<p>then, compare your result to either:</p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="pln">result </span><span class="pun">==</span><span class="pln"> </span><span class="typ">PackageManager</span><span class="pun">.</span><span class="pln">PERMISSION_DENIED</span></code></pre>
<p>or:</p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="pln">result </span><span class="pun">==</span><span class="pln"> </span><span class="typ">PackageManager</span><span class="pun">.</span><span class="pln">PERMISSION_GRANTED</span></code></pre>
</div></text><author><a href="/users/1299158/box">box</a></author><comments><comment><text><span class="comment-copy">Thanks. This was helpful.</span></text><author><a class="comment-user" href="/users/3034693/sudhir-khanger" title="961 reputation">Sudhir Khanger</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>The code which works fine for me is :-</p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="pln">  </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> MY_PERMISSIONS_REQUEST_WRITE_EXTERNAL_STORAGE </span><span class="pun">=</span><span class="pln"> </span><span class="lit">102</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">((</span><span class="typ">ContextCompat</span><span class="pun">.</span><span class="pln">checkSelfPermission</span><span class="pun">(</span><span class="pln">getActivity</span><span class="pun">(),</span><span class="typ">Manifest</span><span class="pun">.</span><span class="pln">permission</span><span class="pun">.</span><span class="pln">WRITE_EXTERNAL_STORAGE</span><span class="pun">)</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="typ">PackageManager</span><span class="pun">.</span><span class="pln">PERMISSION_GRANTED</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

                requestPermissions</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">String</span><span class="pun">[]{</span><span class="typ">Manifest</span><span class="pun">.</span><span class="pln">permission</span><span class="pun">.</span><span class="pln">WRITE_EXTERNAL_STORAGE</span><span class="pun">},</span><span class="pln">
                        MY_PERMISSIONS_REQUEST_WRITE_EXTERNAL_STORAGE</span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">// user already provided permission</span><span class="pln">
                </span><span class="com">// perform function for what you want to achieve</span><span class="pln">
     </span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Override</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onRequestPermissionsResult</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> requestCode</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">[]</span><span class="pln"> permissions</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[]</span><span class="pln"> grantResults</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">boolean</span><span class="pln"> canUseExternalStorage </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">switch</span><span class="pln"> </span><span class="pun">(</span><span class="pln">requestCode</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">case</span><span class="pln"> MY_PERMISSIONS_REQUEST_WRITE_EXTERNAL_STORAGE</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">grantResults</span><span class="pun">.</span><span class="pln">length </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
                    </span><span class="pun">&amp;&amp;</span><span class="pln"> grantResults</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">PackageManager</span><span class="pun">.</span><span class="pln">PERMISSION_GRANTED</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                canUseExternalStorage </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">

            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">canUseExternalStorage</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="typ">Toast</span><span class="pun">.</span><span class="pln">makeText</span><span class="pun">(</span><span class="pln">getActivity</span><span class="pun">(),</span><span class="pln"> </span><span class="str">"Cannot use this feature without requested permission"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Toast</span><span class="pun">.</span><span class="pln">LENGTH_SHORT</span><span class="pun">).</span><span class="pln">show</span><span class="pun">();</span><span class="pln">
            </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="com">// user now provided permission</span><span class="pln">
                </span><span class="com">// perform function for what you want to achieve</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
 </span><span class="pun">}</span></code></pre>
</div></text><author><a href="/users/5733111/sanoop">Sanoop</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p><strong>Enable GPS location Android Studio</strong></p>
<ol>
<li><strong><em>Add permission entry in AndroidManifest.Xml</em></strong></li>
</ol>
<p>
</p>
<ol start="2">
<li><p><strong>MapsActivity.java</strong></p>
<pre class="default prettyprint prettyprinted" style=""><code><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MapsActivity</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">FragmentActivity</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">OnMapReadyCallback</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">GoogleMap</span><span class="pln"> mMap</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Context</span><span class="pln"> context</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> PERMISSION_REQUEST_CODE </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
</span><span class="typ">Activity</span><span class="pln"> activity</span><span class="pun">;</span><span class="pln">
</span><span class="com">/**
 * ATTENTION: This was auto-generated to implement the App Indexing API.
 * See https://g.co/AppIndexing/AndroidStudio for more information.
 */</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">GoogleApiClient</span><span class="pln"> client</span><span class="pun">;</span><span class="pln">

</span><span class="lit">@Override</span><span class="pln">
</span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onCreate</span><span class="pun">(</span><span class="typ">Bundle</span><span class="pln"> savedInstanceState</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    context </span><span class="pun">=</span><span class="pln"> getApplicationContext</span><span class="pun">();</span><span class="pln">
    activity </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">super</span><span class="pun">.</span><span class="pln">onCreate</span><span class="pun">(</span><span class="pln">savedInstanceState</span><span class="pun">);</span><span class="pln">
    requestPermission</span><span class="pun">();</span><span class="pln">
    checkPermission</span><span class="pun">();</span><span class="pln">
    setContentView</span><span class="pun">(</span><span class="pln">R</span><span class="pun">.</span><span class="pln">layout</span><span class="pun">.</span><span class="pln">activity_maps</span><span class="pun">);</span><span class="pln">
    </span><span class="com">// Obtain the SupportMapFragment and get notified when the map is ready to be used.</span><span class="pln">
    </span><span class="typ">SupportMapFragment</span><span class="pln"> mapFragment </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">SupportMapFragment</span><span class="pun">)</span><span class="pln"> getSupportFragmentManager</span><span class="pun">()</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">findFragmentById</span><span class="pun">(</span><span class="pln">R</span><span class="pun">.</span><span class="pln">id</span><span class="pun">.</span><span class="pln">map</span><span class="pun">);</span><span class="pln">
    mapFragment</span><span class="pun">.</span><span class="pln">getMapAsync</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Override</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onMapReady</span><span class="pun">(</span><span class="typ">GoogleMap</span><span class="pln"> googleMap</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    mMap </span><span class="pun">=</span><span class="pln"> googleMap</span><span class="pun">;</span><span class="pln">
    </span><span class="typ">LatLng</span><span class="pln"> location </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">LatLng</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    mMap</span><span class="pun">.</span><span class="pln">addMarker</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MarkerOptions</span><span class="pun">().</span><span class="pln">position</span><span class="pun">(</span><span class="pln">location</span><span class="pun">).</span><span class="pln">title</span><span class="pun">(</span><span class="str">"Marker in Bangalore"</span><span class="pun">));</span><span class="pln">
    mMap</span><span class="pun">.</span><span class="pln">moveCamera</span><span class="pun">(</span><span class="typ">CameraUpdateFactory</span><span class="pun">.</span><span class="pln">newLatLng</span><span class="pun">(</span><span class="pln">location</span><span class="pun">));</span><span class="pln">
    mMap</span><span class="pun">.</span><span class="pln">setMyLocationEnabled</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> requestPermission</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="typ">ActivityCompat</span><span class="pun">.</span><span class="pln">shouldShowRequestPermissionRationale</span><span class="pun">(</span><span class="pln">activity</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Manifest</span><span class="pun">.</span><span class="pln">permission</span><span class="pun">.</span><span class="pln">ACCESS_FINE_LOCATION</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">Toast</span><span class="pun">.</span><span class="pln">makeText</span><span class="pun">(</span><span class="pln">context</span><span class="pun">,</span><span class="pln"> </span><span class="str">"GPS permission allows us to access location data. Please allow in App Settings for additional functionality."</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Toast</span><span class="pun">.</span><span class="pln">LENGTH_LONG</span><span class="pun">).</span><span class="pln">show</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">ActivityCompat</span><span class="pun">.</span><span class="pln">requestPermissions</span><span class="pun">(</span><span class="pln">activity</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">String</span><span class="pun">[]{</span><span class="typ">Manifest</span><span class="pun">.</span><span class="pln">permission</span><span class="pun">.</span><span class="pln">ACCESS_FINE_LOCATION</span><span class="pun">},</span><span class="pln"> PERMISSION_REQUEST_CODE</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> checkPermission</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ContextCompat</span><span class="pun">.</span><span class="pln">checkSelfPermission</span><span class="pun">(</span><span class="pln">context</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Manifest</span><span class="pun">.</span><span class="pln">permission</span><span class="pun">.</span><span class="pln">ACCESS_FINE_LOCATION</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">result </span><span class="pun">==</span><span class="pln"> </span><span class="typ">PackageManager</span><span class="pun">.</span><span class="pln">PERMISSION_GRANTED</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre></li>
</ol>
</div></text><author><a href="/users/6575604/naveen-sharma">Naveen Sharma</a></author><comments/></answer></answers></post>