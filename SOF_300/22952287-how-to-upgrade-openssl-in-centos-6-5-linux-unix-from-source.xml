<?xml version="1.0" encoding="utf-8"?>
<post><title>security - How to upgrade OpenSSL in CentOS 6.5 / Linux / Unix from source? - Stack Overflow</title><question><text><div class="post-text" itemprop="text">
<p>How do I upgrade OpenSSL in CentOS 6.5?</p>
<p>I have used these commands, but nothings happens:</p>
<pre><code> cd /usr/src
 wget http://www.openssl.org/source/openssl-1.0.1g.tar.gz
 tar -zxf openssl-1.0.1g.tar.gz
 cd openssl-1.0.1g
 ./config
 make
 make test
 make install
 cd /usr/src
 rm -rf openssl-1.0.1g.tar.gz
 rm -rf openssl-1.0.1g
</code></pre>
<p>After using this command, I get the old version</p>
<pre><code>openssl version
</code></pre>
</div></text><author><a href="/users/63550/peter-mortensen">Peter Mortensen</a></author><comments><comment><text><span class="comment-copy">Don't they have an official binary package (that still gets security updates)?</span></text><author><a class="comment-user" href="/users/14955/thilo" title="168,713 reputation">Thilo</a></author></comment><comment><text><span class="comment-copy">Thanks Thilo, But I want to update to the latest version</span></text><author><a class="comment-user owner" href="/users/2740138/mostafa" title="428 reputation">Mostafa</a></author></comment><comment><text><span class="comment-copy"><code>sudo yum update openssl</code>.</span></text><author><a class="comment-user" href="/users/119527/jonathon-reinhart" title="72,124 reputation">Jonathon Reinhart</a></author></comment><comment><text><span class="comment-copy">Now I have, OpenSSL 1.0.1e-fips 11 Feb 2013 built on: Tue Apr 8 02:39:29 UTC 2014, Is it patched version or not, please?</span></text><author><a class="comment-user owner" href="/users/2740138/mostafa" title="428 reputation">Mostafa</a></author></comment></comments></question><answers><answer><text><div class="post-text" itemprop="text">
<pre><code>./config --prefix=/usr --openssldir=/usr/local/openssl shared
</code></pre>
<p>Try this config line instead to overwrite the default.  It installs to prefix /usr/local/ssl by default in your setup when you leave off the prefix.  You probably have "/usr/local/ssl/bin/openssl" instead of overwriting /usr/bin/openssl.  You can also use /usr/local for prefix instead, but you would need to adjust your path accordingly if that is not already on your path.  Here is the INSTALL documentation:</p>
<pre><code>  $ ./config
  $ make
  $ make test
  $ make install

 [If any of these steps fails, see section Installation in Detail below.]

This will build and install OpenSSL in the default location, which is (for
historical reasons) /usr/local/ssl. If you want to install it anywhere else,
run config like this:

  $ ./config --prefix=/usr/local --openssldir=/usr/local/openssl
</code></pre>
<p><a href="https://github.com/openssl/openssl/blob/master/INSTALL" rel="noreferrer">https://github.com/openssl/openssl/blob/master/INSTALL</a>
<a href="http://heartbleed.com/" rel="noreferrer">http://heartbleed.com/</a></p>
</div></text><author><a href="/users/551899/jmq">jmq</a></author><comments><comment><text><span class="comment-copy">Thanks a lot, jmq I have tested again by your code, And I get successfully</span></text><author><a class="comment-user owner" href="/users/2740138/mostafa" title="428 reputation">Mostafa</a></author></comment><comment><text><span class="comment-copy">Now I have, OpenSSL 1.0.1e-fips 11 Feb 2013 built on: Tue Apr 8 02:39:29 UTC 2014, Is it patched version or not, please?</span></text><author><a class="comment-user owner" href="/users/2740138/mostafa" title="428 reputation">Mostafa</a></author></comment><comment><text><span class="comment-copy">Affected versions are from 1.0.1-1.0.1f, that means 1.0.1e is still affected with Heartbleed bug.</span></text><author><a class="comment-user" href="/users/155640/hendra-uzia" title="5,537 reputation">Hendra Uzia</a></author></comment><comment><text><span class="comment-copy">Check using <code>rpm -qa openssl</code> instead of using <code>openssl version</code>, and see if you have <code>_5.7</code> at the end of the version, if it's there then you're safe. Refer to this: <a href="http://www.centosblog.com/critical-openssl-vulnerability-heartbleed-openssl-1-0-1-1-0-1f-patch-bug-centos-system/" rel="nofollow noreferrer">centosblog.com/…</a></span></text><author><a class="comment-user" href="/users/155640/hendra-uzia" title="5,537 reputation">Hendra Uzia</a></author></comment><comment><text><span class="comment-copy">At least on my Centos 6.5 I had to add another <code>-fPIC</code> switch to the <code>config</code> command.</span></text><author><a class="comment-user" href="/users/23388/nimrodm" title="14,843 reputation">nimrodm</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>The fix for the <code>heartbleed</code> vulnerability has been backported to <code>1.0.1e-16</code> by Red Hat for Enterprise Linux <a href="https://access.redhat.com/site/security/updates/backporting/?sc_cid=3093"><strong>see</strong></a>, and this is therefore the official fix that CentOS ships.</p>
<p>Replacing OpenSSL with the latest version from upstream (i.e. 1.0.1g) runs the risk of introducing functionality changes which may break compatibility with applications/clients in unpredictable ways, causes your system to diverge from RHEL, and puts you on the hook for personally maintaining future updates to that package. By replacing openssl using a simple make config &amp;&amp; make &amp;&amp; make install means that you also lose the ability to use rpm to manage that package and perform queries on it (e.g. verifying all the files are present and haven't been modified or had permissions changed without also updating the RPM database).</p>
<p>I'd also caution that crypto software can be extremely sensitive to seemingly minor things like compiler options, and if you don't know what you're doing, you could introduce vulnerabilities in your local installation.</p>
</div></text><author><a href="/users/2740455/alex-butcher">Alex Butcher</a></author><comments><comment><text><span class="comment-copy">Your suggestion is better.  I was just trying to tell him how to build the code within the context of his question.  He listed build steps and asked what was wrong.  Also, here is the link to the notification of the fix: <a href="https://rhn.redhat.com/errata/RHSA-2014-0376.html" rel="nofollow noreferrer">rhn.redhat.com/errata/RHSA-2014-0376.html</a>  You left that out of your post.</span></text><author><a class="comment-user" href="/users/551899/jmq" title="4,886 reputation">jmq</a></author></comment><comment><text><span class="comment-copy">Thanks Alex, What can I do now? Can I undo ?</span></text><author><a class="comment-user owner" href="/users/2740138/mostafa" title="428 reputation">Mostafa</a></author></comment><comment><text><span class="comment-copy">I have reinstalled openssl by this command "yum reinstall openssl", Should I do anything now ?</span></text><author><a class="comment-user owner" href="/users/2740138/mostafa" title="428 reputation">Mostafa</a></author></comment><comment><text><span class="comment-copy">My openssl version now : OpenSSL 1.0.1e-fips 11 Feb 2013, My OS : CENTOS 6.5 x86_64 standard</span></text><author><a class="comment-user owner" href="/users/2740138/mostafa" title="428 reputation">Mostafa</a></author></comment><comment><text><span class="comment-copy">OpenSSL 1.0.1e-fips 11 Feb 2013 built on: Tue Apr  8 02:39:29 UTC 2014</span></text><author><a class="comment-user owner" href="/users/2740138/mostafa" title="428 reputation">Mostafa</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>To manually compile OpenSSL, do as follows:</p>
<pre><code>$ cd /usr/src

$ wget https://www.openssl.org/source/openssl-1.0.1g.tar.gz -O openssl-1.0.1g.tar.gz

$ tar -zxf openssl-1.0.1g.tar.gz

$ cd openssl-1.0.1g

$ ./config

$ make

$ make test

$ make install

$ openssl version
</code></pre>
<p>If it shows the old version, do the steps below.</p>
<pre><code>$ mv /usr/bin/openssl /root/

$ ln -s /usr/local/ssl/bin/openssl /usr/bin/openssl
openssl version
OpenSSL 1.0.1g 7 Apr 2014
</code></pre>
<p><a href="http://olaitanmayowa.com/heartbleed-how-to-upgrade-openssl-in-centos/" rel="noreferrer">http://olaitanmayowa.com/heartbleed-how-to-upgrade-openssl-in-centos/</a></p>
</div></text><author><a href="/users/3380339/olaitan-mayowa">Olaitan Mayowa</a></author><comments><comment><text><span class="comment-copy">Works like a charm! Thanks!</span></text><author><a class="comment-user" href="/users/453486/srikanth-jeeva" title="1,714 reputation">Srikanth Jeeva</a></author></comment><comment><text><span class="comment-copy">works perfect with Ubuntu</span></text><author><a class="comment-user" href="/users/1347601/bruno-bg" title="2,194 reputation">Bruno BG</a></author></comment><comment><text><span class="comment-copy">very nice example... works perfectly...</span></text><author><a class="comment-user" href="/users/896043/yesu-raj" title="152 reputation">Yesu Raj</a></author></comment><comment><text><span class="comment-copy">works on Ubuntu 14.04 as well !</span></text><author><a class="comment-user" href="/users/2142577/laike9m" title="5,854 reputation">laike9m</a></author></comment><comment><text><span class="comment-copy">Best answer! Works perfectly.</span></text><author><a class="comment-user" href="/users/4337310/prvs" title="749 reputation">PRVS</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p><code>sudo yum update openssl</code> is all you need.</p>
<p>This will bring you up to <code>openssl-1.0.1e-16.el6_5.7</code>.</p>
<p>You need to <strong><em>restart Apache</em></strong> after the update. Or better yet, reboot the box if possible, so that all applications that use OpenSSL will load the new version.</p>
</div></text><author><a href="/users/119527/jonathon-reinhart">Jonathon Reinhart</a></author><comments><comment><text><span class="comment-copy">Note doing sudo yum update openssl does not work in CentOS 5. To quote from another SO post:  CentOS 5 does not have an official package of openssl newer than 0.9.8 so you cannot upgrade the system package to 1.0.1.  If you need 1.0.1 on the CentOS 5 server you can compile/package it yourself but you cannot replace the 0.9.8 package/files without recompiling everything else on the system as well.</span></text><author><a class="comment-user" href="/users/1384921/captainhero70" title="586 reputation">captainhero70</a></author></comment><comment><text><span class="comment-copy"><code>No repos enabled</code>. Nevertheless, I do have an OpenSSL version. Then what should I do to use the <code>yum</code>?</span></text><author><a class="comment-user" href="/users/1883256/pathros" title="1,227 reputation">Pathros</a></author></comment><comment><text><span class="comment-copy">@Pathros You need to <a href="https://www.google.com/search?q=how+to+configure+yum+repos" rel="nofollow noreferrer">configure your yum repos</a>.</span></text><author><a class="comment-user" href="/users/119527/jonathon-reinhart" title="72,124 reputation">Jonathon Reinhart</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>The only thing you have to do is perform an <code>yum update</code>.  </p>
<p>It will automatically download and update a backported version of <code>openssl-1.0.1e-16.el6_5.7</code> which has been patched by RedHat with heartbeat disabled.</p>
<p>To verify the update simply check the changelog:<br/>
<code># rpm -q --changelog openssl-1.0.1e | grep -B 1 CVE-2014-0160</code><br/>
you should see the following:<br/>
<code>* Mon Apr 07 2014 Tomáš Mráz &lt;tmraz@redhat.com&gt; 1.0.1e-16.7
- fix CVE-2014-0160 - information disclosure in TLS heartbeat extension</code></p>
<p>Make sure you reboot the server because important services such as Apache and SSH use openSSL.</p>
</div></text><author><a href="/users/1576319/toshe">Toshe</a></author><comments><comment><text><span class="comment-copy">Thank you. This is the most correct answer. Do not manually update openSSL.</span></text><author><a class="comment-user" href="/users/952608/moe" title="3,670 reputation">Moe</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>My approach was:</p>
<pre><code>openssl version
OpenSSL 1.0.1e 11 Feb 2013

wget https://www.openssl.org/source/openssl-1.0.2a.tar.gz
wget http://www.linuxfromscratch.org/patches/blfs/svn/openssl-1.0.2a-fix_parallel_build-1.patch
tar xzf openssl-1.0.2a.tar.gz
cd openssl-1.0.2a
patch -Np1 -i ../openssl-1.0.2a-fix_parallel_build-1.patch
./config --prefix=/usr --openssldir=/etc/ssl --libdir=lib shared zlib-dynamic
make
make install

openssl version
OpenSSL 1.0.2a 19 Mar 2015 
</code></pre>
</div></text><author><a href="/users/1793651/garistar">Garistar</a></author><comments><comment><text><span class="comment-copy">getting a 404 on <a href="http://www.linuxfromscratch.org/patches/blfs/svn/openssl-1.0.2a-fix_parallel_build-1.patch" rel="nofollow noreferrer">linuxfromscratch.org/patches/blfs/svn/…</a></span></text><author><a class="comment-user" href="/users/1426788/lfender6445" title="9,316 reputation">lfender6445</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>You should replace the old OpenSSL binary file by the new one via a symlink:</p>
<pre><code>sudo ln -sf /usr/local/ssl/bin/openssl `which openssl`
</code></pre>
<p>Remember that after this procedure you should reboot the server or restart all the services related to OpenSSL.</p>
</div></text><author><a href="/users/1305626/agli-panci">Agli Panci</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p><code>rpm -qa openssl
yum clean all &amp;&amp; yum update "openssl*"
lsof -n | grep ssl | grep DEL
cd /usr/src
wget http://www.openssl.org/source/openssl-1.0.1g.tar.gz
tar -zxf openssl-1.0.1g.tar.gz
cd openssl-1.0.1g
./config --prefix=/usr --openssldir=/usr/local/openssl shared
./config
make
make test
make install
cd /usr/src
rm -rf openssl-1.0.1g.tar.gz
rm -rf openssl-1.0.1g</code></p>
<p>and </p>
<pre><code>openssl version
</code></pre>
</div></text><author><a href="/users/3533549/tvfun">tvfun</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>it is easy! you are downloading the binary file?.  download the rpm latest package 
 openssl-1.0.1e-30.el6.x86_64 
check what was the current version using rpm -q openssl.
if this is older then do rpm -U openssl-1.0.1e-30.el6.x86_64 .
if yum is configured updated this package in the repo and do yum update openssl
if your repo in RHN do simply yum update 
openssl-1.0.1g is very old and valnuarable </p>
</div></text><author><a href="/users/4468937/umesh">umesh</a></author><comments/></answer><answer><text><div class="post-text" itemprop="text">
<p>You can also check the local changelog to verify whether or not OpenSSL is patched against the vulnerability with the following command:</p>
<pre><code>rpm -q --changelog openssl | grep CVE-2014-0224
</code></pre>
<p>If a result is not returned, then you must patch OpenSSL.</p>
<p><a href="http://www.liquidweb.com/kb/update-and-patch-openssl-for-the-ccs-injection-vulnerability/" rel="nofollow">http://www.liquidweb.com/kb/update-and-patch-openssl-for-the-ccs-injection-vulnerability/</a></p>
</div></text><author><a href="/users/2293304/rockallite">Rockallite</a></author><comments/></answer></answers></post>