<?xml version="1.0" encoding="utf-8"?>
<post><title>security - How does the RSA private key passphrase work under the hood? - Stack Overflow</title><question><text><div class="post-text" itemprop="text">
<p>RSA private keys may be assigned a "passphrase" which - as I understand it - is intended to provide some secondary security in case someone makes off with the private key file.</p>
<p>How is the passphrase layer of security implemented?</p>
</div></text><author><a href="/users/129716/qfinder">qfinder</a></author><comments><comment><text><span class="comment-copy">RSA itself does no such thing. It sounds like you're talking about some particular program that uses RSA -- in which case it would be extremely helpful if you were to tell us what program you're talking about (e.g. PGP or GPG).</span></text><author><a class="comment-user" href="/users/179910/jerry-coffin" title="336,847 reputation">Jerry Coffin</a></author></comment><comment><text><span class="comment-copy">Interesting - mostly I'm curious about the passphrase requested by running "ssh-keygen -t rsa" on unix-y systems.</span></text><author><a class="comment-user owner" href="/users/129716/qfinder" title="338 reputation">qfinder</a></author></comment><comment><text><span class="comment-copy">This question appears to be off-topic because it is not about programming. See <a href="http://stackoverflow.com/help/on-topic">What topics can I ask about here</a> in the Help Center. Perhaps <a href="http://security.stackexchange.com/">Information Security Stack Exchange</a> would be a better place to ask.</span></text><author><a class="comment-user" href="/users/608639/jww" title="41,097 reputation">jww</a></author></comment></comments></question><answers><answer><text><div class="post-text" itemprop="text">
<p>ssh-keygen uses OpenSSL to generate RSA keys and store it in PEM format. The encryption you are talking about is specific to PEM. If you look at your key file,</p>
<pre><code>-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: DES-EDE3-CBC,5B01E932988DC66B

EPESt4ZVIrxnQXxxWWVa7cCR+vgNZ/4vTu4mdq6pjaW7jMZoB8HV+mA745mQkQw7
i+YtdVs/JqOeyGiw/3McxYYKZTlhyh7MvfIr1n8ZdZmcjQz+oFqMxChFU3r8BGgA
</code></pre>
<p>"DEK-Info" header has all the information you need to decrypt the key as long as you know the passphrase. "DES-EDE3-CBC" means Triple DES (in EDE mode). CBC is the chaining mode. The hex number is the initial vector needed for CBC.</p>
<p>PEM is a very old format so it only supports DES/TripleDES. AES and Blowfish were added later on but not supported by all implementations. My ssh (OpenSSH 5.2) only supports DES and TripleDES.</p>
</div></text><author><a href="/users/149808/zz-coder">ZZ Coder</a></author><comments><comment><text><span class="comment-copy">Is there any JRE Class that knows how to read this format?</span></text><author><a class="comment-user" href="/users/544303/phaedrus" title="339 reputation">Phaedrus</a></author></comment><comment><text><span class="comment-copy">@Phaedrus see <a href="https://github.com/bcgit/bc-java/blob/c0d5ac5e62a6531f640bdfb4897a9fe95a0c9fdb/pkix/src/test/java/org/bouncycastle/openssl/test/ParserTest.java#L412" rel="nofollow noreferrer">github.com/bcgit/bc-java/blob/â€¦</a></span></text><author><a class="comment-user" href="/users/309483/janus-troelsen" title="10,923 reputation">Janus Troelsen</a></author></comment><comment><text><span class="comment-copy">This answer seems to be missing on how to translate password to decryption key accepted by the cipher.</span></text><author><a class="comment-user" href="/users/622266/pawel-veselov" title="1,848 reputation">Pawel Veselov</a></author></comment><comment><text><span class="comment-copy">what does that integer 4 represent in Proc-Type?</span></text><author><a class="comment-user" href="/users/3980566/amit-verma" title="75 reputation">Amit Verma</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>The passphrase is just a key used to encrypt the file that contains the RSA key, using a symmetric cipher (usually DES or 3DES). In order to use the key for public-key encryption, you first need to decrypt its file using the decryption key. ssh does this automatically by asking your for the passphrase.</p>
<p>If somebody got a hold of the key's file, they wouldn't be able to use it unless they knew the passphrase used to encrypt the file.</p>
</div></text><author><a href="/users/212649/rudedog">Rudedog</a></author><comments><comment><text><span class="comment-copy">Thanks much for the reply! Couple of follow-on questions: Is the passphrase part of the RSA standard or something else (as per the commenter above)? Does the ssh-keygen program use DES or 3DES / how would I tell? What grade? Why not AES?</span></text><author><a class="comment-user owner" href="/users/129716/qfinder" title="338 reputation">qfinder</a></author></comment></comments></answer><answer><text><div class="post-text" itemprop="text">
<p>Private keys stored on general-purpose file systems (as opposed to tamperproof, special-purpose hardware tokens) could be easily stolen if not protected. File system permissions might seem sufficient, but they can often be bypassed, especially if an attacker has physical access to the machine.</p>
<p>A strong symmetric cipher, keyed with a good password, helps prevent this. A good RSA private key is too long to remember (for me, anyway), but far smaller symmetric keys can provide the same level of security. A relatively short, symmetric key stored in one's brain is used to protect a large private key stored on disk.</p>
</div></text><author><a href="/users/3474/erickson">erickson</a></author><comments><comment><text><span class="comment-copy">Definitely makes sense -- any more details as to how, exactly, it's implemented? (Which symmetric exactly, whether that's standard for all impls, etc?)</span></text><author><a class="comment-user owner" href="/users/129716/qfinder" title="338 reputation">qfinder</a></author></comment></comments></answer></answers></post>